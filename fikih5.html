<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#14b8a6">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/128/15044/15044863.png">
    <title>ğŸ“š FIKIH ITU MUDAH - Learning Fikih with Fun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.2em;
            line-height: 1.8;
            direction: rtl;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .arabic-text {
                font-size: 1.5em;
            }
        }
        
        /* Background Animations */
        .gradient-bg {
            background: linear-gradient(-45deg, #14b8a6, #0d9488, #10b981, #059669);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Card Animations */
        .card-hover {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .card-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .card-hover:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .card-hover:hover::before {
            left: 100%;
        }
        
        /* Progress Bar Animations */
        .progress-bar {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, .2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, .2) 50%,
                rgba(255, 255, 255, .2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }
        
        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        
        /* Navigation */
        .nav-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item:hover {
            transform: translateY(-2px);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* Page Transitions */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Avatar Selection */
        .avatar-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
        }
        
        .avatar-option.selected {
            border: 4px solid #3b82f6;
            transform: scale(1.1);
        }
        
        /* Calculator Styles */
        .calculator-input {
            transition: all 0.3s ease;
        }
        
        .calculator-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        /* Payment Simulation */
        .payment-method {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .payment-method:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .payment-method.selected {
            border: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        /* Certificate Styles */
        .certificate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 8px solid #ffd700;
            position: relative;
        }
        
        .certificate::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 2px solid #ffd700;
            pointer-events: none;
        }
        
        /* Animation for explanation */
        .animate-fadeIn {
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .card-hover:hover {
                transform: translateY(-3px) scale(1.005);
            }
            
            .nav-item {
                font-size: 0.75rem;
                padding: 0.5rem 0.75rem;
            }
            
            .nav-item i {
                font-size: 0.875rem;
            }
            
            /* Touch-friendly buttons */
            button, .quiz-option {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            /* Prevent zoom on input focus */
            input, select, textarea {
                font-size: 16px;
            }
            
            /* Modal adjustments for mobile */
            .fixed.inset-0 > div {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }
            
            /* Certificate mobile adjustments */
            .certificate {
                padding: 2rem 1rem;
                font-size: 0.875rem;
            }
            
            .certificate h2 {
                font-size: 1.5rem;
            }
            
            .certificate .text-5xl {
                font-size: 2rem;
            }
            
            .certificate .text-3xl {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            /* Extra small screens */
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .grid {
                gap: 1rem;
            }
            
            .text-3xl {
                font-size: 1.5rem;
            }
            
            .text-2xl {
                font-size: 1.25rem;
            }
            
            .p-8 {
                padding: 1.5rem;
            }
            
            .p-6 {
                padding: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Welcome Form -->
    <div id="welcomeForm" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center z-50 p-2">
        <div class="bg-white rounded-2xl md:rounded-3xl p-4 md:p-6 max-w-md w-full shadow-2xl max-h-screen overflow-y-auto">
            <div class="text-center mb-4 md:mb-6">
                <div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-2 md:mb-4">
                    <img src="https://cdn-icons-png.flaticon.com/128/15044/15044863.png" alt="Logo FIKIH ITU MUDAH" class="w-full h-full object-contain">
                </div>
                <h2 class="text-xl md:text-3xl font-bold text-gray-800 mb-1 md:mb-2">Selamat Datang!</h2>
                <p class="text-sm md:text-base text-gray-600">Mari berkenalan sebelum memulai pembelajaran</p>
            </div>
            
            <form id="profileForm" class="space-y-3 md:space-y-4">
                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1 md:mb-2">
                        <i class="fas fa-user mr-1 md:mr-2"></i>Nama Lengkap
                    </label>
                    <input type="text" id="userName" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-gray-300 rounded-lg md:rounded-xl focus:border-blue-500 focus:outline-none transition-all text-sm md:text-base" placeholder="Masukkan nama lengkap" required>
                </div>
                
                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1 md:mb-2">
                        <i class="fas fa-graduation-cap mr-1 md:mr-2"></i>Kelas
                    </label>
                    <select id="userClass" class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-gray-300 rounded-lg md:rounded-xl focus:border-blue-500 focus:outline-none transition-all text-sm md:text-base" required>
                        <option value="">Pilih Kelas</option>
                        <option value="5A">5A (Lima A)</option>
                        <option value="5B">5B (Lima B)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2 md:mb-3">
                        <i class="fas fa-camera mr-1 md:mr-2"></i>Foto Profil
                    </label>
                    
                    <!-- Photo Upload Area - Compact -->
                    <div class="text-center mb-2 md:mb-3">
                        <div id="photoPreview" class="w-20 h-20 md:w-24 md:h-24 mx-auto bg-gray-100 rounded-full border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden cursor-pointer hover:border-blue-400 transition-all" onclick="document.getElementById('photoInput').click()">
                            <div id="photoPlaceholder" class="text-center">
                                <i class="fas fa-camera text-lg md:text-2xl text-gray-400 mb-1"></i>
                                <p class="text-xs text-gray-500">Upload</p>
                            </div>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" class="hidden">
                        <p class="text-xs text-gray-500 mt-1">JPG/PNG (Max 5MB)</p>
                    </div>
                    
                    <!-- Default Avatar Options - Compact -->
                    <div class="text-center">
                        <p class="text-xs md:text-sm text-gray-600 mb-2">Atau pilih avatar:</p>
                        <div class="flex justify-center gap-2 md:gap-3">
                            <div class="avatar-option w-8 h-8 md:w-10 md:h-10 bg-blue-100 rounded-full border-2 border-gray-300 cursor-pointer hover:border-blue-400 flex items-center justify-center" data-avatar="default1">
                                <i class="fas fa-user text-blue-500 text-xs md:text-sm"></i>
                            </div>
                            <div class="avatar-option w-8 h-8 md:w-10 md:h-10 bg-pink-100 rounded-full border-2 border-gray-300 cursor-pointer hover:border-pink-400 flex items-center justify-center" data-avatar="default2">
                                <i class="fas fa-user-graduate text-pink-500 text-xs md:text-sm"></i>
                            </div>
                            <div class="avatar-option w-8 h-8 md:w-10 md:h-10 bg-green-100 rounded-full border-2 border-gray-300 cursor-pointer hover:border-green-400 flex items-center justify-center" data-avatar="default3">
                                <i class="fas fa-child text-green-500 text-xs md:text-sm"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 md:py-4 rounded-lg md:rounded-xl font-bold text-sm md:text-lg hover:from-blue-600 hover:to-purple-700 transition-all hover:scale-105 mt-4 md:mt-6">
                    <i class="fas fa-rocket mr-1 md:mr-2"></i>Mulai Belajar
                </button>
            </form>
        </div>
    </div>

    <!-- Header -->
    <div class="gradient-bg text-white py-4 md:py-6 relative overflow-hidden">
        <div class="container mx-auto px-2 md:px-4">
            <!-- Logo and Title -->
            <div class="flex justify-between items-center mb-4 md:mb-0">
                <div class="flex items-center">
                    <div class="mr-2 md:mr-4">
                        <div class="w-12 h-12 md:w-16 md:h-16">
                            <img src="https://cdn-icons-png.flaticon.com/128/15044/15044863.png" alt="Logo FIKIH ITU MUDAH" class="w-full h-full object-contain" onerror="this.src=''; this.alt='Logo failed to load'; this.style.display='none';">
                        </div>
                    </div>
                    <div>
                        <h1 class="text-lg md:text-2xl lg:text-3xl font-bold leading-tight">BELAJAR ITU MENYENANGKAN!</h1>
                        <p class="text-sm md:text-lg lg:text-xl font-semibold opacity-90">FIKIH KELAS 5 MI</p>
                    </div>
                </div>
                
                <!-- User Profile - Desktop Only -->
                <div id="userProfile" class="hidden md:flex items-center bg-white rounded-2xl px-4 py-3 shadow-lg border-2 border-white/30 min-w-0">
                    <div id="userAvatar" class="w-14 h-14 bg-gray-100 rounded-full overflow-hidden mr-4 shadow-md flex-shrink-0">
                        <svg viewBox="0 0 100 100" class="w-full h-full">
                            <circle cx="50" cy="50" r="50" fill="#e3f2fd"/>
                            <circle cx="50" cy="35" r="15" fill="#ffdbcb"/>
                            <path d="M35 45 Q50 30 65 45 Q65 60 50 65 Q35 60 35 45" fill="#ffdbcb"/>
                            <circle cx="43" cy="38" r="2" fill="#333"/>
                            <circle cx="57" cy="38" r="2" fill="#333"/>
                            <path d="M45 45 Q50 48 55 45" stroke="#333" stroke-width="1" fill="none"/>
                            <path d="M30 25 Q50 15 70 25 Q70 35 50 40 Q30 35 30 25" fill="#8b4513"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div id="userNameDisplay" class="font-bold text-lg text-gray-800 truncate">Siswa</div>
                        <div id="userClassDisplay" class="text-sm text-gray-600 mb-2">Kelas -</div>
                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="userProgressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-600 mt-1">
                            <span>Progress Belajar</span>
                            <span id="userProgressText">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="mt-4 md:mt-6">
                <div class="flex flex-wrap gap-1 md:gap-2 lg:gap-4">
                    <div class="nav-item active px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium" onclick="showPage('dashboard')">
                        <i class="fas fa-home mr-1 md:mr-2"></i><span class="hidden sm:inline">Dashboard</span><span class="sm:hidden">Home</span>
                    </div>
                    <div class="nav-item px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium" onclick="showPage('zakatFitrah')">
                        <i class="fas fa-coins mr-1 md:mr-2"></i><span class="hidden sm:inline">Zakat Fitrah</span><span class="sm:hidden">Zakat</span>
                    </div>
                    <div id="infakMenu" class="nav-item px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium opacity-50 cursor-not-allowed" onclick="checkMenuAccess('infak')">
                        <i class="fas fa-hand-holding-heart mr-1 md:mr-2"></i><i class="fas fa-lock ml-1 text-xs"></i>Infak
                    </div>
                    <div id="sedekahMenu" class="nav-item px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium opacity-50 cursor-not-allowed" onclick="checkMenuAccess('sedekah')">
                        <i class="fas fa-heart mr-1 md:mr-2"></i><i class="fas fa-lock ml-1 text-xs"></i>Sedekah
                    </div>
                    <div id="qurbanMenu" class="nav-item px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium opacity-50 cursor-not-allowed" onclick="checkMenuAccess('qurban')">
                        <i class="fas fa-cow mr-1 md:mr-2"></i><i class="fas fa-lock ml-1 text-xs"></i>Qurban
                    </div>
                    <div class="nav-item px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium" onclick="showPage('calculator')">
                        <i class="fas fa-calculator mr-1 md:mr-2"></i><span class="hidden sm:inline">Kalkulator</span><span class="sm:hidden">Calc</span>
                    </div>
                    <div class="nav-item px-2 md:px-4 py-2 rounded-xl text-xs md:text-sm font-medium" onclick="showPage('certificate')">
                        <i class="fas fa-certificate mr-1 md:mr-2"></i><span class="hidden sm:inline">Sertifikat</span><span class="sm:hidden">Cert</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile User Profile Card - Below Header -->
    <div class="md:hidden bg-white shadow-lg mx-2 mt-2 rounded-2xl p-4 border-2 border-gray-100">
        <div class="flex items-center">
            <div id="userAvatarMobile" class="w-16 h-16 bg-gray-100 rounded-full overflow-hidden mr-4 shadow-md flex-shrink-0">
                <svg viewBox="0 0 100 100" class="w-full h-full">
                    <circle cx="50" cy="50" r="50" fill="#e3f2fd"/>
                    <circle cx="50" cy="35" r="15" fill="#ffdbcb"/>
                    <path d="M35 45 Q50 30 65 45 Q65 60 50 65 Q35 60 35 45" fill="#ffdbcb"/>
                    <circle cx="43" cy="38" r="2" fill="#333"/>
                    <circle cx="57" cy="38" r="2" fill="#333"/>
                    <path d="M45 45 Q50 48 55 45" stroke="#333" stroke-width="1" fill="none"/>
                    <path d="M30 25 Q50 15 70 25 Q70 35 50 40 Q30 35 30 25" fill="#8b4513"/>
                </svg>
            </div>
            <div class="flex-1 min-w-0">
                <div id="userNameDisplayMobile" class="font-bold text-lg text-gray-800 truncate mb-1">Siswa</div>
                <div id="userClassDisplayMobile" class="text-sm text-gray-600 mb-3">Kelas -</div>
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="userProgressBarMobile" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-600 mt-2">
                    <span>Progress Belajar</span>
                    <span id="userProgressTextMobile">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-2 md:px-4 py-4 md:py-8 max-w-7xl">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <!-- Progress Overview -->
            <div class="bg-white rounded-2xl md:rounded-3xl shadow-xl p-4 md:p-8 mb-4 md:mb-8 card-hover">
                <div class="flex items-center mb-4 md:mb-6">
                    <i class="fas fa-chart-line text-2xl md:text-3xl text-blue-500 mr-2 md:mr-4"></i>
                    <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ringkasan Pembelajaran</h2>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6">
                    <div class="text-center p-3 md:p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl card-hover">
                        <div class="text-3xl md:text-5xl mb-2 md:mb-4">
                            <i class="fas fa-coins text-blue-500"></i>
                        </div>
                        <div class="font-bold text-gray-800 text-sm md:text-lg mb-1 md:mb-2">Zakat Fitrah</div>
                        <div class="text-xs md:text-sm text-gray-600 mb-2 md:mb-3">Progress: <span class="font-bold" id="zakatProgress">0%</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 md:h-3">
                            <div class="bg-gradient-to-r from-blue-400 to-blue-600 h-2 md:h-3 rounded-full progress-bar" id="zakatProgressBar" style="width: 0%"></div>
                        </div>
                        <button class="mt-2 md:mt-4 px-3 md:px-4 py-2 bg-blue-500 text-white rounded-lg text-xs md:text-sm hover:bg-blue-600 transition-all" onclick="showPage('zakatFitrah')">
                            <i class="fas fa-play mr-1"></i>Mulai
                        </button>
                    </div>
                    
                    <div id="infakDashboard" class="text-center p-3 md:p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl opacity-50">
                        <div class="text-3xl md:text-5xl mb-2 md:mb-4 relative">
                            <i class="fas fa-hand-holding-heart text-green-500"></i>
                            <i class="fas fa-lock absolute -top-1 -right-1 text-gray-400 text-sm"></i>
                        </div>
                        <div class="font-bold text-gray-800 text-sm md:text-lg mb-1 md:mb-2">Infak</div>
                        <div class="text-xs md:text-sm text-gray-600 mb-2 md:mb-3">Progress: <span class="font-bold">ğŸ”’</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 md:h-3">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 md:h-3 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 md:mt-4 text-xs text-gray-500">Selesaikan Zakat Fitrah (70%)</div>
                    </div>
                    
                    <div id="sedekahDashboard" class="text-center p-3 md:p-6 bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl opacity-50">
                        <div class="text-3xl md:text-5xl mb-2 md:mb-4 relative">
                            <i class="fas fa-heart text-pink-500"></i>
                            <i class="fas fa-lock absolute -top-1 -right-1 text-gray-400 text-sm"></i>
                        </div>
                        <div class="font-bold text-gray-800 text-sm md:text-lg mb-1 md:mb-2">Sedekah</div>
                        <div class="text-xs md:text-sm text-gray-600 mb-2 md:mb-3">Progress: <span class="font-bold">ğŸ”’</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 md:h-3">
                            <div class="bg-gradient-to-r from-pink-400 to-pink-600 h-2 md:h-3 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 md:mt-4 text-xs text-gray-500">Selesaikan Zakat Fitrah (80%)</div>
                    </div>
                    
                    <div id="qurbanDashboard" class="text-center p-3 md:p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl opacity-50">
                        <div class="text-3xl md:text-5xl mb-2 md:mb-4 relative">
                            <i class="fas fa-cow text-purple-500"></i>
                            <i class="fas fa-lock absolute -top-1 -right-1 text-gray-400 text-sm"></i>
                        </div>
                        <div class="font-bold text-gray-800 text-sm md:text-lg mb-1 md:mb-2">Qurban</div>
                        <div class="text-xs md:text-sm text-gray-600 mb-2 md:mb-3">Progress: <span class="font-bold">ğŸ”’</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2 md:h-3">
                            <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-2 md:h-3 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 md:mt-4 text-xs text-gray-500">Selesaikan Zakat Fitrah (90%)</div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-6">
                <div class="bg-white rounded-2xl shadow-lg p-4 md:p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-2 md:p-3 rounded-full mr-3 md:mr-4">
                            <i class="fas fa-trophy text-blue-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <div class="text-xl md:text-2xl font-bold text-gray-800" id="totalBadges">0</div>
                            <div class="text-xs md:text-sm text-gray-600">Badge Diraih</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg p-4 md:p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-2 md:p-3 rounded-full mr-3 md:mr-4">
                            <i class="fas fa-check-circle text-green-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <div class="text-xl md:text-2xl font-bold text-gray-800" id="completedModules">0/3</div>
                            <div class="text-xs md:text-sm text-gray-600">Modul Selesai</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg p-4 md:p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-purple-100 p-2 md:p-3 rounded-full mr-3 md:mr-4">
                            <i class="fas fa-clock text-purple-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <div class="text-xl md:text-2xl font-bold text-gray-800" id="studyTime">0 menit</div>
                            <div class="text-xs md:text-sm text-gray-600">Waktu Belajar</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zakat Fitrah Page -->
        <div id="zakatFitrah" class="page">
            <div class="bg-white rounded-2xl md:rounded-3xl shadow-xl p-4 md:p-8 mb-4 md:mb-8">
                <div class="flex items-center mb-4 md:mb-6">
                    <i class="fas fa-coins text-2xl md:text-3xl text-blue-500 mr-2 md:mr-4"></i>
                    <h2 class="text-xl md:text-3xl font-bold text-gray-800">Pembelajaran Zakat Fitrah</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6" id="learningModules">
                    <!-- Modules will be dynamically generated -->
                </div>
                
                <!-- Quick Actions -->
                <div class="mt-6 md:mt-8 grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                    <button class="flex items-center justify-center px-4 md:px-6 py-3 md:py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all hover:scale-105" onclick="showPage('calculator')">
                        <i class="fas fa-calculator mr-2 md:mr-3 text-lg md:text-xl"></i>
                        <div class="text-left">
                            <div class="font-bold text-sm md:text-base">Kalkulator Zakat</div>
                            <div class="text-xs md:text-sm opacity-90">Hitung jumlah zakat fitrah</div>
                        </div>
                    </button>
                    
                    <button class="flex items-center justify-center px-4 md:px-6 py-3 md:py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all hover:scale-105" onclick="showPaymentSimulation()">
                        <i class="fas fa-credit-card mr-2 md:mr-3 text-lg md:text-xl"></i>
                        <div class="text-left">
                            <div class="font-bold text-sm md:text-base">Simulasi Pembayaran</div>
                            <div class="text-xs md:text-sm opacity-90">Praktik bayar zakat fitrah</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Calculator Page -->
        <div id="calculator" class="page">
            <div class="bg-white rounded-2xl md:rounded-3xl shadow-xl p-4 md:p-8">
                <div class="flex items-center mb-4 md:mb-6">
                    <i class="fas fa-calculator text-2xl md:text-3xl text-green-500 mr-2 md:mr-4"></i>
                    <h2 class="text-xl md:text-3xl font-bold text-gray-800">Kalkulator Zakat Fitrah</h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8">
                    <!-- Input Form -->
                    <div class="space-y-4 md:space-y-6">
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 md:p-6 rounded-2xl">
                            <h3 class="text-lg md:text-xl font-bold text-green-800 mb-3 md:mb-4">
                                <i class="fas fa-users mr-2"></i>Data Keluarga
                            </h3>
                            
                            <div class="space-y-3 md:space-y-4">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Jumlah Anggota Keluarga</label>
                                    <input type="number" id="familyMembers" class="calculator-input w-full px-3 md:px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none text-base" placeholder="Masukkan jumlah anggota" min="1" value="4">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Harga Beras per Kg</label>
                                    <input type="number" id="ricePrice" class="calculator-input w-full px-3 md:px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none text-base" placeholder="Harga beras (Rp)" value="15000">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Jenis Pembayaran</label>
                                    <select id="paymentType" class="calculator-input w-full px-3 md:px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none text-base">
                                        <option value="beras">Beras (2.5 kg/orang)</option>
                                        <option value="uang">Uang (setara harga beras)</option>
                                        <option value="campuran">Campuran</option>
                                    </select>
                                </div>
                                
                                <button onclick="calculateZakat()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 md:py-4 rounded-xl font-bold text-base md:text-lg hover:from-green-600 hover:to-green-700 transition-all hover:scale-105">
                                    <i class="fas fa-calculator mr-2"></i>Hitung Zakat
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Result -->
                    <div class="space-y-6">
                        <div id="calculatorResult" class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-blue-800 mb-4">
                                <i class="fas fa-chart-pie mr-2"></i>Hasil Perhitungan
                            </h3>
                            <div class="text-center py-8">
                                <i class="fas fa-calculator text-6xl text-blue-300 mb-4"></i>
                                <p class="text-blue-600">Masukkan data untuk melihat hasil perhitungan</p>
                            </div>
                        </div>
                        
                        <!-- Quick Reference -->
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-2xl">
                            <h3 class="text-lg font-bold text-yellow-800 mb-4">
                                <i class="fas fa-info-circle mr-2"></i>Panduan Cepat
                            </h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-check text-yellow-600 mr-2"></i>
                                    <span>1 orang = 2.5 kg beras</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check text-yellow-600 mr-2"></i>
                                    <span>Keluarga 4 orang = 10 kg beras</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check text-yellow-600 mr-2"></i>
                                    <span>Boleh diganti dengan uang setara</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check text-yellow-600 mr-2"></i>
                                    <span>Dibayar sebelum shalat Id</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Certificate Page -->
        <div id="certificate" class="page">
            <div class="bg-white rounded-3xl shadow-xl p-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-certificate text-3xl text-purple-500 mr-4"></i>
                    <h2 class="text-3xl font-bold text-gray-800">Sertifikat Pembelajaran</h2>
                </div>
                
                <div id="certificateContent" class="text-center py-12">
                    <i class="fas fa-lock text-6xl text-gray-300 mb-6"></i>
                    <h3 class="text-2xl font-bold text-gray-600 mb-4">Sertifikat Belum Tersedia</h3>
                    <p class="text-gray-500 mb-8">Selesaikan semua modul pembelajaran untuk mendapatkan sertifikat</p>
                    
                    <div class="max-w-md mx-auto">
                        <div class="bg-gray-100 rounded-full h-4 mb-4">
                            <div id="overallProgress" class="bg-gradient-to-r from-purple-400 to-purple-600 h-4 rounded-full" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-600">Progress Keseluruhan: <span id="overallProgressText">0%</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Modal -->
    <div id="learningModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center hidden z-50 p-2 md:p-4">
        <div class="bg-white rounded-2xl md:rounded-3xl max-w-4xl w-full max-h-[95vh] md:max-h-[90vh] overflow-hidden flex flex-col">
            <div class="gradient-bg text-white p-4 md:p-6 flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h3 id="modalTitle" class="text-lg md:text-2xl font-bold">Materi Pembelajaran</h3>
                    <button class="text-white hover:text-gray-200 text-xl md:text-2xl" onclick="closeLearningModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="modalContent" class="p-4 md:p-6 overflow-y-auto flex-1">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Payment Simulation Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center hidden z-50 p-2 md:p-4">
        <div class="bg-white rounded-2xl md:rounded-3xl max-w-2xl w-full max-h-[95vh] md:max-h-[90vh] overflow-hidden flex flex-col">
            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 md:p-6 rounded-t-2xl md:rounded-t-3xl flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg md:text-2xl font-bold">
                        <i class="fas fa-credit-card mr-2"></i>Simulasi Pembayaran Zakat
                    </h3>
                    <button class="text-white hover:text-gray-200 text-xl md:text-2xl" onclick="closePaymentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="paymentContent" class="p-4 md:p-6 overflow-y-auto flex-1">
                <!-- Payment content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let userProfile = {
            name: '',
            class: '',
            avatar: 'default1',
            avatarSvg: `<div class="w-full h-full bg-blue-100 flex items-center justify-center"><i class="fas fa-user text-blue-500 text-2xl"></i></div>`,
            photoData: null
        };
        
        let learningProgress = {
            zakatFitrah: {
                pengertian: 0,
                ketentuan: 0,
                praktik: 0
            }
        };
        
        let materialProgress = {
            zakatFitrah: {
                pengertian: {
                    definisi: 0,
                    dalil: 0
                },
                ketentuan: {
                    syarat_wajib: 0,
                    takaran_waktu: 0
                },
                praktik: {
                    cara_hitung: 0,
                    cara_salur: 0
                }
            }
        };
        
        let quizResults = {
            zakatFitrah: {
                pengertian: [],
                ketentuan: [],
                praktik: []
            }
        };
        
        let studyStartTime = null;
        let totalStudyTime = 0;
        let badges = [];
        let calculatorHistory = [];

        // Learning Content Data with sub-materials
        const learningContent = {
            pengertian: {
                title: 'Pengertian Zakat Fitrah',
                materials: [
                    {
                        id: 'definisi',
                        title: 'Definisi Zakat Fitrah',
                        unlocked: true,
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl">
                                    <h4 class="text-xl font-bold text-blue-800 mb-4">
                                        <i class="fas fa-search mr-2"></i>Apa itu Zakat Fitrah?
                                    </h4>
                                    <p class="text-gray-700 leading-relaxed mb-4">
                                        Zakat fitrah adalah zakat yang wajib dikeluarkan oleh setiap Muslim yang mampu pada bulan Ramadan. 
                                        Kata "fitrah" berasal dari bahasa Arab yang berarti "sifat dasar" atau "kesucian".
                                    </p>
                                    <div class="bg-white p-4 rounded-xl border-l-4 border-blue-500">
                                        <p class="text-blue-800 font-medium">
                                            <i class="fas fa-lightbulb mr-2"></i>
                                            Zakat fitrah bertujuan untuk mensucikan jiwa dari sifat kikir dan membantu fakir miskin.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        id: 'dalil',
                        title: 'Dalil Al-Quran dan Hadits',
                        unlocked: false,
                        requiredScore: 70,
                        requiredMaterial: 'definisi',
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl">
                                    <h4 class="text-xl font-bold text-green-800 mb-4">
                                        <i class="fas fa-book-open mr-2"></i>Dalil Al-Quran dan Hadits
                                    </h4>
                                    <div class="bg-white p-4 rounded-xl mb-4">
                                        <p class="arabic-text text-green-800 font-bold mb-2">Ù‚ÙØ¯Ù’ Ø£ÙÙÙ’Ù„ÙØ­Ù Ù…ÙÙ†Ù’ ØªÙØ²ÙÙƒÙÙ‘Ù‰</p>
                                        <p class="text-center italic text-gray-700">"Sungguh beruntung orang yang membersihkan diri (dengan zakat)"</p>
                                        <p class="text-center text-sm text-gray-500">(QS. Al-A'la: 14)</p>
                                    </div>
                                    <div class="bg-white p-4 rounded-xl">
                                        <p class="arabic-text text-green-800 font-bold mb-2">ÙÙØ±ÙØ¶Ù Ø±ÙØ³ÙÙˆÙ„Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù… Ø²ÙÙƒÙØ§Ø©Ù Ø§Ù„Ù’ÙÙØ·Ù’Ø±Ù</p>
                                        <p class="text-center italic text-gray-700">"Rasulullah SAW mewajibkan zakat fitrah"</p>
                                        <p class="text-center text-sm text-gray-500">(HR. Bukhari Muslim)</p>
                                    </div>
                                </div>
                            </div>
                        `
                    }
                ],
                content: '', // Will be generated dynamically
                quiz: [
                    {
                        question: "Apa arti kata 'fitrah' dalam zakat fitrah?",
                        options: ["Kewajiban", "Sifat dasar/kesucian", "Pemberian", "Ibadah"],
                        correct: 1,
                        explanation: "Fitrah berasal dari bahasa Arab yang berarti sifat dasar atau kesucian."
                    },
                    {
                        question: "Kapan zakat fitrah wajib dikeluarkan?",
                        options: ["Setiap bulan", "Bulan Ramadan", "Setelah Idul Fitri", "Kapan saja"],
                        correct: 1,
                        explanation: "Zakat fitrah wajib dikeluarkan pada bulan Ramadan, sebelum shalat Idul Fitri."
                    },
                    {
                        question: "Siapa yang wajib mengeluarkan zakat fitrah?",
                        options: ["Hanya orang kaya", "Semua Muslim yang mampu", "Hanya kepala keluarga", "Hanya orang dewasa"],
                        correct: 1,
                        explanation: "Setiap Muslim yang mampu wajib mengeluarkan zakat fitrah, termasuk untuk anggota keluarganya."
                    },
                    {
                        question: "Apa tujuan utama zakat fitrah?",
                        options: ["Menambah harta", "Mensucikan jiwa dan membantu fakir miskin", "Mengurangi pajak", "Tradisi keluarga"],
                        correct: 1,
                        explanation: "Zakat fitrah bertujuan untuk mensucikan jiwa dari sifat kikir dan membantu fakir miskin."
                    },
                    {
                        question: "Dalam Al-Quran, ayat mana yang menyebutkan tentang kesuksesan orang yang berzakat?",
                        options: ["Al-Baqarah: 43", "Al-A'la: 14", "At-Taubah: 103", "Al-Mu'minun: 4"],
                        correct: 1,
                        explanation: "QS. Al-A'la ayat 14: 'Sungguh beruntung orang yang membersihkan diri (dengan zakat)'"
                    },
                    {
                        question: "Zakat fitrah disebut juga dengan nama?",
                        options: ["Zakat mal", "Zakat nafs", "Zakat harta", "Zakat emas"],
                        correct: 1,
                        explanation: "Zakat fitrah juga disebut zakat nafs (zakat jiwa) karena untuk mensucikan jiwa."
                    },
                    {
                        question: "Apa hikmah zakat fitrah bagi yang mengeluarkannya?",
                        options: ["Menambah rezeki", "Mensucikan jiwa dari kikir", "Mendapat pujian", "Mengurangi beban"],
                        correct: 1,
                        explanation: "Hikmah utama zakat fitrah adalah mensucikan jiwa dari sifat kikir dan bakhil."
                    },
                    {
                        question: "Zakat fitrah berbeda dengan zakat mal dalam hal?",
                        options: ["Jumlahnya", "Waktunya", "Penerimanya", "Semua benar"],
                        correct: 3,
                        explanation: "Zakat fitrah berbeda dari zakat mal dalam jumlah, waktu pembayaran, dan ketentuan penerimanya."
                    },
                    {
                        question: "Apa yang terjadi jika seseorang tidak mengeluarkan zakat fitrah?",
                        options: ["Tidak apa-apa", "Dosanya ringan", "Berdosa dan puasanya tidak sempurna", "Hanya makruh"],
                        correct: 2,
                        explanation: "Tidak mengeluarkan zakat fitrah adalah dosa dan dapat membuat puasa Ramadan tidak sempurna."
                    },
                    {
                        question: "Dalam hadits, Rasulullah SAW mewajibkan zakat fitrah untuk?",
                        options: ["Mensucikan puasa", "Memberi makan fakir miskin", "Keduanya benar", "Menambah pahala"],
                        correct: 2,
                        explanation: "Hadits menyebutkan zakat fitrah untuk mensucikan puasa dari perbuatan sia-sia dan memberi makan fakir miskin."
                    }
                ]
            },
            ketentuan: {
                title: 'Ketentuan dan Syarat Zakat Fitrah',
                materials: [
                    {
                        id: 'syarat_wajib',
                        title: 'Syarat Wajib Zakat Fitrah',
                        unlocked: true,
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-2xl">
                                    <h4 class="text-xl font-bold text-purple-800 mb-4">
                                        <i class="fas fa-users mr-2"></i>Siapa yang Wajib Zakat Fitrah?
                                    </h4>
                                    <div class="bg-white p-4 rounded-xl border-l-4 border-green-500">
                                        <h5 class="font-bold text-green-800 mb-2">Syarat Wajib:</h5>
                                        <ul class="space-y-2 text-sm">
                                            <li><i class="fas fa-check text-green-500 mr-2"></i>Beragama Islam</li>
                                            <li><i class="fas fa-check text-green-500 mr-2"></i>Hidup pada akhir Ramadan</li>
                                            <li><i class="fas fa-check text-green-500 mr-2"></i>Memiliki kelebihan makanan</li>
                                            <li><i class="fas fa-check text-green-500 mr-2"></i>Merdeka (bukan budak)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        id: 'takaran_waktu',
                        title: 'Takaran dan Waktu Pembayaran',
                        unlocked: false,
                        requiredScore: 70,
                        requiredMaterial: 'syarat_wajib',
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-2xl">
                                    <h4 class="text-xl font-bold text-orange-800 mb-4">
                                        <i class="fas fa-balance-scale mr-2"></i>Takaran dan Waktu
                                    </h4>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div class="bg-white p-4 rounded-xl border-l-4 border-orange-500">
                                            <h5 class="font-bold text-orange-800 mb-2">Takaran:</h5>
                                            <p class="text-lg font-bold text-orange-700">1 Sha' = 2,5 kg beras</p>
                                            <p class="text-sm text-gray-600">Per orang dalam keluarga</p>
                                        </div>
                                        <div class="bg-white p-4 rounded-xl border-l-4 border-blue-500">
                                            <h5 class="font-bold text-blue-800 mb-2">Waktu:</h5>
                                            <p class="text-sm text-blue-700">â€¢ Mulai terbenam matahari akhir Ramadan</p>
                                            <p class="text-sm text-blue-700">â€¢ Sebelum shalat Idul Fitri</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    }
                ],
                content: '', // Will be generated dynamically
                quiz: [
                    {
                        question: "Berapa takaran zakat fitrah per orang?",
                        options: ["1 kg", "2 kg", "2,5 kg", "3 kg"],
                        correct: 2,
                        explanation: "Takaran zakat fitrah adalah 1 sha' atau sekitar 2,5 kg makanan pokok per orang."
                    },
                    {
                        question: "Apa syarat utama seseorang wajib zakat fitrah?",
                        options: ["Kaya raya", "Muslim dan mampu", "Dewasa saja", "Punya rumah"],
                        correct: 1,
                        explanation: "Syarat utama adalah beragama Islam dan mampu (memiliki kelebihan makanan untuk sehari)."
                    },
                    {
                        question: "Kapan batas akhir pembayaran zakat fitrah?",
                        options: ["Sebelum shalat Idul Fitri", "Setelah shalat Id", "Akhir Ramadan", "Kapan saja"],
                        correct: 0,
                        explanation: "Zakat fitrah harus dibayar sebelum shalat Idul Fitri dimulai."
                    },
                    {
                        question: "Siapa yang berhak menerima zakat fitrah?",
                        options: ["Semua orang", "8 golongan mustahiq", "Hanya fakir miskin", "Keluarga sendiri"],
                        correct: 2,
                        explanation: "Zakat fitrah khusus untuk fakir miskin, berbeda dengan zakat mal yang untuk 8 golongan."
                    },
                    {
                        question: "Jika seseorang meninggal sebelum maghrib akhir Ramadan, apakah wajib zakat fitrah?",
                        options: ["Tetap wajib", "Tidak wajib", "Terserah keluarga", "Setengah saja"],
                        correct: 1,
                        explanation: "Tidak wajib karena syarat wajib adalah hidup pada akhir Ramadan (maghrib terakhir)."
                    },
                    {
                        question: "Bolehkah zakat fitrah dibayar dengan uang?",
                        options: ["Tidak boleh", "Boleh dengan syarat", "Selalu boleh", "Hanya di kota"],
                        correct: 1,
                        explanation: "Boleh dengan syarat setara nilai makanan pokok dan lebih bermanfaat bagi penerima."
                    },
                    {
                        question: "Apa yang dimaksud dengan 1 sha' dalam takaran zakat fitrah?",
                        options: ["1 kg", "2 kg", "2,5 kg", "3 kg"],
                        correct: 2,
                        explanation: "1 sha' setara dengan sekitar 2,5 kg makanan pokok seperti beras atau gandum."
                    },
                    {
                        question: "Apakah bayi yang baru lahir wajib zakat fitrah?",
                        options: ["Tidak wajib", "Wajib jika lahir sebelum maghrib akhir Ramadan", "Wajib setelah 1 tahun", "Terserah orangtua"],
                        correct: 1,
                        explanation: "Bayi wajib zakat fitrah jika lahir sebelum maghrib akhir Ramadan."
                    },
                    {
                        question: "Bolehkah zakat fitrah diberikan kepada keluarga sendiri?",
                        options: ["Boleh untuk semua keluarga", "Tidak boleh sama sekali", "Boleh kecuali yang menjadi tanggungan", "Hanya untuk saudara"],
                        correct: 2,
                        explanation: "Tidak boleh diberikan kepada yang menjadi tanggungan (istri, anak), tapi boleh untuk saudara yang membutuhkan."
                    },
                    {
                        question: "Apa hukum menunda pembayaran zakat fitrah setelah Idul Fitri?",
                        options: ["Sah dan tidak apa-apa", "Tetap sah tapi berdosa", "Tidak sah", "Harus bayar denda"],
                        correct: 1,
                        explanation: "Tetap sah sebagai sedekah biasa, tapi berdosa karena terlambat dan tidak mendapat pahala zakat fitrah."
                    }
                ]
            },
            praktik: {
                title: 'Praktik dan Implementasi Zakat Fitrah',
                materials: [
                    {
                        id: 'cara_hitung',
                        title: 'Cara Menghitung Zakat Fitrah',
                        unlocked: true,
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-2xl">
                                    <h4 class="text-xl font-bold text-indigo-800 mb-4">
                                        <i class="fas fa-calculator mr-2"></i>Cara Menghitung Zakat Fitrah
                                    </h4>
                                    <div class="bg-white p-4 rounded-xl">
                                        <h5 class="font-bold mb-2">Contoh Perhitungan Keluarga 4 Orang:</h5>
                                        <p class="text-lg">4 orang Ã— 2,5 kg = <span class="font-bold text-indigo-600">10 kg beras</span></p>
                                        <p class="text-sm text-gray-600">Atau setara uang: 4 Ã— Rp 37.500 = Rp 150.000</p>
                                    </div>
                                    <div class="bg-white p-4 rounded-xl mt-4">
                                        <h5 class="font-bold mb-2">Rumus Sederhana:</h5>
                                        <p class="text-sm">Jumlah Anggota Keluarga Ã— 2,5 kg Ã— Harga Beras per kg</p>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        id: 'cara_salur',
                        title: 'Cara Menyalurkan Zakat Fitrah',
                        unlocked: false,
                        requiredScore: 70,
                        requiredMaterial: 'cara_hitung',
                        content: `
                            <div class="space-y-6">
                                <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl">
                                    <h4 class="text-xl font-bold text-green-800 mb-4">
                                        <i class="fas fa-hand-holding-heart mr-2"></i>Cara Menyalurkan
                                    </h4>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div class="bg-white p-4 rounded-xl">
                                            <h5 class="font-bold text-green-700 mb-2">
                                                <i class="fas fa-mosque mr-2"></i>Melalui Masjid
                                            </h5>
                                            <ul class="text-sm space-y-1">
                                                <li>â€¢ Mudah dan praktis</li>
                                                <li>â€¢ Ada bukti penyerahan</li>
                                                <li>â€¢ Distribusi merata</li>
                                                <li>â€¢ Terpercaya</li>
                                            </ul>
                                        </div>
                                        <div class="bg-white p-4 rounded-xl">
                                            <h5 class="font-bold text-green-700 mb-2">
                                                <i class="fas fa-handshake mr-2"></i>Langsung ke Mustahiq
                                            </h5>
                                            <ul class="text-sm space-y-1">
                                                <li>â€¢ Lebih personal</li>
                                                <li>â€¢ Tahu penerima pasti</li>
                                                <li>â€¢ Pilih yang membutuhkan</li>
                                                <li>â€¢ Pahala lebih besar</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    }
                ],
                content: '', // Will be generated dynamically
                quiz: [
                    {
                        question: "Keluarga 5 orang harus mengeluarkan zakat fitrah sebanyak:",
                        options: ["10 kg", "12,5 kg", "15 kg", "20 kg"],
                        correct: 1,
                        explanation: "5 orang Ã— 2,5 kg = 12,5 kg beras untuk zakat fitrah."
                    },
                    {
                        question: "Jika harga beras Rp 15.000/kg, berapa zakat fitrah untuk 1 orang dalam bentuk uang?",
                        options: ["Rp 30.000", "Rp 37.500", "Rp 40.000", "Rp 45.000"],
                        correct: 1,
                        explanation: "2,5 kg Ã— Rp 15.000 = Rp 37.500 untuk zakat fitrah 1 orang."
                    },
                    {
                        question: "Manakah cara terbaik menyalurkan zakat fitrah?",
                        options: ["Melalui media sosial", "Langsung ke mustahiq atau melalui amil", "Ditabung dulu", "Diberikan ke tetangga kaya"],
                        correct: 1,
                        explanation: "Cara terbaik adalah langsung ke mustahiq (fakir miskin) atau melalui amil zakat terpercaya."
                    },
                    {
                        question: "Kapan waktu terbaik mengeluarkan zakat fitrah?",
                        options: ["Awal Ramadan", "Pertengahan Ramadan", "Beberapa hari sebelum Idul Fitri", "Setelah Idul Fitri"],
                        correct: 2,
                        explanation: "Waktu terbaik adalah beberapa hari sebelum Idul Fitri agar fakir miskin bisa merayakan Idul Fitri."
                    },
                    {
                        question: "Jika keluarga 6 orang dengan harga beras Rp 12.000/kg, total zakat fitrah dalam uang adalah:",
                        options: ["Rp 150.000", "Rp 180.000", "Rp 200.000", "Rp 220.000"],
                        correct: 1,
                        explanation: "6 orang Ã— 2,5 kg Ã— Rp 12.000 = Rp 180.000"
                    },
                    {
                        question: "Apa yang harus dilakukan jika lupa membayar zakat fitrah sebelum shalat Id?",
                        options: ["Tidak perlu bayar", "Bayar tahun depan", "Tetap bayar sebagai sedekah", "Bayar setengah saja"],
                        correct: 2,
                        explanation: "Tetap harus dibayar meskipun terlambat, namun statusnya menjadi sedekah biasa."
                    },
                    {
                        question: "Bolehkah zakat fitrah dikumpulkan untuk membeli kebutuhan yang lebih besar?",
                        options: ["Tidak boleh", "Boleh dengan persetujuan mustahiq", "Selalu boleh", "Hanya untuk pendidikan"],
                        correct: 1,
                        explanation: "Boleh jika ada persetujuan dari mustahiq dan lebih bermanfaat, seperti untuk modal usaha."
                    },
                    {
                        question: "Apa yang dimaksud dengan 'amil zakat' dalam penyaluran zakat fitrah?",
                        options: ["Penerima zakat", "Pengelola/penyalur zakat", "Pemberi zakat", "Saksi zakat"],
                        correct: 1,
                        explanation: "Amil zakat adalah orang atau lembaga yang bertugas mengumpulkan dan menyalurkan zakat."
                    },
                    {
                        question: "Jika ada keluarga miskin yang juga Muslim, apakah mereka tetap wajib zakat fitrah?",
                        options: ["Tidak wajib", "Wajib jika punya makanan lebih", "Wajib setengah takaran", "Terserah kemampuan"],
                        correct: 1,
                        explanation: "Tetap wajib jika memiliki kelebihan makanan untuk sehari, meskipun dalam kondisi miskin."
                    },
                    {
                        question: "Apa hikmah membayar zakat fitrah sebelum shalat Idul Fitri?",
                        options: ["Agar tidak lupa", "Supaya fakir miskin bisa ikut bergembira di Idul Fitri", "Tradisi turun temurun", "Lebih mudah"],
                        correct: 1,
                        explanation: "Agar fakir miskin juga bisa merasakan kegembiraan dan ikut merayakan Idul Fitri dengan layak."
                    }
                ]
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            checkUserProfile();
            setupAvatarSelection();
            setupProfileForm();
            loadProgress();
            updateStudyTime();
            renderLearningModules();
            loadUnlockStatus();
        });
        
        // Load unlock status on page load
        function loadUnlockStatus() {
            const zakatProgress = Object.values(learningProgress.zakatFitrah);
            const avgZakatProgress = zakatProgress.reduce((a, b) => a + b, 0) / zakatProgress.length;
            
            console.log('Loading unlock status, avgZakatProgress:', avgZakatProgress);
            
            // Check and apply unlock status without notifications
            if (avgZakatProgress >= 70) {
                unlockMainMenuSilent('infak', 'Infak');
            }
            if (avgZakatProgress >= 80) {
                unlockMainMenuSilent('sedekah', 'Sedekah');
            }
            if (avgZakatProgress >= 90) {
                unlockMainMenuSilent('qurban', 'Qurban');
            }
        }
        
        // Unlock menu without notification (for page load)
        function unlockMainMenuSilent(menuId, menuName) {
            console.log('Unlocking menu silently:', menuId);
            const menuElement = document.getElementById(menuId + 'Menu');
            const dashboardElement = document.getElementById(menuId + 'Dashboard');
            
            // Unlock navigation menu
            if (menuElement) {
                console.log('Menu element found, current classes:', menuElement.className);
                
                if (menuElement.classList.contains('opacity-50')) {
                    menuElement.classList.remove('opacity-50', 'cursor-not-allowed');
                    menuElement.classList.add('cursor-pointer');
                    
                    // Remove lock icon and update content
                    if (menuId === 'infak') {
                        menuElement.innerHTML = '<i class="fas fa-hand-holding-heart mr-1 md:mr-2"></i>Infak';
                    } else if (menuId === 'sedekah') {
                        menuElement.innerHTML = '<i class="fas fa-heart mr-1 md:mr-2"></i>Sedekah';
                    } else if (menuId === 'qurban') {
                        menuElement.innerHTML = '<i class="fas fa-cow mr-1 md:mr-2"></i>Qurban';
                    }
                    
                    // Change onclick behavior
                    menuElement.setAttribute('onclick', `showComingSoon('${menuName}')`);
                    console.log('Menu unlocked:', menuId);
                }
            }
            
            // Unlock dashboard card
            if (dashboardElement) {
                console.log('Dashboard element found, current classes:', dashboardElement.className);
                
                if (dashboardElement.classList.contains('opacity-50')) {
                    dashboardElement.classList.remove('opacity-50');
                    dashboardElement.classList.add('cursor-pointer');
                    
                    // Remove lock icon from dashboard
                    const dashboardLockIcon = dashboardElement.querySelector('.fa-lock');
                    if (dashboardLockIcon) {
                        dashboardLockIcon.remove();
                    }
                    
                    // Update progress text
                    const progressText = dashboardElement.querySelector('div:last-child');
                    if (progressText) {
                        progressText.innerHTML = `<i class="fas fa-play mr-1"></i>Siap untuk dipelajari!`;
                        progressText.className = 'mt-2 md:mt-4 text-xs text-green-600 font-medium';
                    }
                    
                    // Update progress indicator
                    const progressSpan = dashboardElement.querySelector('.font-bold');
                    if (progressSpan && progressSpan.textContent === 'ğŸ”’') {
                        progressSpan.textContent = 'âœ…';
                    }
                    
                    console.log('Dashboard unlocked:', menuId);
                }
            }
        }
        
        // Render learning modules with lock system
        function renderLearningModules() {
            console.log('Rendering modules, current progress:', learningProgress.zakatFitrah);
            
            const modules = [
                {
                    id: 'pengertian',
                    title: 'Pengertian',
                    description: 'Memahami definisi dan dasar hukum zakat fitrah',
                    icon: 'fas fa-search',
                    color: 'blue',
                    unlocked: true
                },
                {
                    id: 'ketentuan',
                    title: 'Ketentuan',
                    description: 'Syarat, rukun, dan ketentuan zakat fitrah',
                    icon: 'fas fa-balance-scale',
                    color: 'green',
                    unlocked: (learningProgress.zakatFitrah.pengertian || 0) >= 70
                },
                {
                    id: 'praktik',
                    title: 'Praktik',
                    description: 'Cara menghitung dan menyalurkan zakat fitrah',
                    icon: 'fas fa-hand-holding-heart',
                    color: 'purple',
                    unlocked: (learningProgress.zakatFitrah.ketentuan || 0) >= 70
                }
            ];
            
            console.log('Module unlock status:', modules.map(m => ({id: m.id, unlocked: m.unlocked})));
            
            const container = document.getElementById('learningModules');
            container.innerHTML = modules.map(module => {
                const progress = learningProgress.zakatFitrah[module.id] || 0;
                const isLocked = !module.unlocked;
                
                return `
                    <div class="bg-gradient-to-br from-${module.color}-50 to-${module.color}-100 p-4 md:p-6 rounded-2xl card-hover ${isLocked ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}" 
                         ${!isLocked ? `onclick="startLearning('${module.id}')"` : `onclick="showLockedMessage('${module.id}')"`}>
                        <div class="text-3xl md:text-4xl mb-3 md:mb-4 relative">
                            <i class="${module.icon} text-${module.color}-500"></i>
                            ${isLocked ? '<i class="fas fa-lock absolute -top-1 -right-1 md:-top-2 md:-right-2 text-gray-400 text-sm md:text-lg"></i>' : ''}
                        </div>
                        <h3 class="text-lg md:text-xl font-bold text-${module.color}-800 mb-2">${module.title}</h3>
                        <p class="text-${module.color}-700 text-xs md:text-sm mb-3 md:mb-4">${module.description}</p>
                        
                        ${progress > 0 ? `
                            <div class="mb-3 md:mb-4">
                                <div class="flex justify-between text-xs text-${module.color}-600 mb-1">
                                    <span>Progress</span>
                                    <span>${progress}%</span>
                                </div>
                                <div class="w-full bg-white rounded-full h-2">
                                    <div class="bg-gradient-to-r from-${module.color}-400 to-${module.color}-600 h-2 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-${module.color}-600 font-medium">10 Soal Kuis</span>
                            <div class="w-6 h-6 md:w-8 md:h-8 bg-${module.color}-500 rounded-full flex items-center justify-center">
                                ${isLocked ? 
                                    '<i class="fas fa-lock text-white text-xs md:text-sm"></i>' : 
                                    progress >= 70 ? '<i class="fas fa-check text-white text-xs md:text-sm"></i>' : '<i class="fas fa-play text-white text-xs md:text-sm"></i>'
                                }
                            </div>
                        </div>
                        
                        ${isLocked ? `
                            <div class="mt-2 md:mt-3 text-xs text-gray-500 text-center">
                                <i class="fas fa-info-circle mr-1"></i>
                                Selesaikan ${module.id === 'ketentuan' ? 'Pengertian' : 'Ketentuan'} dulu (min. 70%)
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Show locked message
        function showLockedMessage(moduleId) {
            let requiredModule = '';
            if (moduleId === 'ketentuan') {
                requiredModule = 'Pengertian';
            } else if (moduleId === 'praktik') {
                requiredModule = 'Ketentuan';
            }
            
            Swal.fire({
                icon: 'warning',
                title: 'Modul Terkunci ğŸ”’',
                html: `
                    <div class="text-center">
                        <p class="mb-4">Untuk membuka modul ini, kamu harus:</p>
                        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                            <i class="fas fa-trophy text-yellow-500 text-2xl mb-2"></i>
                            <p class="text-yellow-800 font-bold">Selesaikan modul "${requiredModule}"</p>
                            <p class="text-yellow-700 text-sm">dengan skor minimal 70%</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-4">Skor saat ini: ${learningProgress.zakatFitrah[moduleId === 'ketentuan' ? 'pengertian' : 'ketentuan'] || 0}%</p>
                    </div>
                `,
                confirmButtonText: 'Mengerti',
                confirmButtonColor: '#f59e0b'
            });
        }

        // Check if user profile exists
        function checkUserProfile() {
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                userProfile = JSON.parse(savedProfile);
                updateUserDisplay();
                document.getElementById('welcomeForm').style.display = 'none';
            }
        }

        // Setup photo upload and avatar selection
        function setupAvatarSelection() {
            // Photo upload functionality
            const photoInput = document.getElementById('photoInput');
            const photoPreview = document.getElementById('photoPreview');
            const photoPlaceholder = document.getElementById('photoPlaceholder');
            
            photoInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Check file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'File Terlalu Besar',
                            text: 'Ukuran foto maksimal 5MB',
                            confirmButtonColor: '#f59e0b'
                        });
                        return;
                    }
                    
                    // Check file type
                    if (!file.type.startsWith('image/')) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Format File Salah',
                            text: 'Hanya file gambar (JPG, PNG) yang diperbolehkan',
                            confirmButtonColor: '#f59e0b'
                        });
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        userProfile.photoData = e.target.result;
                        userProfile.avatar = 'uploaded';
                        userProfile.avatarSvg = `<img src="${e.target.result}" alt="Foto Siswa" class="w-full h-full object-cover">`;
                        
                        // Update preview
                        photoPreview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover">`;
                        photoPreview.classList.remove('border-dashed', 'border-gray-300');
                        photoPreview.classList.add('border-solid', 'border-green-400');
                        
                        // Clear default avatar selections
                        document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Foto Berhasil Diupload!',
                            text: 'Foto profil Anda telah diperbarui',
                            confirmButtonColor: '#10b981',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Default avatar selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Clear photo upload
                    userProfile.photoData = null;
                    photoInput.value = '';
                    photoPreview.innerHTML = photoPlaceholder.outerHTML;
                    photoPreview.classList.remove('border-solid', 'border-green-400');
                    photoPreview.classList.add('border-dashed', 'border-gray-300');
                    
                    // Select avatar
                    document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    userProfile.avatar = this.dataset.avatar;
                    
                    // Set avatar SVG based on selection
                    const avatarType = this.dataset.avatar;
                    const avatarIcons = {
                        'default1': '<div class="w-full h-full bg-blue-100 flex items-center justify-center"><i class="fas fa-user text-blue-500 text-2xl"></i></div>',
                        'default2': '<div class="w-full h-full bg-pink-100 flex items-center justify-center"><i class="fas fa-user-graduate text-pink-500 text-2xl"></i></div>',
                        'default3': '<div class="w-full h-full bg-green-100 flex items-center justify-center"><i class="fas fa-child text-green-500 text-2xl"></i></div>'
                    };
                    
                    userProfile.avatarSvg = avatarIcons[avatarType] || avatarIcons['default1'];
                });
            });
        }

        // Setup profile form
        function setupProfileForm() {
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('userName').value.trim();
                const userClass = document.getElementById('userClass').value;
                
                if (!name || !userClass || (!userProfile.photoData && !userProfile.avatar)) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Data Belum Lengkap',
                        text: 'Mohon lengkapi nama, kelas, dan foto/avatar',
                        confirmButtonColor: '#3b82f6'
                    });
                    return;
                }
                
                userProfile.name = name;
                userProfile.class = userClass;
                
                localStorage.setItem('userProfile', JSON.stringify(userProfile));
                
                Swal.fire({
                    icon: 'success',
                    title: 'Selamat Datang!',
                    text: `Halo ${name}, selamat belajar!`,
                    confirmButtonColor: '#3b82f6'
                }).then(() => {
                    document.getElementById('welcomeForm').style.display = 'none';
                    updateUserDisplay();
                    startStudyTimer();
                });
            });
        }

        // Update user display
        function updateUserDisplay() {
            // Update desktop profile
            document.getElementById('userAvatar').innerHTML = userProfile.avatarSvg;
            document.getElementById('userNameDisplay').textContent = userProfile.name;
            document.getElementById('userClassDisplay').textContent = `Kelas ${userProfile.class}`;
            
            // Update mobile profile
            document.getElementById('userAvatarMobile').innerHTML = userProfile.avatarSvg;
            document.getElementById('userNameDisplayMobile').textContent = userProfile.name;
            document.getElementById('userClassDisplayMobile').textContent = `Kelas ${userProfile.class}`;
            
            updateUserProgress();
        }
        
        // Update user progress in header
        function updateUserProgress() {
            const zakatProgress = Object.values(learningProgress.zakatFitrah);
            const avgProgress = zakatProgress.reduce((a, b) => a + b, 0) / zakatProgress.length;
            const roundedProgress = Math.round(avgProgress);
            
            // Update desktop progress
            document.getElementById('userProgressBar').style.width = roundedProgress + '%';
            document.getElementById('userProgressText').textContent = roundedProgress + '%';
            
            // Update mobile progress
            document.getElementById('userProgressBarMobile').style.width = roundedProgress + '%';
            document.getElementById('userProgressTextMobile').textContent = roundedProgress + '%';
            
            // Update main menu unlock status
            updateMainMenuAccess();
        }
        
        // Update main menu access based on progress
        function updateMainMenuAccess() {
            const zakatProgress = Object.values(learningProgress.zakatFitrah);
            const avgZakatProgress = zakatProgress.reduce((a, b) => a + b, 0) / zakatProgress.length;
            
            console.log('Updating main menu access, avgZakatProgress:', avgZakatProgress);
            
            // Unlock Infak when Zakat Fitrah completed (70%+)
            if (avgZakatProgress >= 70) {
                unlockMainMenu('infak', 'Infak');
            }
            
            // Unlock Sedekah when Infak completed (placeholder - would need infak progress)
            // For demo, unlock when Zakat reaches 80%
            if (avgZakatProgress >= 80) {
                unlockMainMenu('sedekah', 'Sedekah');
            }
            
            // Unlock Qurban when Sedekah completed (placeholder - would need sedekah progress)
            // For demo, unlock when Zakat reaches 90%
            if (avgZakatProgress >= 90) {
                unlockMainMenu('qurban', 'Qurban');
            }
        }
        
        // Unlock specific main menu
        function unlockMainMenu(menuId, menuName) {
            console.log('Attempting to unlock main menu:', menuId);
            const menuElement = document.getElementById(menuId + 'Menu');
            const dashboardElement = document.getElementById(menuId + 'Dashboard');
            
            // Unlock navigation menu
            if (menuElement) {
                console.log('Menu element found, checking if locked:', menuElement.classList.contains('opacity-50'));
                
                if (menuElement.classList.contains('opacity-50')) {
                    menuElement.classList.remove('opacity-50', 'cursor-not-allowed');
                    menuElement.classList.add('cursor-pointer');
                    
                    // Update menu content
                    if (menuId === 'infak') {
                        menuElement.innerHTML = '<i class="fas fa-hand-holding-heart mr-1 md:mr-2"></i>Infak';
                    } else if (menuId === 'sedekah') {
                        menuElement.innerHTML = '<i class="fas fa-heart mr-1 md:mr-2"></i>Sedekah';
                    } else if (menuId === 'qurban') {
                        menuElement.innerHTML = '<i class="fas fa-cow mr-1 md:mr-2"></i>Qurban';
                    }
                    
                    // Change onclick behavior
                    menuElement.setAttribute('onclick', `showComingSoon('${menuName}')`);
                    console.log('Menu navigation unlocked:', menuId);
                }
            }
            
            // Unlock dashboard card
            if (dashboardElement) {
                console.log('Dashboard element found, checking if locked:', dashboardElement.classList.contains('opacity-50'));
                
                if (dashboardElement.classList.contains('opacity-50')) {
                    dashboardElement.classList.remove('opacity-50');
                    dashboardElement.classList.add('cursor-pointer');
                    
                    // Remove lock icon from dashboard
                    const dashboardLockIcon = dashboardElement.querySelector('.fa-lock');
                    if (dashboardLockIcon) {
                        dashboardLockIcon.remove();
                    }
                    
                    // Update progress text - find the last div which contains the lock message
                    const progressText = dashboardElement.querySelector('div:last-child');
                    if (progressText) {
                        progressText.innerHTML = `<i class="fas fa-play mr-1"></i>Siap untuk dipelajari!`;
                        progressText.className = 'mt-2 md:mt-4 text-xs text-green-600 font-medium';
                    }
                    
                    // Update progress indicator
                    const progressSpan = dashboardElement.querySelector('.font-bold');
                    if (progressSpan && progressSpan.textContent === 'ğŸ”’') {
                        progressSpan.textContent = 'âœ…';
                    }
                    
                    console.log('Dashboard card unlocked:', menuId);
                    
                    // Add unlock notification (only once)
                    if (!localStorage.getItem(`${menuId}Unlocked`)) {
                        localStorage.setItem(`${menuId}Unlocked`, 'true');
                        
                        Swal.fire({
                            icon: 'success',
                            title: `Menu ${menuName} Terbuka! ğŸ‰`,
                            html: `
                                <div class="text-center">
                                    <i class="fas fa-unlock text-green-500 text-4xl mb-4"></i>
                                    <p class="mb-4">Selamat! Kamu telah membuka menu <strong>${menuName}</strong></p>
                                    <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                                        <p class="text-green-700 font-bold">Menu baru tersedia untuk dipelajari!</p>
                                        <p class="text-green-600 text-sm">Lanjutkan perjalanan belajar Fikih-mu</p>
                                    </div>
                                </div>
                            `,
                            confirmButtonText: 'Siap!',
                            confirmButtonColor: '#10b981',
                            timer: 5000
                        });
                    }
                }
            }
        }
        
        // Show coming soon message for unlocked but not implemented menus
        function showComingSoon(menuName) {
            Swal.fire({
                icon: 'success',
                title: `Selamat! Menu ${menuName} Terbuka! ğŸ‰`,
                html: `
                    <div class="text-center">
                        <i class="fas fa-unlock text-green-500 text-4xl mb-4"></i>
                        <p class="mb-4">Kamu berhasil membuka menu <strong>${menuName}</strong>!</p>
                        <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                            <i class="fas fa-graduation-cap text-green-500 text-2xl mb-2"></i>
                            <p class="text-green-700 font-bold">Materi ${menuName} Siap Dipelajari!</p>
                            <p class="text-green-600 text-sm">Klik menu ${menuName} untuk mulai belajar materi baru</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-4">Lanjutkan perjalanan belajar Fikih-mu! ğŸ“šâœ¨</p>
                    </div>
                `,
                confirmButtonText: 'Siap Belajar!',
                confirmButtonColor: '#10b981'
            });
        }
        
        // Check menu access when clicked
        function checkMenuAccess(menuType) {
            const zakatProgress = Object.values(learningProgress.zakatFitrah);
            const avgZakatProgress = zakatProgress.reduce((a, b) => a + b, 0) / zakatProgress.length;
            
            let requiredProgress = 0;
            let requiredMenu = '';
            let menuTitle = '';
            
            switch(menuType) {
                case 'infak':
                    requiredProgress = 70;
                    requiredMenu = 'Zakat Fitrah';
                    menuTitle = 'Infak';
                    break;
                case 'sedekah':
                    requiredProgress = 80;
                    requiredMenu = 'Zakat Fitrah';
                    menuTitle = 'Sedekah';
                    break;
                case 'qurban':
                    requiredProgress = 90;
                    requiredMenu = 'Zakat Fitrah';
                    menuTitle = 'Qurban';
                    break;
            }
            
            if (avgZakatProgress < requiredProgress) {
                Swal.fire({
                    icon: 'warning',
                    title: `Menu ${menuTitle} Terkunci ğŸ”’`,
                    html: `
                        <div class="text-center">
                            <p class="mb-4">Untuk membuka menu <strong>${menuTitle}</strong>, kamu harus:</p>
                            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                                <i class="fas fa-trophy text-yellow-500 text-2xl mb-2"></i>
                                <p class="text-yellow-800 font-bold">Selesaikan "${requiredMenu}"</p>
                                <p class="text-yellow-700 text-sm">dengan skor minimal ${requiredProgress}%</p>
                            </div>
                            <p class="text-sm text-gray-600 mt-4">Progress saat ini: ${Math.round(avgZakatProgress)}%</p>
                            <div class="w-full bg-gray-200 rounded-full h-3 mt-2">
                                <div class="bg-gradient-to-r from-yellow-400 to-yellow-600 h-3 rounded-full transition-all duration-500" style="width: ${avgZakatProgress}%"></div>
                            </div>
                        </div>
                    `,
                    confirmButtonText: 'Mengerti',
                    confirmButtonColor: '#f59e0b'
                });
            } else {
                // Menu should be unlocked, this shouldn't happen
                Swal.fire({
                    icon: 'info',
                    title: 'Menu Akan Segera Tersedia',
                    text: `Fitur ${menuTitle} sedang dalam pengembangan dan akan segera tersedia!`,
                    confirmButtonColor: '#3b82f6'
                });
            }
        }

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Start Learning with material system
        function startLearning(topic) {
            console.log('Starting learning for topic:', topic);
            console.log('Current progress:', learningProgress.zakatFitrah);
            
            // Check if module is unlocked
            if (topic === 'ketentuan' && (learningProgress.zakatFitrah.pengertian || 0) < 70) {
                console.log('Ketentuan locked, pengertian progress:', learningProgress.zakatFitrah.pengertian);
                Swal.fire({
                    icon: 'warning',
                    title: 'Modul Terkunci',
                    text: 'Selesaikan modul Pengertian dengan skor minimal 70% terlebih dahulu!',
                    confirmButtonColor: '#f59e0b'
                });
                return;
            }
            
            if (topic === 'praktik' && (learningProgress.zakatFitrah.ketentuan || 0) < 70) {
                console.log('Praktik locked, ketentuan progress:', learningProgress.zakatFitrah.ketentuan);
                Swal.fire({
                    icon: 'warning',
                    title: 'Modul Terkunci',
                    text: 'Selesaikan modul Ketentuan dengan skor minimal 70% terlebih dahulu!',
                    confirmButtonColor: '#f59e0b'
                });
                return;
            }
            
            const content = learningContent[topic];
            if (!content) return;
            
            document.getElementById('modalTitle').innerHTML = `
                <i class="fas fa-book-open mr-2"></i>${content.title}
            `;
            
            // Generate materials navigation
            const materialsHTML = content.materials.map((material, index) => {
                const isUnlocked = checkMaterialUnlock(topic, material);
                const progress = materialProgress.zakatFitrah[topic][material.id] || 0;
                
                return `
                    <div class="material-item ${isUnlocked ? 'cursor-pointer' : 'opacity-50 cursor-not-allowed'} p-4 border-2 ${isUnlocked ? 'border-blue-200 hover:border-blue-400' : 'border-gray-200'} rounded-xl transition-all ${isUnlocked ? 'hover:bg-blue-50' : ''}" 
                         ${isUnlocked ? `onclick="showMaterial('${topic}', '${material.id}')"` : `onclick="showMaterialLocked('${topic}', '${material.id}')"`}>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 ${isUnlocked ? 'bg-blue-500' : 'bg-gray-400'} rounded-full flex items-center justify-center mr-3">
                                    ${isUnlocked ? 
                                        (progress >= 70 ? '<i class="fas fa-check text-white text-sm"></i>' : '<i class="fas fa-play text-white text-sm"></i>') :
                                        '<i class="fas fa-lock text-white text-sm"></i>'
                                    }
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">${material.title}</div>
                                    ${progress > 0 ? `<div class="text-xs text-gray-600">Progress: ${progress}%</div>` : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                ${!isUnlocked ? '<i class="fas fa-lock text-gray-400"></i>' : ''}
                            </div>
                        </div>
                        ${progress > 0 ? `
                            <div class="mt-2">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            document.getElementById('modalContent').innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-2">Pilih Materi untuk Dipelajari</h4>
                        <p class="text-gray-600">Selesaikan setiap materi secara berurutan</p>
                    </div>
                    
                    ${materialsHTML}
                    
                    <div class="mt-8 text-center border-t pt-6">
                        <button onclick="startQuiz('${topic}')" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-blue-600 hover:to-purple-700 transition-all hover:scale-105">
                            <i class="fas fa-brain mr-2"></i>Mulai Kuis Akhir (10 Soal)
                        </button>
                        <p class="text-sm text-gray-500 mt-3">
                            <i class="fas fa-info-circle mr-1"></i>
                            Pelajari semua materi sebelum mengerjakan kuis
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('learningModal').classList.remove('hidden');
        }
        
        // Check if material is unlocked
        function checkMaterialUnlock(topic, material) {
            console.log('Checking material unlock:', topic, material.id, 'unlocked:', material.unlocked);
            
            if (material.unlocked) return true;
            
            if (material.requiredMaterial && material.requiredScore) {
                const requiredProgress = materialProgress.zakatFitrah[topic][material.requiredMaterial] || 0;
                console.log('Required material progress:', material.requiredMaterial, requiredProgress, 'needed:', material.requiredScore);
                return requiredProgress >= material.requiredScore;
            }
            
            return false;
        }
        
        // Show material content
        function showMaterial(topic, materialId) {
            const content = learningContent[topic];
            const material = content.materials.find(m => m.id === materialId);
            
            if (!material) return;
            
            document.getElementById('modalContent').innerHTML = `
                <div class="mb-4">
                    <button onclick="startLearning('${topic}')" class="text-blue-600 hover:text-blue-800 transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Kembali ke Daftar Materi
                    </button>
                </div>
                
                <div class="text-center mb-6">
                    <h4 class="text-2xl font-bold text-gray-800 mb-2">${material.title}</h4>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-blue-400 to-blue-600 h-3 rounded-full transition-all duration-500" style="width: ${materialProgress.zakatFitrah[topic][materialId] || 0}%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">Progress: ${materialProgress.zakatFitrah[topic][materialId] || 0}%</p>
                </div>
                
                ${material.content}
                
                <div class="mt-8 text-center">
                    <button onclick="completeMaterial('${topic}', '${materialId}')" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-green-600 hover:to-green-700 transition-all hover:scale-105">
                        <i class="fas fa-check mr-2"></i>Selesai Baca Materi
                    </button>
                    <p class="text-sm text-gray-500 mt-3">
                        <i class="fas fa-lightbulb mr-1"></i>
                        Klik tombol di atas setelah selesai membaca
                    </p>
                </div>
            `;
        }
        
        // Show locked material message
        function showMaterialLocked(topic, materialId) {
            const content = learningContent[topic];
            const material = content.materials.find(m => m.id === materialId);
            
            if (!material || !material.requiredMaterial) return;
            
            const requiredMaterial = content.materials.find(m => m.id === material.requiredMaterial);
            const currentProgress = materialProgress.zakatFitrah[topic][material.requiredMaterial] || 0;
            
            Swal.fire({
                icon: 'warning',
                title: 'Materi Terkunci ğŸ”’',
                html: `
                    <div class="text-center">
                        <p class="mb-4">Untuk membuka materi ini, kamu harus:</p>
                        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                            <i class="fas fa-book text-yellow-500 text-2xl mb-2"></i>
                            <p class="text-yellow-800 font-bold">Selesaikan "${requiredMaterial.title}"</p>
                            <p class="text-yellow-700 text-sm">dengan progress minimal ${material.requiredScore}%</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-4">Progress saat ini: ${currentProgress}%</p>
                    </div>
                `,
                confirmButtonText: 'Mengerti',
                confirmButtonColor: '#f59e0b'
            });
        }
        
        // Complete material
        function completeMaterial(topic, materialId) {
            // Mark material as completed (100%)
            materialProgress.zakatFitrah[topic][materialId] = 100;
            
            // Save progress
            localStorage.setItem('materialProgress', JSON.stringify(materialProgress));
            
            // Check if this unlocks next material
            const content = learningContent[topic];
            const nextMaterial = content.materials.find(m => m.requiredMaterial === materialId);
            
            Swal.fire({
                icon: 'success',
                title: 'Materi Selesai! ğŸ‰',
                html: `
                    <div class="text-center">
                        <p class="mb-4">Kamu telah menyelesaikan materi ini!</p>
                        ${nextMaterial ? `
                            <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                                <i class="fas fa-unlock text-green-500 text-2xl mb-2"></i>
                                <p class="text-green-700 font-bold">Materi "${nextMaterial.title}" telah terbuka!</p>
                                <p class="text-green-600 text-sm">Lanjutkan ke materi berikutnya</p>
                            </div>
                        ` : ''}
                    </div>
                `,
                confirmButtonText: 'Lanjutkan',
                confirmButtonColor: '#10b981'
            }).then(() => {
                // Refresh the learning view
                startLearning(topic);
            });
        }

        // Shuffle array function
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Start Quiz
        function startQuiz(topic) {
            const content = learningContent[topic];
            let currentQuestion = 0;
            let correctAnswers = 0;
            let isAnswered = false;
            
            // Shuffle questions for random order
            const shuffledQuestions = shuffleArray(content.quiz);
            
            // Shuffle options for each question and track correct answer
            const questionsWithShuffledOptions = shuffledQuestions.map(question => {
                const optionsWithIndex = question.options.map((option, index) => ({
                    text: option,
                    originalIndex: index
                }));
                
                const shuffledOptions = shuffleArray(optionsWithIndex);
                
                // Find new position of correct answer
                const newCorrectIndex = shuffledOptions.findIndex(
                    option => option.originalIndex === question.correct
                );
                
                return {
                    ...question,
                    options: shuffledOptions.map(option => option.text),
                    correct: newCorrectIndex
                };
            });
            
            function showQuestion() {
                if (currentQuestion >= questionsWithShuffledOptions.length) {
                    showQuizResult();
                    return;
                }
                
                isAnswered = false;
                const question = questionsWithShuffledOptions[currentQuestion];
                document.getElementById('modalContent').innerHTML = `
                    <div class="text-center mb-6">
                        <h4 class="text-2xl font-bold mb-2">
                            <i class="fas fa-brain mr-2"></i>Kuis Pemahaman
                        </h4>
                        <p class="text-gray-600">Pertanyaan ${currentQuestion + 1} dari ${questionsWithShuffledOptions.length}</p>
                        <div class="flex items-center justify-center mt-2 text-sm text-blue-600">
                            <i class="fas fa-random mr-1"></i>
                            <span>Soal dan jawaban diacak</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 mt-4">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500" style="width: ${((currentQuestion + 1) / questionsWithShuffledOptions.length) * 100}%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 p-6 rounded-2xl mb-6">
                        <h5 class="text-xl font-bold text-gray-800 mb-6">${question.question}</h5>
                        <div class="space-y-3" id="optionsContainer">
                            ${question.options.map((option, index) => `
                                <button class="quiz-option w-full p-4 text-left bg-white border-2 border-gray-200 rounded-xl hover:border-blue-400 hover:bg-blue-50 transition-all duration-300 transform hover:scale-[1.02]" onclick="selectAnswer(${index})">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold mr-3 transition-all duration-300">
                                            ${String.fromCharCode(65 + index)}
                                        </div>
                                        <span class="flex-1">${option}</span>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                        <div id="explanationContainer" class="mt-6 hidden">
                            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-xl">
                                <p class="font-bold text-yellow-800 mb-2">
                                    <i class="fas fa-lightbulb mr-2"></i>Penjelasan:
                                </p>
                                <p class="text-gray-700">${question.explanation}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            window.selectAnswer = function(answerIndex) {
                if (isAnswered) return; // Prevent multiple selections
                
                isAnswered = true;
                const question = questionsWithShuffledOptions[currentQuestion];
                const isCorrect = answerIndex === question.correct;
                
                if (isCorrect) correctAnswers++;
                
                // Disable all buttons and show results immediately
                document.querySelectorAll('.quiz-option').forEach((btn, index) => {
                    btn.disabled = true;
                    btn.classList.remove('hover:border-blue-400', 'hover:bg-blue-50', 'hover:scale-[1.02]');
                    
                    if (index === question.correct) {
                        // Correct answer - green
                        btn.classList.remove('border-gray-200', 'bg-white');
                        btn.classList.add('bg-green-500', 'text-white', 'border-green-500', 'transform', 'scale-105');
                        btn.querySelector('.w-8').classList.remove('bg-blue-100', 'text-blue-600');
                        btn.querySelector('.w-8').classList.add('bg-green-600', 'text-white');
                        btn.innerHTML = btn.innerHTML.replace('</div>', ' <i class="fas fa-check"></i></div>');
                    } else if (index === answerIndex && !isCorrect) {
                        // Wrong selected answer - red
                        btn.classList.remove('border-gray-200', 'bg-white');
                        btn.classList.add('bg-red-500', 'text-white', 'border-red-500', 'transform', 'scale-105');
                        btn.querySelector('.w-8').classList.remove('bg-blue-100', 'text-blue-600');
                        btn.querySelector('.w-8').classList.add('bg-red-600', 'text-white');
                        btn.innerHTML = btn.innerHTML.replace('</div>', ' <i class="fas fa-times"></i></div>');
                    } else {
                        // Other options - dimmed
                        btn.classList.add('opacity-50');
                    }
                });
                
                // Show explanation with animation
                const explanationContainer = document.getElementById('explanationContainer');
                explanationContainer.classList.remove('hidden');
                explanationContainer.classList.add('animate-fadeIn');
                
                // Auto advance to next question after 3 seconds
                setTimeout(() => {
                    currentQuestion++;
                    showQuestion();
                }, 3000);
            };
            
            function showQuizResult() {
                const percentage = Math.round((correctAnswers / questionsWithShuffledOptions.length) * 100);
                learningProgress.zakatFitrah[topic] = percentage;
                
                // Save quiz result
                const quizResult = {
                    date: new Date().toISOString(),
                    score: percentage,
                    correctAnswers: correctAnswers,
                    totalQuestions: questionsWithShuffledOptions.length
                };
                quizResults.zakatFitrah[topic].push(quizResult);
                
                saveProgress();
                updateProgress();
                
                let resultIcon, resultTitle, resultColor;
                if (percentage >= 80) {
                    resultIcon = 'ğŸ†';
                    resultTitle = 'Luar Biasa!';
                    resultColor = 'text-yellow-600';
                } else if (percentage >= 60) {
                    resultIcon = 'ğŸ‰';
                    resultTitle = 'Bagus!';
                    resultColor = 'text-green-600';
                } else {
                    resultIcon = 'ğŸ“š';
                    resultTitle = 'Terus Belajar!';
                    resultColor = 'text-orange-600';
                }
                
                document.getElementById('modalContent').innerHTML = `
                    <div class="text-center">
                        <div class="text-8xl mb-6">${resultIcon}</div>
                        <h4 class="text-3xl font-bold ${resultColor} mb-4">${resultTitle}</h4>
                        <div class="text-6xl font-bold ${resultColor} mb-2">${percentage}%</div>
                        <p class="text-gray-600 mb-8">${correctAnswers} dari ${questionsWithShuffledOptions.length} jawaban benar</p>
                        
                        <div class="space-y-4">
                            <button onclick="startLearning('${topic}')" class="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-all mr-4">
                                <i class="fas fa-redo mr-2"></i>Pelajari Lagi
                            </button>
                            <button onclick="closeLearningModal()" class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-all">
                                <i class="fas fa-check mr-2"></i>Selesai
                            </button>
                        </div>
                    </div>
                `;
                
                if (percentage >= 70) {
                    // Check if this unlocks next module
                    let unlockedModule = '';
                    if (topic === 'pengertian') {
                        unlockedModule = 'Ketentuan';
                    } else if (topic === 'ketentuan') {
                        unlockedModule = 'Praktik';
                    }
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Selamat!',
                        html: `
                            <div class="text-center">
                                <p class="mb-4">Kamu berhasil menyelesaikan ${content.title} dengan skor ${percentage}%</p>
                                ${unlockedModule ? `
                                    <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                                        <i class="fas fa-unlock text-green-500 text-2xl mb-2"></i>
                                        <p class="text-green-700 font-bold">Modul "${unlockedModule}" telah terbuka!</p>
                                        <p class="text-green-600 text-sm">Lanjutkan pembelajaran ke materi berikutnya</p>
                                    </div>
                                ` : ''}
                            </div>
                        `,
                        confirmButtonColor: '#10b981'
                    });
                } else if (percentage >= 60) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Bagus!',
                        text: `Kamu berhasil menyelesaikan ${content.title} dengan skor ${percentage}%`,
                        confirmButtonColor: '#10b981'
                    });
                }
            }
            
            showQuestion();
        }

        // Calculator Functions
        function calculateZakat() {
            const familyMembers = parseInt(document.getElementById('familyMembers').value) || 0;
            const ricePrice = parseInt(document.getElementById('ricePrice').value) || 0;
            const paymentType = document.getElementById('paymentType').value;
            
            if (familyMembers <= 0 || ricePrice <= 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Data Tidak Valid',
                    text: 'Mohon masukkan data yang valid',
                    confirmButtonColor: '#f59e0b'
                });
                return;
            }
            
            const totalRice = familyMembers * 2.5;
            const totalMoney = totalRice * ricePrice;
            
            // Save calculation to history
            const calculation = {
                date: new Date().toISOString(),
                familyMembers: familyMembers,
                ricePrice: ricePrice,
                paymentType: paymentType,
                totalRice: totalRice,
                totalMoney: totalMoney
            };
            calculatorHistory.push(calculation);
            localStorage.setItem('calculatorHistory', JSON.stringify(calculatorHistory));
            
            let resultHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-xl font-bold text-blue-800 mb-4">
                        <i class="fas fa-chart-pie mr-2"></i>Hasil Perhitungan
                    </h3>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-white p-4 rounded-xl border-l-4 border-blue-500">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Jumlah Anggota Keluarga:</span>
                            <span class="font-bold text-blue-600">${familyMembers} orang</span>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-l-4 border-green-500">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Total Beras:</span>
                            <span class="font-bold text-green-600">${totalRice} kg</span>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border-l-4 border-purple-500">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Setara Uang:</span>
                            <span class="font-bold text-purple-600">Rp ${totalMoney.toLocaleString('id-ID')}</span>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <button onclick="showPaymentSimulation(${totalMoney})" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-bold hover:from-green-600 hover:to-green-700 transition-all">
                        <i class="fas fa-credit-card mr-2"></i>Simulasi Pembayaran
                    </button>
                </div>
            `;
            
            document.getElementById('calculatorResult').innerHTML = resultHTML;
        }

        // Payment Simulation
        function showPaymentSimulation(amount = null) {
            if (!amount) {
                // Calculate default amount for 4 people
                amount = 4 * 2.5 * 15000; // 4 people Ã— 2.5kg Ã— Rp 15,000
            }
            
            document.getElementById('paymentContent').innerHTML = `
                <div class="space-y-4 md:space-y-6">
                    <div class="text-center">
                        <h4 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">Pembayaran Zakat Fitrah</h4>
                        <div class="text-2xl md:text-3xl font-bold text-green-600">Rp ${amount.toLocaleString('id-ID')}</div>
                        <p class="text-sm md:text-base text-gray-600">Untuk keluarga 4 orang</p>
                    </div>
                    
                    <div>
                        <h5 class="font-bold text-gray-800 mb-3 md:mb-4 text-sm md:text-base">Pilih Metode Pembayaran:</h5>
                        <div class="grid grid-cols-2 gap-2 md:gap-4">
                            <div class="payment-method p-3 md:p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-blue-400 transition-all" onclick="selectPaymentMethod(this, 'transfer')">
                                <div class="text-center">
                                    <i class="fas fa-university text-2xl md:text-3xl text-blue-500 mb-1 md:mb-2"></i>
                                    <div class="font-bold text-sm md:text-base">Transfer Bank</div>
                                    <div class="text-xs md:text-sm text-gray-600">BCA, Mandiri, BRI</div>
                                </div>
                            </div>
                            
                            <div class="payment-method p-3 md:p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-green-400 transition-all" onclick="selectPaymentMethod(this, 'ewallet')">
                                <div class="text-center">
                                    <i class="fas fa-mobile-alt text-2xl md:text-3xl text-green-500 mb-1 md:mb-2"></i>
                                    <div class="font-bold text-sm md:text-base">E-Wallet</div>
                                    <div class="text-xs md:text-sm text-gray-600">GoPay, OVO, DANA</div>
                                </div>
                            </div>
                            
                            <div class="payment-method p-3 md:p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-yellow-400 transition-all" onclick="selectPaymentMethod(this, 'cash')">
                                <div class="text-center">
                                    <i class="fas fa-money-bill-wave text-2xl md:text-3xl text-yellow-500 mb-1 md:mb-2"></i>
                                    <div class="font-bold text-sm md:text-base">Tunai</div>
                                    <div class="text-xs md:text-sm text-gray-600">Langsung ke masjid</div>
                                </div>
                            </div>
                            
                            <div class="payment-method p-3 md:p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-orange-400 transition-all" onclick="selectPaymentMethod(this, 'rice')">
                                <div class="text-center">
                                    <i class="fas fa-seedling text-2xl md:text-3xl text-orange-500 mb-1 md:mb-2"></i>
                                    <div class="font-bold text-sm md:text-base">Beras</div>
                                    <div class="text-xs md:text-sm text-gray-600">10 kg beras</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center pt-2 md:pt-4">
                        <button id="payButton" class="bg-gray-300 text-gray-500 px-6 md:px-8 py-3 rounded-xl font-bold cursor-not-allowed text-sm md:text-base w-full md:w-auto" disabled>
                            Pilih Metode Pembayaran
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        function selectPaymentMethod(element, method) {
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            
            const payButton = document.getElementById('payButton');
            payButton.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
            payButton.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'text-white', 'hover:from-green-600', 'hover:to-green-700');
            payButton.disabled = false;
            payButton.textContent = 'Bayar Sekarang';
            payButton.onclick = () => processPayment(method);
        }

        function processPayment(method) {
            const methodNames = {
                transfer: 'Transfer Bank',
                ewallet: 'E-Wallet',
                cash: 'Tunai',
                rice: 'Beras'
            };
            
            Swal.fire({
                title: 'Pembayaran Berhasil!',
                html: `
                    <div class="text-center">
                        <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                        <p class="text-lg mb-2">Zakat fitrah telah dibayar melalui</p>
                        <p class="text-xl font-bold text-green-600">${methodNames[method]}</p>
                        <p class="text-sm text-gray-600 mt-4">Semoga zakat Anda diterima Allah SWT</p>
                    </div>
                `,
                icon: null,
                confirmButtonText: 'Alhamdulillah',
                confirmButtonColor: '#10b981'
            }).then(() => {
                closePaymentModal();
            });
        }

        // Modal Functions
        function closeLearningModal() {
            document.getElementById('learningModal').classList.add('hidden');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
        }

        // Progress Functions
        function saveProgress() {
            localStorage.setItem('learningProgress', JSON.stringify(learningProgress));
            localStorage.setItem('quizResults', JSON.stringify(quizResults));
            localStorage.setItem('badges', JSON.stringify(badges));
        }

        function loadProgress() {
            const savedProgress = localStorage.getItem('learningProgress');
            if (savedProgress) {
                learningProgress = JSON.parse(savedProgress);
            }
            
            const savedMaterialProgress = localStorage.getItem('materialProgress');
            if (savedMaterialProgress) {
                materialProgress = JSON.parse(savedMaterialProgress);
            }
            
            const savedQuizResults = localStorage.getItem('quizResults');
            if (savedQuizResults) {
                quizResults = JSON.parse(savedQuizResults);
            }
            
            const savedBadges = localStorage.getItem('badges');
            if (savedBadges) {
                badges = JSON.parse(savedBadges);
            }
            
            const savedCalculatorHistory = localStorage.getItem('calculatorHistory');
            if (savedCalculatorHistory) {
                calculatorHistory = JSON.parse(savedCalculatorHistory);
            }
            
            updateProgress();
        }

        function updateProgress() {
            console.log('Updating progress, current state:', learningProgress.zakatFitrah);
            
            const zakatProgress = Object.values(learningProgress.zakatFitrah);
            const avgProgress = zakatProgress.reduce((a, b) => a + b, 0) / zakatProgress.length;
            
            console.log('Average progress:', avgProgress);
            
            document.getElementById('zakatProgress').textContent = Math.round(avgProgress) + '%';
            document.getElementById('zakatProgressBar').style.width = Math.round(avgProgress) + '%';
            
            // Update overall progress
            document.getElementById('overallProgress').style.width = Math.round(avgProgress) + '%';
            document.getElementById('overallProgressText').textContent = Math.round(avgProgress) + '%';
            
            // Update user progress in header
            updateUserProgress();
            
            // Re-render modules to update lock status
            renderLearningModules();
            
            // Update completed modules count
            const completedModules = Object.values(learningProgress.zakatFitrah).filter(score => score >= 70).length;
            document.getElementById('completedModules').textContent = `${completedModules}/3`;
            
            // Update badges
            updateBadges(avgProgress);
            
            // Check if certificate should be available
            if (avgProgress >= 80) {
                showCertificate();
            }
            
            // Force update main menu unlock status
            updateMainMenuAccess();
        }
        
        // Update badges based on progress
        function updateBadges(avgProgress) {
            let badgeCount = 0;
            
            // Badge for completing each module
            Object.entries(learningProgress.zakatFitrah).forEach(([module, score]) => {
                if (score >= 70) badgeCount++;
                if (score >= 80) badgeCount++; // Excellence badge
                if (score === 100) badgeCount++; // Perfect score badge
            });
            
            // Overall completion badge
            if (avgProgress >= 80) badgeCount++;
            
            document.getElementById('totalBadges').textContent = badgeCount;
        }

        // Certificate Functions
        function showCertificate() {
            const avgProgress = Math.round(Object.values(learningProgress.zakatFitrah).reduce((a, b) => a + b, 0) / 3);
            
            document.getElementById('certificateContent').innerHTML = `
                <div id="certificateToDownload" class="certificate max-w-4xl mx-auto p-8 md:p-12 rounded-3xl text-white text-center relative bg-gradient-to-br from-purple-600 to-blue-700 border-8 border-yellow-400">
                    <!-- Decorative elements -->
                    <div class="absolute top-4 md:top-8 left-4 md:left-8">
                        <i class="fas fa-star text-yellow-300 text-2xl md:text-3xl"></i>
                    </div>
                    <div class="absolute top-4 md:top-8 right-4 md:right-8">
                        <i class="fas fa-star text-yellow-300 text-2xl md:text-3xl"></i>
                    </div>
                    <div class="absolute bottom-4 md:bottom-8 left-4 md:left-8">
                        <i class="fas fa-medal text-yellow-300 text-2xl md:text-3xl"></i>
                    </div>
                    <div class="absolute bottom-4 md:bottom-8 right-4 md:right-8">
                        <i class="fas fa-trophy text-yellow-300 text-2xl md:text-3xl"></i>
                    </div>
                    
                    <!-- Certificate border -->
                    <div class="absolute inset-4 md:inset-6 border-2 border-yellow-300 rounded-2xl pointer-events-none"></div>
                    
                    <!-- Header -->
                    <div class="mb-6 md:mb-8 relative z-10">
                        <div class="text-yellow-300 text-4xl md:text-6xl mb-2 md:mb-4">ğŸ“</div>
                        <h2 class="text-2xl md:text-4xl font-bold mb-2 md:mb-4">SERTIFIKAT PEMBELAJARAN</h2>
                        <div class="text-sm md:text-xl opacity-90">Media Pembelajaran Islam Interaktif</div>
                        <div class="text-xs md:text-base opacity-75 mt-1">MIN SINGKAWANG</div>
                    </div>
                    
                    <!-- Student Info -->
                    <div class="mb-6 md:mb-8 relative z-10">
                        <div class="text-sm md:text-lg mb-2">Diberikan kepada:</div>
                        <div class="text-3xl md:text-5xl font-bold mb-2 md:mb-4 text-yellow-200">${userProfile.name}</div>
                        <div class="text-lg md:text-xl">Kelas ${userProfile.class}</div>
                    </div>
                    
                    <!-- Achievement -->
                    <div class="mb-6 md:mb-8 relative z-10">
                        <div class="text-sm md:text-lg mb-2 md:mb-4">Telah menyelesaikan pembelajaran</div>
                        <div class="text-2xl md:text-3xl font-bold text-yellow-300 mb-2">ZAKAT FITRAH</div>
                        <div class="text-sm md:text-lg mt-2">dengan nilai kelulusan yang memuaskan</div>
                    </div>
                    
                    <!-- Footer Info -->
                    <div class="flex justify-between items-end text-xs md:text-sm relative z-10">
                        <div class="text-left">
                            <div class="opacity-75 mb-1">Tanggal:</div>
                            <div class="font-bold">${new Date().toLocaleDateString('id-ID', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric' 
                            })}</div>
                        </div>
                        <div class="text-center">
                            <div class="w-12 h-12 md:w-16 md:h-16 bg-white bg-opacity-20 rounded-full overflow-hidden mx-auto mb-2 border-2 border-yellow-300">
                                ${userProfile.avatarSvg}
                            </div>
                            <div class="text-xs opacity-75">Foto Siswa</div>
                        </div>
                        <div class="text-right">
                            <div class="opacity-75 mb-1">Skor Akhir:</div>
                            <div class="font-bold text-xl md:text-2xl text-yellow-300">${avgProgress}%</div>
                        </div>
                    </div>
                </div>
                
                <!-- Download Button -->
                <div class="text-center mt-6 md:mt-8">
                    <button onclick="downloadCertificate()" class="bg-gradient-to-r from-purple-500 to-blue-600 text-white px-6 md:px-8 py-3 md:py-4 rounded-xl font-bold hover:from-purple-600 hover:to-blue-700 transition-all hover:scale-105 text-sm md:text-base">
                        <i class="fas fa-download mr-2"></i>Download Sertifikat
                    </button>
                    <p class="text-xs md:text-sm text-gray-500 mt-2">Tersedia dalam format PNG dan PDF</p>
                </div>
            `;
        }

        function downloadCertificate() {
            Swal.fire({
                title: 'Pilih Format Download',
                html: `
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <button onclick="downloadAsImage()" class="bg-blue-500 text-white p-4 rounded-xl hover:bg-blue-600 transition-all">
                            <i class="fas fa-image text-2xl mb-2"></i>
                            <div class="font-bold">Download PNG</div>
                            <div class="text-sm opacity-90">Format Gambar</div>
                        </button>
                        <button onclick="downloadAsPDF()" class="bg-red-500 text-white p-4 rounded-xl hover:bg-red-600 transition-all">
                            <i class="fas fa-file-pdf text-2xl mb-2"></i>
                            <div class="font-bold">Download PDF</div>
                            <div class="text-sm opacity-90">Format Dokumen</div>
                        </button>
                    </div>
                `,
                showConfirmButton: false,
                showCancelButton: true,
                cancelButtonText: 'Batal',
                cancelButtonColor: '#6b7280'
            });
        }

        function downloadAsImage() {
            Swal.close();
            
            const certificate = document.getElementById('certificateToDownload');
            if (!certificate) {
                Swal.fire({
                    icon: 'error',
                    title: 'Gagal!',
                    text: 'Sertifikat tidak ditemukan. Pastikan Anda sudah menyelesaikan pembelajaran.',
                    confirmButtonColor: '#ef4444'
                });
                return;
            }
            
            Swal.fire({
                title: 'Memproses...',
                text: 'Sedang membuat sertifikat dalam format gambar',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                    
                    // Force certificate to be visible and properly rendered
                    certificate.style.display = 'block';
                    certificate.style.visibility = 'visible';
                    certificate.style.opacity = '1';
                    certificate.style.position = 'relative';
                    certificate.style.zIndex = '1';
                    
                    // Wait for rendering then capture
                    setTimeout(() => {
                        html2canvas(certificate, {
                            backgroundColor: '#ffffff',
                            scale: 1.5,
                            useCORS: true,
                            allowTaint: true,
                            foreignObjectRendering: false,
                            logging: true,
                            letterRendering: true,
                            onclone: function(clonedDoc) {
                                // Ensure all styles are applied in the clone
                                const clonedCert = clonedDoc.getElementById('certificateToDownload');
                                if (clonedCert) {
                                    clonedCert.style.display = 'block';
                                    clonedCert.style.visibility = 'visible';
                                    clonedCert.style.opacity = '1';
                                    clonedCert.style.background = 'linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%)';
                                }
                            }
                        }).then(canvas => {
                            try {
                                // Check if canvas has content
                                if (canvas.width === 0 || canvas.height === 0) {
                                    throw new Error('Canvas kosong - tidak ada konten yang dirender');
                                }
                                
                                // Create download link
                                const link = document.createElement('a');
                                const fileName = `Sertifikat_${userProfile.name.replace(/[^a-zA-Z0-9]/g, '_')}_ZakatFitrah.png`;
                                link.download = fileName;
                                link.href = canvas.toDataURL('image/png', 1.0);
                                
                                // Trigger download
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil! ğŸ‰',
                                    html: `
                                        <div class="text-center">
                                            <p class="mb-4">Sertifikat berhasil didownload!</p>
                                            <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                                                <i class="fas fa-download text-green-500 text-2xl mb-2"></i>
                                                <p class="text-green-700 font-bold">File: ${fileName}</p>
                                                <p class="text-green-600 text-sm">Format: PNG (Gambar)</p>
                                                <p class="text-green-600 text-xs mt-1">Ukuran: ${canvas.width}x${canvas.height}px</p>
                                            </div>
                                        </div>
                                    `,
                                    confirmButtonColor: '#10b981'
                                });
                            } catch (downloadError) {
                                console.error('Download error:', downloadError);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal Download!',
                                    text: downloadError.message || 'Terjadi kesalahan saat mendownload file',
                                    confirmButtonColor: '#ef4444'
                                });
                            }
                        }).catch(error => {
                            console.error('html2canvas error:', error);
                            Swal.fire({
                                icon: 'error',
                                title: 'Gagal Membuat Gambar!',
                                html: `
                                    <div class="text-center">
                                        <p class="mb-4">Terjadi kesalahan saat membuat gambar sertifikat.</p>
                                        <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                                            <i class="fas fa-exclamation-triangle text-red-500 text-2xl mb-2"></i>
                                            <p class="text-red-700 text-sm">Error: ${error.message}</p>
                                            <p class="text-red-600 text-xs mt-1">Coba refresh halaman dan ulangi lagi</p>
                                        </div>
                                    </div>
                                `,
                                confirmButtonColor: '#ef4444'
                            });
                        });
                    }, 1000);
                }
            });
        }

        function downloadAsPDF() {
            Swal.close();
            
            const certificate = document.getElementById('certificateToDownload');
            if (!certificate) {
                Swal.fire({
                    icon: 'error',
                    title: 'Gagal!',
                    text: 'Sertifikat tidak ditemukan. Pastikan Anda sudah menyelesaikan pembelajaran.',
                    confirmButtonColor: '#ef4444'
                });
                return;
            }
            
            Swal.fire({
                title: 'Memproses...',
                text: 'Sedang membuat sertifikat dalam format PDF',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                    
                    // Force certificate to be visible and properly rendered
                    certificate.style.display = 'block';
                    certificate.style.visibility = 'visible';
                    certificate.style.opacity = '1';
                    certificate.style.position = 'relative';
                    certificate.style.zIndex = '1';
                    
                    // Wait for rendering then capture
                    setTimeout(() => {
                        html2canvas(certificate, {
                            backgroundColor: '#ffffff',
                            scale: 1.5,
                            useCORS: true,
                            allowTaint: true,
                            foreignObjectRendering: false,
                            logging: true,
                            letterRendering: true,
                            onclone: function(clonedDoc) {
                                // Ensure all styles are applied in the clone
                                const clonedCert = clonedDoc.getElementById('certificateToDownload');
                                if (clonedCert) {
                                    clonedCert.style.display = 'block';
                                    clonedCert.style.visibility = 'visible';
                                    clonedCert.style.opacity = '1';
                                    clonedCert.style.background = 'linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%)';
                                }
                            }
                        }).then(canvas => {
                            try {
                                // Check if canvas has content
                                if (canvas.width === 0 || canvas.height === 0) {
                                    throw new Error('Canvas kosong - tidak ada konten yang dirender');
                                }
                                
                                const { jsPDF } = window.jspdf;
                                const pdf = new jsPDF({
                                    orientation: 'landscape',
                                    unit: 'mm',
                                    format: 'a4'
                                });
                                
                                const imgData = canvas.toDataURL('image/png', 1.0);
                                const imgWidth = 280; // A4 landscape width in mm with margins
                                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                                
                                // Center the image on the page
                                const x = (297 - imgWidth) / 2; // A4 landscape width is 297mm
                                const y = (210 - imgHeight) / 2; // A4 landscape height is 210mm
                                
                                pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
                                
                                // Add metadata
                                pdf.setProperties({
                                    title: `Sertifikat Pembelajaran - ${userProfile.name}`,
                                    subject: 'Sertifikat Zakat Fitrah',
                                    author: 'FIKIH ITU MUDAH - MIN SINGKAWANG',
                                    creator: 'Learning Management System'
                                });
                                
                                // Download the PDF
                                const fileName = `Sertifikat_${userProfile.name.replace(/[^a-zA-Z0-9]/g, '_')}_ZakatFitrah.pdf`;
                                pdf.save(fileName);
                                
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Berhasil! ğŸ‰',
                                    html: `
                                        <div class="text-center">
                                            <p class="mb-4">Sertifikat berhasil didownload!</p>
                                            <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                                                <i class="fas fa-file-pdf text-red-500 text-2xl mb-2"></i>
                                                <p class="text-red-700 font-bold">File: ${fileName}</p>
                                                <p class="text-red-600 text-sm">Format: PDF (Dokumen)</p>
                                                <p class="text-red-600 text-xs mt-1">Ukuran: ${canvas.width}x${canvas.height}px</p>
                                            </div>
                                        </div>
                                    `,
                                    confirmButtonColor: '#10b981'
                                });
                            } catch (pdfError) {
                                console.error('PDF creation error:', pdfError);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Gagal Membuat PDF!',
                                    text: pdfError.message || 'Terjadi kesalahan saat membuat file PDF',
                                    confirmButtonColor: '#ef4444'
                                });
                            }
                        }).catch(error => {
                            console.error('html2canvas error:', error);
                            Swal.fire({
                                icon: 'error',
                                title: 'Gagal Membuat Gambar!',
                                html: `
                                    <div class="text-center">
                                        <p class="mb-4">Terjadi kesalahan saat membuat gambar untuk PDF.</p>
                                        <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                                            <i class="fas fa-exclamation-triangle text-red-500 text-2xl mb-2"></i>
                                            <p class="text-red-700 text-sm">Error: ${error.message}</p>
                                            <p class="text-red-600 text-xs mt-1">Coba refresh halaman dan ulangi lagi</p>
                                        </div>
                                    </div>
                                `,
                                confirmButtonColor: '#ef4444'
                            });
                        });
                    }, 1000);
                }
            });
        }

        // Study Time Functions
        function startStudyTimer() {
            studyStartTime = Date.now();
        }

        function updateStudyTime() {
            const savedTime = localStorage.getItem('totalStudyTime');
            if (savedTime) {
                totalStudyTime = parseInt(savedTime);
            }
            
            if (studyStartTime) {
                const currentSession = Math.floor((Date.now() - studyStartTime) / 60000);
                const total = totalStudyTime + currentSession;
                document.getElementById('studyTime').textContent = total + ' menit';
            } else {
                document.getElementById('studyTime').textContent = totalStudyTime + ' menit';
            }
            
            setTimeout(updateStudyTime, 60000); // Update every minute
        }

        // Save study time on page unload
        window.addEventListener('beforeunload', function() {
            if (studyStartTime) {
                const sessionTime = Math.floor((Date.now() - studyStartTime) / 60000);
                totalStudyTime += sessionTime;
                localStorage.setItem('totalStudyTime', totalStudyTime.toString());
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'973f95cd622bfde4',t:'MTc1NjAwNDI3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
