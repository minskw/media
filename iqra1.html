<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Iqra' Digital - Belajar Membaca Al-Qur'an</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/3165/3165231.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Nunito:wght@400;600;700;800&display=swap');
        
        body { 
            font-family: 'Nunito', sans-serif; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        .arabic-text {
            font-family: 'Amiri', serif;
            direction: rtl;
            text-align: center;
        }
        
        .title-font { font-family: 'Amiri', serif; }
        
        .menu-card {
            transition: all 0.3s ease;
        }
        
        .menu-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .letter-glow {
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            transition: all 0.3s ease;
        }
        
        .letter-bounce {
            animation: letterBounce 0.6s ease;
        }
        
        @keyframes letterBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .game-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .game-card:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .btn-islamic {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transition: all 0.2s ease;
        }
        
        .btn-islamic:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(5, 150, 105, 0.4);
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }
        
        .modal-enter {
            animation: modalEnter 0.4s ease-out;
        }
        
        @keyframes modalEnter {
            0% { opacity: 0; transform: scale(0.8) translateY(-50px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .success-pulse {
            animation: successPulse 0.6s ease;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #10B981, #059669);
            transition: width 0.5s ease;
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .recording {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .profile-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
        }

        .correct-answer {
            animation: correctPulse 0.5s ease;
            background: linear-gradient(135deg, #10B981, #059669) !important;
            color: white !important;
        }
        
        .wrong-answer {
            animation: wrongShake 0.5s ease;
            background: linear-gradient(135deg, #EF4444, #DC2626) !important;
            color: white !important;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Memory card styles */
        .memory-card {
            perspective: 1000px;
        }
        
        .memory-card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }
        
        .memory-card.flipped .memory-card-inner {
            transform: rotateY(180deg);
        }
        
        .memory-card-front, .memory-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
        }
        
        .memory-card-back {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 text-white shadow-2xl">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="text-4xl float text-white">
                        <i class="fas fa-mosque"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold title-font">Iqra' Digital Jilid 1</h1>
                        <p class="text-emerald-100 text-sm md:text-base">Belajar Membaca Al-Qur'an dengan Mudah</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="testMicrophone()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-lg text-lg" title="Tes Mikrofon">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button onclick="showProfileSetup()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-lg text-lg" title="Profil">
                        <i class="fas fa-user"></i>
                    </button>
                    <div class="text-right">
                        <div class="text-sm text-emerald-100">Progress Belajar</div>
                        <div class="w-32 bg-emerald-800 rounded-full h-2 mt-1">
                            <div id="overallProgress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <div id="progressText" class="text-xs text-emerald-100 mt-1">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Welcome Section -->
        <div class="text-center mb-12">
            <div class="inline-block bg-white rounded-2xl shadow-xl p-8 mb-8">
                <div class="text-6xl mb-4 float text-emerald-600">
                    <i class="fas fa-book-open"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4 title-font">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ</h2>
                <p class="text-gray-600 text-lg">Selamat datang di pembelajaran Iqra' Digital Jilid 1</p>
                <p class="text-gray-500">Mari belajar membaca Al-Qur'an dengan metode yang menyenangkan!</p>
                <div id="welcomeUser" class="mt-4 hidden">
                    <div class="flex items-center justify-center space-x-3">
                        <img id="userAvatar" class="profile-img" src="" alt="Avatar">
                        <div>
                            <p class="text-lg font-semibold text-gray-800">Selamat datang, <span id="userName"></span>!</p>
                            <p class="text-sm text-gray-600">Usia: <span id="userAge"></span> tahun</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Cards -->
        <div id="menuCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <!-- Belajar Huruf -->
            <div class="menu-card bg-white rounded-2xl shadow-xl p-6 text-center cursor-pointer" onclick="showLetters()">
                <div class="text-5xl mb-4 float text-emerald-600">
                    <i class="fas fa-font"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Belajar Huruf</h3>
                <p class="text-gray-600 text-sm">Pelajari huruf hijaiyah dengan suara</p>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="letterProgress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <div id="letterProgressText" class="text-xs text-gray-500 mt-1">0/28 huruf</div>
                </div>
            </div>

            <!-- Latihan Membaca -->
            <div class="menu-card bg-white rounded-2xl shadow-xl p-6 text-center cursor-pointer" onclick="showReading()">
                <div class="text-5xl mb-4 float text-blue-600">
                    <i class="fas fa-book-reader"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Latihan Membaca</h3>
                <p class="text-gray-600 text-sm">Berlatih membaca kata dan kalimat</p>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="readingProgress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <div id="readingProgressText" class="text-xs text-gray-500 mt-1">0/20 latihan</div>
                </div>
            </div>

            <!-- Game Edukatif -->
            <div class="menu-card bg-white rounded-2xl shadow-xl p-6 text-center cursor-pointer" onclick="showGames()">
                <div class="text-5xl mb-4 float text-purple-600">
                    <i class="fas fa-gamepad"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Game Edukatif</h3>
                <p class="text-gray-600 text-sm">Bermain sambil belajar</p>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="gameProgress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <div id="gameProgressText" class="text-xs text-gray-500 mt-1">0/5 game</div>
                </div>
            </div>

            <!-- Evaluasi -->
            <div class="menu-card bg-white rounded-2xl shadow-xl p-6 text-center cursor-pointer" onclick="showEvaluation()">
                <div class="text-5xl mb-4 float text-orange-600">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Evaluasi</h3>
                <p class="text-gray-600 text-sm">Uji kemampuan membaca Anda</p>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="evalProgress" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <div id="evalProgressText" class="text-xs text-gray-500 mt-1">Belum dimulai</div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div id="contentArea" class="bg-white rounded-2xl shadow-xl p-8 min-h-96">
            <div class="text-center py-12">
                <div class="text-6xl mb-6 float text-yellow-500">
                    <i class="fas fa-play-circle"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Pilih Menu untuk Memulai</h3>
                <p class="text-gray-600">Klik salah satu menu di atas untuk memulai pembelajaran</p>
                <div class="mt-8">
                    <button onclick="showProfileSetup()" class="btn-islamic text-white px-8 py-3 rounded-lg font-semibold mr-4">
                        <i class="fas fa-user-plus mr-2"></i>Atur Profil
                    </button>
                    <button onclick="testMicrophone()" class="btn-blue text-white px-8 py-3 rounded-lg font-semibold">
                        <i class="fas fa-microphone mr-2"></i>Tes Mikrofon
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-gray-800 via-gray-900 to-black text-white mt-16">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="text-3xl text-emerald-400">
                            <i class="fas fa-mosque"></i>
                        </div>
                        <h3 class="text-xl font-bold title-font">Iqra' Digital Jilid 1</h3>
                    </div>
                    <p class="text-gray-300 mb-4">
                        Platform pembelajaran Al-Qur'an digital yang dirancang khusus untuk memudahkan 
                        pembelajaran membaca huruf hijaiyah dengan metode Iqra' yang telah terbukti efektif.
                    </p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Fitur Utama</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li><i class="fas fa-check text-emerald-400 mr-2"></i>28 Huruf Hijaiyah</li>
                        <li><i class="fas fa-check text-emerald-400 mr-2"></i>Rekam & Evaluasi Suara</li>
                        <li><i class="fas fa-check text-emerald-400 mr-2"></i>Game Edukatif Interaktif</li>
                        <li><i class="fas fa-check text-emerald-400 mr-2"></i>Sistem Evaluasi Lengkap</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Statistik</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-300">Total Pengguna:</span>
                            <span class="font-semibold text-emerald-400">1,234+</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">Rating:</span>
                            <span class="font-semibold text-yellow-400"><i class="fas fa-star"></i> 4.9/5</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-400 text-sm">
                    © 2024 Iqra' Digital. Dibuat dengan <i class="fas fa-heart text-red-500"></i> untuk pembelajaran Al-Qur'an
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let currentLetter = null;
        let microphonePermission = false;

        // Data pembelajaran
        const hijaiyahLetters = [
            {letter: 'ا', name: 'Alif', sound: 'a'},
            {letter: 'ب', name: 'Ba', sound: 'ba'},
            {letter: 'ت', name: 'Ta', sound: 'ta'},
            {letter: 'ث', name: 'Tsa', sound: 'tsa'},
            {letter: 'ج', name: 'Jim', sound: 'ja'},
            {letter: 'ح', name: 'Ha', sound: 'ha'},
            {letter: 'خ', name: 'Kha', sound: 'kha'},
            {letter: 'د', name: 'Dal', sound: 'da'},
            {letter: 'ذ', name: 'Dzal', sound: 'dza'},
            {letter: 'ر', name: 'Ra', sound: 'ra'},
            {letter: 'ز', name: 'Zai', sound: 'za'},
            {letter: 'س', name: 'Sin', sound: 'sa'},
            {letter: 'ش', name: 'Syin', sound: 'sya'},
            {letter: 'ص', name: 'Shad', sound: 'sha'},
            {letter: 'ض', name: 'Dhad', sound: 'dha'},
            {letter: 'ط', name: 'Tha', sound: 'tha'},
            {letter: 'ظ', name: 'Zha', sound: 'zha'},
            {letter: 'ع', name: 'Ain', sound: 'a'},
            {letter: 'غ', name: 'Ghain', sound: 'gha'},
            {letter: 'ف', name: 'Fa', sound: 'fa'},
            {letter: 'ق', name: 'Qaf', sound: 'qa'},
            {letter: 'ك', name: 'Kaf', sound: 'ka'},
            {letter: 'ل', name: 'Lam', sound: 'la'},
            {letter: 'م', name: 'Mim', sound: 'ma'},
            {letter: 'ن', name: 'Nun', sound: 'na'},
            {letter: 'و', name: 'Waw', sound: 'wa'},
            {letter: 'ه', name: 'Ha', sound: 'ha'},
            {letter: 'ي', name: 'Ya', sound: 'ya'}
        ];

        const readingExercises = [
            {text: 'بَا', meaning: 'ba'},
            {text: 'تَا', meaning: 'ta'},
            {text: 'جَا', meaning: 'ja'},
            {text: 'دَا', meaning: 'da'},
            {text: 'رَا', meaning: 'ra'},
            {text: 'سَا', meaning: 'sa'},
            {text: 'فَا', meaning: 'fa'},
            {text: 'كَا', meaning: 'ka'},
            {text: 'لَا', meaning: 'la'},
            {text: 'مَا', meaning: 'ma'},
            {text: 'نَا', meaning: 'na'},
            {text: 'هَا', meaning: 'ha'},
            {text: 'يَا', meaning: 'ya'},
            {text: 'بِي', meaning: 'bi'},
            {text: 'تِي', meaning: 'ti'},
            {text: 'جِي', meaning: 'ji'},
            {text: 'دِي', meaning: 'di'},
            {text: 'رِي', meaning: 'ri'},
            {text: 'سِي', meaning: 'si'},
            {text: 'فِي', meaning: 'fi'}
        ];

        // Progress tracking
        let progress = {
            letters: [],
            reading: [],
            games: [],
            evaluation: 0
        };

        // Utility functions
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        }

        function loadFromLocalStorage(key, defaultValue = null) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                return defaultValue;
            }
        }

        // Test microphone function
        async function testMicrophone() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                Swal.fire({
                    title: '🎤 Tes Mikrofon',
                    text: 'Silakan bicara... (2 detik)',
                    icon: 'info',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    Swal.fire({
                        title: '✅ Mikrofon Berfungsi!',
                        text: 'Mikrofon Anda siap digunakan.',
                        icon: 'success',
                        confirmButtonColor: '#059669'
                    });
                }, 2000);
                
            } catch (error) {
                Swal.fire({
                    title: '❌ Tes Mikrofon Gagal',
                    text: 'Silakan izinkan akses mikrofon.',
                    icon: 'error',
                    confirmButtonColor: '#DC2626'
                });
            }
        }

        // Profile setup function
        function showProfileSetup() {
            Swal.fire({
                title: '👤 Setup Profil',
                html: `
                    <div class="text-left">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Nama:</label>
                            <input type="text" id="profileName" class="w-full px-3 py-2 border rounded-lg" placeholder="Masukkan nama Anda">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Usia:</label>
                            <select id="profileAge" class="w-full px-3 py-2 border rounded-lg">
                                <option value="">Pilih usia</option>
                                ${Array.from({length: 80}, (_, i) => i + 5).map(age => 
                                    `<option value="${age}">${age} tahun</option>`
                                ).join('')}
                            </select>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Simpan',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#059669',
                preConfirm: () => {
                    const name = document.getElementById('profileName').value;
                    const age = document.getElementById('profileAge').value;
                    
                    if (!name || !age) {
                        Swal.showValidationMessage('Silakan lengkapi semua field');
                        return false;
                    }
                    
                    return { name, age };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const profile = result.value;
                    saveToLocalStorage('userProfile', profile);
                    loadUserProfile();
                    
                    Swal.fire({
                        title: '✅ Profil Tersimpan!',
                        text: `Selamat datang, ${profile.name}!`,
                        icon: 'success',
                        confirmButtonColor: '#059669'
                    });
                }
            });
        }

        // Load user profile
        function loadUserProfile() {
            const profile = loadFromLocalStorage('userProfile');
            
            if (profile) {
                const welcomeUser = document.getElementById('welcomeUser');
                const userName = document.getElementById('userName');
                const userAge = document.getElementById('userAge');
                const userAvatar = document.getElementById('userAvatar');
                
                if (welcomeUser && userName && userAge && userAvatar) {
                    userName.textContent = profile.name;
                    userAge.textContent = profile.age;
                    userAvatar.src = 'https://via.placeholder.com/80/059669/FFFFFF?text=USER';
                    welcomeUser.classList.remove('hidden');
                }
            }
        }

        // Show Letters Section
        function showLetters() {
            hideMenuAndWelcome();
            
            const content = `
                <div class="text-center mb-8">
                    <button onclick="showHome()" class="btn-islamic text-white p-3 rounded-lg mb-4 text-lg">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-font text-emerald-600 mr-3"></i>Belajar Huruf Hijaiyah
                    </h2>
                    <p class="text-gray-600">Klik huruf untuk belajar</p>
                </div>
                
                <div class="grid grid-cols-4 md:grid-cols-7 gap-4 mb-8">
                    ${hijaiyahLetters.map((letter, index) => `
                        <div class="game-card bg-gradient-to-br from-emerald-100 to-emerald-200 p-6 rounded-xl text-center ${progress.letters.includes(index) ? 'bg-gradient-to-br from-green-200 to-green-300' : ''}" 
                             onclick="learnLetter(${index})">
                            <div class="arabic-text text-4xl font-bold text-emerald-800 mb-2">${letter.letter}</div>
                            <div class="text-sm font-semibold text-emerald-700">${letter.name}</div>
                            ${progress.letters.includes(index) ? '<div class="text-green-600 mt-2"><i class="fas fa-check-circle"></i></div>' : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
        }

        // Learn letter function
        function learnLetter(index) {
            const letter = hijaiyahLetters[index];
            
            Swal.fire({
                title: letter.letter,
                html: `
                    <div class="text-center">
                        <div class="arabic-text text-6xl font-bold text-emerald-800 mb-4">${letter.letter}</div>
                        <p class="text-xl mb-2"><strong>${letter.name}</strong></p>
                        <p class="text-gray-600">Dibaca: "${letter.sound}"</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Sudah Paham',
                confirmButtonColor: '#059669'
            }).then(() => {
                if (!progress.letters.includes(index)) {
                    progress.letters.push(index);
                    saveToLocalStorage('letterProgress', progress.letters);
                    updateAllProgress();
                    showLetters();
                }
            });
        }

        // Show Reading Section
        function showReading() {
            hideMenuAndWelcome();
            
            const content = `
                <div class="text-center mb-8">
                    <button onclick="showHome()" class="btn-islamic text-white p-3 rounded-lg mb-4 text-lg">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-book-reader text-blue-600 mr-3"></i>Latihan Membaca
                    </h2>
                    <p class="text-gray-600">Berlatih membaca kata-kata sederhana</p>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    ${readingExercises.map((exercise, index) => `
                        <div class="game-card bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-xl text-center ${progress.reading.includes(index) ? 'bg-gradient-to-br from-green-200 to-green-300' : ''}" 
                             onclick="practiceReading(${index})">
                            <div class="arabic-text text-3xl font-bold text-blue-800 mb-2">${exercise.text}</div>
                            <div class="text-sm font-semibold text-blue-700">${exercise.meaning}</div>
                            ${progress.reading.includes(index) ? '<div class="text-green-600 mt-2"><i class="fas fa-check-circle"></i></div>' : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
        }

        // Practice reading function
        function practiceReading(index) {
            const exercise = readingExercises[index];
            
            Swal.fire({
                title: 'Bacalah:',
                html: `
                    <div class="text-center">
                        <div class="arabic-text text-6xl font-bold text-blue-800 my-4">${exercise.text}</div>
                        <div class="text-lg text-gray-600 mb-4">Dibaca: "${exercise.meaning}"</div>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Sudah Bisa!',
                confirmButtonColor: '#059669'
            }).then(() => {
                if (!progress.reading.includes(index)) {
                    progress.reading.push(index);
                    saveToLocalStorage('readingProgress', progress.reading);
                    updateAllProgress();
                    showReading();
                }
            });
        }

        // Show Games Section
        function showGames() {
            hideMenuAndWelcome();
            
            const games = [
                {name: 'Memory Huruf', icon: '<i class="fas fa-brain text-purple-600"></i>', desc: 'Cocokkan huruf yang sama'},
                {name: 'Tebak Huruf', icon: '<i class="fas fa-question-circle text-purple-600"></i>', desc: 'Tebak nama huruf hijaiyah'},
                {name: 'Susun Kata', icon: '<i class="fas fa-spell-check text-purple-600"></i>', desc: 'Susun huruf menjadi kata'},
                {name: 'Kuis Cepat', icon: '<i class="fas fa-bolt text-purple-600"></i>', desc: 'Jawab pertanyaan dengan cepat'},
                {name: 'Puzzle Huruf', icon: '<i class="fas fa-puzzle-piece text-purple-600"></i>', desc: 'Selesaikan puzzle huruf'}
            ];
            
            const content = `
                <div class="text-center mb-8">
                    <button onclick="showHome()" class="btn-islamic text-white p-3 rounded-lg mb-4 text-lg">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-gamepad text-purple-600 mr-3"></i>Game Edukatif
                    </h2>
                    <p class="text-gray-600">Bermain sambil belajar huruf hijaiyah</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${games.map((game, index) => `
                        <div class="game-card bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-xl text-center ${progress.games.includes(index) ? 'bg-gradient-to-br from-green-200 to-green-300' : ''}" 
                             onclick="playGame(${index})">
                            <div class="text-5xl mb-4">${game.icon}</div>
                            <h3 class="text-xl font-bold text-purple-800 mb-2">${game.name}</h3>
                            <p class="text-purple-600 text-sm mb-4">${game.desc}</p>
                            ${progress.games.includes(index) ? 
                                '<div class="text-green-600"><i class="fas fa-trophy mr-2"></i>Selesai</div>' : 
                                '<button class="btn-purple text-white px-4 py-2 rounded-lg text-sm">Mainkan</button>'
                            }
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
        }

        // Play game function - SEKARANG BENAR-BENAR INTERAKTIF!
        function playGame(gameIndex) {
            switch(gameIndex) {
                case 0:
                    showMemoryGame();
                    break;
                case 1:
                    showGuessLetterGame();
                    break;
                case 2:
                    showWordBuilderGame();
                    break;
                case 3:
                    showQuickQuizGame();
                    break;
                case 4:
                    showPuzzleGame();
                    break;
            }
        }

        // Memory Game - Game mencocokkan huruf
        function showMemoryGame() {
            const gameLetters = hijaiyahLetters.slice(0, 8); // 8 pasang huruf
            const cards = [...gameLetters, ...gameLetters].sort(() => Math.random() - 0.5);
            
            let gameData = {
                cards: cards,
                flippedCards: [],
                matchedPairs: 0,
                moves: 0,
                timeLeft: 120,
                timer: null
            };

            function showMemoryBoard() {
                const content = `
                    <div class="text-center mb-6">
                        <button onclick="showGames()" class="btn-islamic text-white p-3 rounded-lg mb-4">
                            <i class="fas fa-arrow-left"></i> Kembali
                        </button>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">🧠 Memory Huruf</h3>
                        <div class="flex justify-center space-x-4 mb-4">
                            <div class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full">
                                Langkah: <span id="moveCount">${gameData.moves}</span>
                            </div>
                            <div class="bg-green-100 text-green-800 px-4 py-2 rounded-full">
                                Pasangan: <span id="pairCount">${gameData.matchedPairs}/8</span>
                            </div>
                            <div class="bg-red-100 text-red-800 px-4 py-2 rounded-full">
                                Waktu: <span id="timeLeft">${gameData.timeLeft}s</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-4xl mx-auto">
                        <div class="grid grid-cols-4 gap-4 mb-6">
                            ${cards.map((card, index) => `
                                <div class="memory-card h-24 cursor-pointer" onclick="flipCard(${index})" id="card-${index}">
                                    <div class="memory-card-inner h-full">
                                        <div class="memory-card-front bg-purple-600 flex items-center justify-center rounded-lg">
                                            <i class="fas fa-question text-white text-2xl"></i>
                                        </div>
                                        <div class="memory-card-back bg-white border-2 border-purple-300 flex items-center justify-center rounded-lg">
                                            <div class="arabic-text text-3xl font-bold text-purple-800">${card.letter}</div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="text-center">
                            <p class="text-gray-600">Klik kartu untuk membalik dan cocokkan huruf yang sama!</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('contentArea').innerHTML = content;
                startMemoryTimer();
            }

            function startMemoryTimer() {
                gameData.timer = setInterval(() => {
                    gameData.timeLeft--;
                    const timeElement = document.getElementById('timeLeft');
                    if (timeElement) {
                        timeElement.textContent = gameData.timeLeft + 's';
                    }
                    
                    if (gameData.timeLeft <= 0) {
                        clearInterval(gameData.timer);
                        endMemoryGame(false);
                    }
                }, 1000);
            }

            window.flipCard = function(index) {
                if (gameData.flippedCards.length >= 2) return;
                
                const card = document.getElementById(`card-${index}`);
                if (card.classList.contains('flipped')) return;
                
                card.classList.add('flipped');
                gameData.flippedCards.push(index);
                
                if (gameData.flippedCards.length === 2) {
                    gameData.moves++;
                    document.getElementById('moveCount').textContent = gameData.moves;
                    
                    setTimeout(() => {
                        checkMemoryMatch();
                    }, 1000);
                }
            };

            function checkMemoryMatch() {
                const [first, second] = gameData.flippedCards;
                const firstCard = gameData.cards[first];
                const secondCard = gameData.cards[second];
                
                if (firstCard.letter === secondCard.letter) {
                    // Match found
                    gameData.matchedPairs++;
                    document.getElementById('pairCount').textContent = `${gameData.matchedPairs}/8`;
                    
                    // Keep cards flipped
                    gameData.flippedCards = [];
                    
                    if (gameData.matchedPairs === 8) {
                        clearInterval(gameData.timer);
                        endMemoryGame(true);
                    }
                } else {
                    // No match, flip back
                    const card1 = document.getElementById(`card-${first}`);
                    const card2 = document.getElementById(`card-${second}`);
                    
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    gameData.flippedCards = [];
                }
            }

            function endMemoryGame(won) {
                const timeUsed = 120 - gameData.timeLeft;
                const score = won ? Math.max(50, 100 - gameData.moves - Math.floor(timeUsed/10)) : 0;
                
                Swal.fire({
                    title: won ? '🎉 Selamat!' : '⏰ Waktu Habis!',
                    html: `
                        <div class="text-center">
                            <div class="text-4xl mb-4 ${won ? 'text-green-500' : 'text-red-500'}">
                                <i class="fas fa-${won ? 'trophy' : 'clock'}"></i>
                            </div>
                            <p class="text-lg mb-2">${won ? 'Memory Game selesai!' : 'Coba lagi lain kali!'}</p>
                            <div class="space-y-2">
                                <p>Langkah: ${gameData.moves}</p>
                                <p>Waktu: ${timeUsed}s</p>
                                <p class="text-xl font-bold text-purple-600">Skor: ${score}/100</p>
                            </div>
                        </div>
                    `,
                    icon: won ? 'success' : 'error',
                    confirmButtonColor: '#059669'
                }).then(() => {
                    if (won && !progress.games.includes(0)) {
                        progress.games.push(0);
                        saveToLocalStorage('gameProgress', progress.games);
                        updateAllProgress();
                    }
                    showGames();
                });
            }

            showMemoryBoard();
        }

        // Tebak Huruf Game
        function showGuessLetterGame() {
            const gameLetters = hijaiyahLetters.slice(0, 10);
            let gameData = {
                letters: gameLetters.sort(() => Math.random() - 0.5),
                currentIndex: 0,
                score: 0,
                totalQuestions: 10
            };
            
            function showGuessQuestion() {
                if (gameData.currentIndex < gameData.totalQuestions) {
                    const letter = gameData.letters[gameData.currentIndex];
                    const options = [letter.name];
                    
                    // Add 3 random wrong options
                    while (options.length < 4) {
                        const randomLetter = hijaiyahLetters[Math.floor(Math.random() * hijaiyahLetters.length)];
                        if (!options.includes(randomLetter.name)) {
                            options.push(randomLetter.name);
                        }
                    }
                    
                    // Shuffle options
                    const shuffledOptions = options.sort(() => Math.random() - 0.5);
                    const correctIndex = shuffledOptions.indexOf(letter.name);
                    
                    const content = `
                        <div class="text-center mb-8">
                            <button onclick="showGames()" class="btn-islamic text-white p-3 rounded-lg mb-4">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </button>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">❓ Tebak Huruf</h3>
                            <div class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full inline-block mb-4">
                                Soal ${gameData.currentIndex + 1} dari ${gameData.totalQuestions} | Skor: ${gameData.score}
                            </div>
                        </div>
                        
                        <div class="max-w-2xl mx-auto">
                            <div class="bg-white border-2 border-purple-300 rounded-xl p-8 text-center mb-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Huruf apakah ini?</h3>
                                <div class="arabic-text text-8xl font-bold text-purple-800 mb-6 letter-glow">${letter.letter}</div>
                                <div class="grid grid-cols-2 gap-4">
                                    ${shuffledOptions.map((option, index) => `
                                        <button onclick="selectGuessAnswer(${index}, ${correctIndex}, '${letter.name}')" 
                                                id="guessBtn${index}"
                                                class="bg-purple-100 hover:bg-purple-200 border-2 border-purple-300 hover:border-purple-500 p-4 rounded-lg font-semibold text-purple-800 transition-all">
                                            ${option}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('contentArea').innerHTML = content;
                } else {
                    // Game finished
                    const finalScore = Math.round((gameData.score / gameData.totalQuestions) * 100);
                    
                    Swal.fire({
                        title: 'Game Selesai!',
                        html: `
                            <div class="text-center">
                                <div class="text-6xl mb-4 text-yellow-500"><i class="fas fa-trophy"></i></div>
                                <p class="text-xl mb-2">Tebak Huruf Selesai!</p>
                                <p class="text-lg font-bold text-purple-600">Skor: ${finalScore}/100</p>
                                <p class="text-gray-600 mt-2">Benar: ${gameData.score}/${gameData.totalQuestions}</p>
                            </div>
                        `,
                        icon: 'success',
                        confirmButtonColor: '#059669'
                    }).then(() => {
                        if (!progress.games.includes(1)) {
                            progress.games.push(1);
                            saveToLocalStorage('gameProgress', progress.games);
                            updateAllProgress();
                        }
                        showGames();
                    });
                }
            }
            
            window.selectGuessAnswer = function(selectedIndex, correctIndex, correctName) {
                const buttons = document.querySelectorAll('button[id^="guessBtn"]');
                
                // Disable all buttons
                buttons.forEach(btn => btn.disabled = true);
                
                if (selectedIndex === correctIndex) {
                    gameData.score++;
                    buttons[selectedIndex].classList.add('correct-answer');
                    
                    Swal.fire({
                        title: '✅ Benar!',
                        text: `Huruf tersebut adalah ${correctName}`,
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } else {
                    buttons[selectedIndex].classList.add('wrong-answer');
                    buttons[correctIndex].classList.add('correct-answer');
                    
                    Swal.fire({
                        title: '❌ Salah!',
                        text: `Jawaban yang benar adalah: ${correctName}`,
                        icon: 'error',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
                gameData.currentIndex++;
                setTimeout(showGuessQuestion, 2000);
            };
            
            showGuessQuestion();
        }

        // Quick Quiz Game
        function showQuickQuizGame() {
            const quizQuestions = [
                {question: 'Berapa jumlah huruf hijaiyah?', options: ['26', '28', '30', '32'], correct: 1},
                {question: 'Huruf pertama dalam hijaiyah adalah:', options: ['ا (Alif)', 'ب (Ba)', 'ت (Ta)', 'ث (Tsa)'], correct: 0},
                {question: 'Huruf apa ini? ج', options: ['Ha', 'Kha', 'Jim', 'Dal'], correct: 2},
                {question: 'Bacaan "مَا" adalah:', options: ['mi', 'ma', 'mu', 'me'], correct: 1},
                {question: 'Huruf apa ini? ر', options: ['Zai', 'Ra', 'Sin', 'Syin'], correct: 1}
            ];
            
            let gameData = {
                questions: quizQuestions,
                currentIndex: 0,
                score: 0,
                timeLeft: 15,
                timer: null
            };
            
            function showQuizQuestion() {
                if (gameData.currentIndex < gameData.questions.length) {
                    const question = gameData.questions[gameData.currentIndex];
                    gameData.timeLeft = 15;
                    
                    const content = `
                        <div class="text-center mb-8">
                            <button onclick="endQuickQuiz()" class="btn-islamic text-white p-3 rounded-lg mb-4">
                                <i class="fas fa-arrow-left"></i> Kembali
                            </button>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">⚡ Kuis Cepat</h3>
                            <div class="flex justify-center space-x-4 mb-4">
                                <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                                    Soal ${gameData.currentIndex + 1}/${gameData.questions.length}
                                </div>
                                <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                    Skor: ${gameData.score}
                                </div>
                                <div id="timer" class="bg-red-100 text-red-800 px-3 py-1 rounded-full font-bold text-sm">
                                    ⏰ ${gameData.timeLeft}s
                                </div>
                            </div>
                        </div>
                        
                        <div class="max-w-3xl mx-auto">
                            <div class="bg-white border-2 border-purple-300 rounded-xl p-6 text-center mb-4">
                                <h3 class="text-xl font-bold text-gray-800 mb-6">${question.question}</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    ${question.options.map((option, index) => `
                                        <button onclick="selectQuizAnswer(${index})" 
                                                id="quizBtn${index}"
                                                class="bg-purple-50 hover:bg-purple-100 border-2 border-purple-200 hover:border-purple-400 p-4 rounded-lg font-semibold text-purple-800 transition-all">
                                            ${option}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('contentArea').innerHTML = content;
                    startQuizTimer();
                } else {
                    endQuickQuiz();
                }
            }
            
            function startQuizTimer() {
                gameData.timer = setInterval(() => {
                    gameData.timeLeft--;
                    const timerElement = document.getElementById('timer');
                    if (timerElement) {
                        timerElement.textContent = `⏰ ${gameData.timeLeft}s`;
                    }
                    
                    if (gameData.timeLeft <= 0) {
                        clearInterval(gameData.timer);
                        gameData.currentIndex++;
                        setTimeout(showQuizQuestion, 1000);
                    }
                }, 1000);
            }
            
            window.selectQuizAnswer = function(selectedIndex) {
                clearInterval(gameData.timer);
                const question = gameData.questions[gameData.currentIndex];
                const buttons = document.querySelectorAll('button[id^="quizBtn"]');
                
                buttons.forEach(btn => btn.disabled = true);
                
                if (selectedIndex === question.correct) {
                    gameData.score++;
                    buttons[selectedIndex].classList.add('correct-answer');
                    
                    Swal.fire({
                        title: '✅ Benar!',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } else {
                    buttons[selectedIndex].classList.add('wrong-answer');
                    buttons[question.correct].classList.add('correct-answer');
                    
                    Swal.fire({
                        title: '❌ Salah!',
                        text: `Jawaban yang benar: ${question.options[question.correct]}`,
                        icon: 'error',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
                gameData.currentIndex++;
                setTimeout(showQuizQuestion, 2000);
            };
            
            window.endQuickQuiz = function() {
                if (gameData.timer) clearInterval(gameData.timer);
                
                const finalScore = Math.round((gameData.score / gameData.questions.length) * 100);
                
                Swal.fire({
                    title: 'Kuis Selesai!',
                    html: `
                        <div class="text-center">
                            <div class="text-6xl mb-4 text-yellow-500"><i class="fas fa-trophy"></i></div>
                            <p class="text-xl mb-2">Kuis Cepat Selesai!</p>
                            <p class="text-lg font-bold text-purple-600">Skor: ${finalScore}/100</p>
                            <p class="text-gray-600 mt-2">Benar: ${gameData.score}/${gameData.questions.length}</p>
                        </div>
                    `,
                    icon: 'success',
                    confirmButtonColor: '#059669'
                }).then(() => {
                    if (!progress.games.includes(3)) {
                        progress.games.push(3);
                        saveToLocalStorage('gameProgress', progress.games);
                        updateAllProgress();
                    }
                    showGames();
                });
            };
            
            showQuizQuestion();
        }

        // Word Builder Game (placeholder)
        function showWordBuilderGame() {
            Swal.fire({
                title: '🔧 Dalam Pengembangan',
                text: 'Game Susun Kata sedang dalam tahap pengembangan. Akan segera hadir!',
                icon: 'info',
                confirmButtonColor: '#059669'
            }).then(() => {
                showGames();
            });
        }

        // Puzzle Game (placeholder)
        function showPuzzleGame() {
            Swal.fire({
                title: '🔧 Dalam Pengembangan',
                text: 'Game Puzzle Huruf sedang dalam tahap pengembangan. Akan segera hadir!',
                icon: 'info',
                confirmButtonColor: '#059669'
            }).then(() => {
                showGames();
            });
        }

        // Show Evaluation Section - SEKARANG LENGKAP!
        function showEvaluation() {
            hideMenuAndWelcome();
            
            const content = `
                <div class="text-center mb-8">
                    <button onclick="showHome()" class="btn-islamic text-white p-3 rounded-lg mb-4 text-lg">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-clipboard-check text-orange-600 mr-3"></i>Evaluasi
                    </h2>
                    <p class="text-gray-600">Uji kemampuan membaca Anda</p>
                </div>
                
                <div class="max-w-2xl mx-auto">
                    <div class="bg-gradient-to-br from-orange-100 to-yellow-100 p-8 rounded-xl text-center">
                        <div class="text-6xl mb-4 text-orange-600">
                            <i class="fas fa-medal"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Evaluasi Akhir</h3>
                        <p class="text-gray-600 mb-6">Selesaikan semua materi untuk membuka evaluasi akhir</p>
                        
                        <div class="space-y-4 mb-6">
                            <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                                <span>Belajar Huruf</span>
                                <span class="${progress.letters.length >= 28 ? 'text-green-600' : 'text-orange-600'}">
                                    ${progress.letters.length}/28 ${progress.letters.length >= 28 ? '✅' : '⏳'}
                                </span>
                            </div>
                            <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                                <span>Latihan Membaca</span>
                                <span class="${progress.reading.length >= 20 ? 'text-green-600' : 'text-orange-600'}">
                                    ${progress.reading.length}/20 ${progress.reading.length >= 20 ? '✅' : '⏳'}
                                </span>
                            </div>
                            <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                                <span>Game Edukatif</span>
                                <span class="${progress.games.length >= 3 ? 'text-green-600' : 'text-orange-600'}">
                                    ${progress.games.length}/3 ${progress.games.length >= 3 ? '✅' : '⏳'}
                                </span>
                            </div>
                        </div>
                        
                        <button onclick="startEvaluation()" 
                                class="btn-gold text-white px-8 py-3 rounded-lg font-semibold ${progress.letters.length >= 10 && progress.reading.length >= 5 && progress.games.length >= 1 ? '' : 'opacity-50 cursor-not-allowed'}"
                                ${progress.letters.length >= 10 && progress.reading.length >= 5 && progress.games.length >= 1 ? '' : 'disabled'}>
                            <i class="fas fa-play mr-2"></i>Mulai Evaluasi
                        </button>
                        
                        <p class="text-xs text-gray-500 mt-2">
                            *Syarat: Min. 10 huruf, 5 latihan membaca, dan 1 game selesai
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
        }

        // Start evaluation function - SEKARANG BENAR-BENAR ADA EVALUASINYA!
        function startEvaluation() {
            const evaluationQuestions = [
                {question: 'Huruf apa ini?', letter: 'ب', options: ['Ba', 'Ta', 'Tsa', 'Jim'], correct: 0},
                {question: 'Huruf apa ini?', letter: 'ج', options: ['Ha', 'Kha', 'Jim', 'Dal'], correct: 2},
                {question: 'Bacaan "مَا" adalah:', options: ['mi', 'ma', 'mu', 'me'], correct: 1},
                {question: 'Huruf apa ini?', letter: 'ر', options: ['Zai', 'Ra', 'Sin', 'Syin'], correct: 1},
                {question: 'Bacaan "بِي" adalah:', options: ['ba', 'bi', 'bu', 'be'], correct: 1},
                {question: 'Huruf apa ini?', letter: 'ن', options: ['Mim', 'Nun', 'Waw', 'Ha'], correct: 1},
                {question: 'Berapa jumlah huruf hijaiyah?', options: ['26', '28', '30', '32'], correct: 1},
                {question: 'Huruf pertama hijaiyah adalah:', options: ['ا (Alif)', 'ب (Ba)', 'ت (Ta)', 'ث (Tsa)'], correct: 0},
                {question: 'Bacaan "كَا" adalah:', options: ['ki', 'ku', 'ka', 'ke'], correct: 2},
                {question: 'Huruf terakhir hijaiyah adalah:', options: ['و (Waw)', 'ه (Ha)', 'ي (Ya)', 'ء (Hamzah)'], correct: 2}
            ];
            
            let evalData = {
                questions: evaluationQuestions,
                currentIndex: 0,
                score: 0,
                answers: []
            };
            
            function showEvaluationQuestion() {
                if (evalData.currentIndex < evalData.questions.length) {
                    const question = evalData.questions[evalData.currentIndex];
                    
                    const content = `
                        <div class="text-center mb-8">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">📋 Evaluasi Akhir</h3>
                            <div class="bg-orange-100 text-orange-800 px-4 py-2 rounded-full inline-block mb-4">
                                Soal ${evalData.currentIndex + 1} dari ${evalData.questions.length}
                            </div>
                        </div>
                        
                        <div class="max-w-2xl mx-auto">
                            <div class="bg-white border-2 border-orange-300 rounded-xl p-8 text-center mb-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">${question.question}</h3>
                                ${question.letter ? `<div class="arabic-text text-8xl font-bold text-orange-800 mb-6 letter-glow">${question.letter}</div>` : ''}
                                <div class="grid grid-cols-2 gap-4">
                                    ${question.options.map((option, index) => `
                                        <button onclick="selectEvalAnswer(${index})" 
                                                id="evalBtn${index}"
                                                class="bg-orange-100 hover:bg-orange-200 border-2 border-orange-300 hover:border-orange-500 p-4 rounded-lg font-semibold text-orange-800 transition-all">
                                            ${option}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div class="bg-gray-200 rounded-full h-2 mb-4">
                                <div class="bg-gradient-to-r from-orange-500 to-yellow-500 h-2 rounded-full transition-all duration-300" 
                                     style="width: ${(evalData.currentIndex / evalData.questions.length) * 100}%"></div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('contentArea').innerHTML = content;
                } else {
                    // Evaluation finished
                    finishEvaluation();
                }
            }
            
            window.selectEvalAnswer = function(selectedIndex) {
                const question = evalData.questions[evalData.currentIndex];
                const buttons = document.querySelectorAll('button[id^="evalBtn"]');
                
                buttons.forEach(btn => btn.disabled = true);
                
                const isCorrect = selectedIndex === question.correct;
                evalData.answers.push({
                    question: question.question,
                    selected: question.options[selectedIndex],
                    correct: question.options[question.correct],
                    isCorrect: isCorrect
                });
                
                if (isCorrect) {
                    evalData.score++;
                    buttons[selectedIndex].classList.add('correct-answer');
                } else {
                    buttons[selectedIndex].classList.add('wrong-answer');
                    buttons[question.correct].classList.add('correct-answer');
                }
                
                setTimeout(() => {
                    evalData.currentIndex++;
                    showEvaluationQuestion();
                }, 1500);
            };
            
            function finishEvaluation() {
                const finalScore = Math.round((evalData.score / evalData.questions.length) * 100);
                progress.evaluation = finalScore;
                saveToLocalStorage('evaluationProgress', finalScore);
                updateAllProgress();
                
                let grade, message, color;
                if (finalScore >= 90) {
                    grade = 'A';
                    message = 'Luar Biasa! Anda menguasai materi dengan sangat baik!';
                    color = 'text-green-600';
                } else if (finalScore >= 80) {
                    grade = 'B';
                    message = 'Bagus! Anda memahami sebagian besar materi dengan baik!';
                    color = 'text-blue-600';
                } else if (finalScore >= 70) {
                    grade = 'C';
                    message = 'Cukup! Terus berlatih untuk hasil yang lebih baik!';
                    color = 'text-yellow-600';
                } else {
                    grade = 'D';
                    message = 'Perlu belajar lagi. Jangan menyerah, terus berlatih!';
                    color = 'text-red-600';
                }
                
                const content = `
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-clipboard-check text-orange-600 mr-3"></i>Hasil Evaluasi
                        </h2>
                    </div>
                    
                    <div class="max-w-3xl mx-auto">
                        <div class="bg-gradient-to-br from-orange-100 to-yellow-100 p-8 rounded-xl text-center mb-6">
                            <div class="text-6xl mb-4 text-yellow-500">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h3 class="text-3xl font-bold ${color} mb-2">Nilai: ${grade}</h3>
                            <p class="text-2xl font-bold text-gray-800 mb-4">Skor: ${finalScore}/100</p>
                            <p class="text-lg text-gray-600 mb-6">${message}</p>
                            
                            <div class="bg-white rounded-lg p-6 mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4">Detail Hasil:</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-600">${evalData.score}</div>
                                        <div class="text-gray-600">Benar</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-red-600">${evalData.questions.length - evalData.score}</div>
                                        <div class="text-gray-600">Salah</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-x-4">
                                <button onclick="showDetailedResults()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
                                    <i class="fas fa-list mr-2"></i>Lihat Detail
                                </button>
                                <button onclick="showHome()" class="btn-islamic text-white px-6 py-3 rounded-lg font-semibold">
                                    <i class="fas fa-home mr-2"></i>Kembali ke Menu
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('contentArea').innerHTML = content;
                
                // Store evaluation data for detailed results
                window.evaluationResults = evalData;
            }
            
            // Start the evaluation
            Swal.fire({
                title: '🎯 Evaluasi Dimulai!',
                text: 'Anda akan mengerjakan 10 soal evaluasi. Selamat mengerjakan!',
                icon: 'info',
                confirmButtonText: 'Mulai',
                confirmButtonColor: '#059669'
            }).then(() => {
                showEvaluationQuestion();
            });
        }

        // Show detailed evaluation results
        function showDetailedResults() {
            if (!window.evaluationResults) return;
            
            const results = window.evaluationResults;
            
            const content = `
                <div class="text-center mb-8">
                    <button onclick="showEvaluation()" class="btn-islamic text-white p-3 rounded-lg mb-4">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-list text-blue-600 mr-3"></i>Detail Hasil Evaluasi
                    </h2>
                </div>
                
                <div class="max-w-4xl mx-auto">
                    <div class="space-y-4">
                        ${results.answers.map((answer, index) => `
                            <div class="bg-white border-2 ${answer.isCorrect ? 'border-green-300' : 'border-red-300'} rounded-lg p-4">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-800 mb-2">
                                            ${index + 1}. ${answer.question}
                                        </h4>
                                        <div class="space-y-1 text-sm">
                                            <p class="text-gray-600">
                                                <strong>Jawaban Anda:</strong> 
                                                <span class="${answer.isCorrect ? 'text-green-600' : 'text-red-600'}">${answer.selected}</span>
                                            </p>
                                            ${!answer.isCorrect ? `<p class="text-gray-600"><strong>Jawaban Benar:</strong> <span class="text-green-600">${answer.correct}</span></p>` : ''}
                                        </div>
                                    </div>
                                    <div class="ml-4">
                                        <div class="${answer.isCorrect ? 'text-green-600' : 'text-red-600'} text-2xl">
                                            <i class="fas fa-${answer.isCorrect ? 'check-circle' : 'times-circle'}"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="text-center mt-8">
                        <button onclick="showHome()" class="btn-islamic text-white px-8 py-3 rounded-lg font-semibold">
                            <i class="fas fa-home mr-2"></i>Kembali ke Menu Utama
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
        }

        // Utility functions
        function hideMenuAndWelcome() {
            const menuCards = document.getElementById('menuCards');
            const welcomeSection = document.querySelector('.text-center.mb-12');
            
            if (menuCards) menuCards.style.display = 'none';
            if (welcomeSection) welcomeSection.style.display = 'none';
        }

        function showMenuAndWelcome() {
            const menuCards = document.getElementById('menuCards');
            const welcomeSection = document.querySelector('.text-center.mb-12');
            
            if (menuCards) menuCards.style.display = 'grid';
            if (welcomeSection) welcomeSection.style.display = 'block';
        }

        function showHome() {
            showMenuAndWelcome();
            
            const content = `
                <div class="text-center py-12">
                    <div class="text-6xl mb-6 float text-yellow-500">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Pilih Menu untuk Memulai</h3>
                    <p class="text-gray-600">Klik salah satu menu di atas untuk memulai pembelajaran</p>
                    <div class="mt-8">
                        <button onclick="showProfileSetup()" class="btn-islamic text-white px-8 py-3 rounded-lg font-semibold mr-4">
                            <i class="fas fa-user-plus mr-2"></i>Atur Profil
                        </button>
                        <button onclick="testMicrophone()" class="btn-blue text-white px-8 py-3 rounded-lg font-semibold">
                            <i class="fas fa-microphone mr-2"></i>Tes Mikrofon
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('contentArea').innerHTML = content;
        }

        function updateAllProgress() {
            // Update letter progress
            const letterProgressBar = document.getElementById('letterProgress');
            const letterProgressText = document.getElementById('letterProgressText');
            if (letterProgressBar && letterProgressText) {
                const letterPercent = (progress.letters.length / 28) * 100;
                letterProgressBar.style.width = letterPercent + '%';
                letterProgressText.textContent = `${progress.letters.length}/28 huruf`;
            }

            // Update reading progress
            const readingProgressBar = document.getElementById('readingProgress');
            const readingProgressText = document.getElementById('readingProgressText');
            if (readingProgressBar && readingProgressText) {
                const readingPercent = (progress.reading.length / 20) * 100;
                readingProgressBar.style.width = readingPercent + '%';
                readingProgressText.textContent = `${progress.reading.length}/20 latihan`;
            }

            // Update game progress
            const gameProgressBar = document.getElementById('gameProgress');
            const gameProgressText = document.getElementById('gameProgressText');
            if (gameProgressBar && gameProgressText) {
                const gamePercent = (progress.games.length / 5) * 100;
                gameProgressBar.style.width = gamePercent + '%';
                gameProgressText.textContent = `${progress.games.length}/5 game`;
            }

            // Update evaluation progress
            const evalProgressBar = document.getElementById('evalProgress');
            const evalProgressText = document.getElementById('evalProgressText');
            if (evalProgressBar && evalProgressText) {
                if (progress.evaluation > 0) {
                    evalProgressBar.style.width = '100%';
                    evalProgressText.textContent = `Selesai (${progress.evaluation}/100)`;
                } else {
                    evalProgressBar.style.width = '0%';
                    evalProgressText.textContent = 'Belum dimulai';
                }
            }

            // Update overall progress
            const overallProgressBar = document.getElementById('overallProgress');
            const progressText = document.getElementById('progressText');
            if (overallProgressBar && progressText) {
                const totalItems = 28 + 20 + 5; // letters + reading + games
                const completedItems = progress.letters.length + progress.reading.length + progress.games.length;
                let overallPercent = (completedItems / totalItems) * 100;
                
                // Add evaluation bonus
                if (progress.evaluation > 0) {
                    overallPercent = Math.min(100, overallPercent + 10);
                }
                
                overallProgressBar.style.width = overallPercent + '%';
                progressText.textContent = Math.round(overallPercent) + '%';
            }
        }

        // Initialize app
        function initializeApp() {
            // Load progress data
            progress.letters = loadFromLocalStorage('letterProgress', []);
            progress.reading = loadFromLocalStorage('readingProgress', []);
            progress.games = loadFromLocalStorage('gameProgress', []);
            progress.evaluation = loadFromLocalStorage('evaluationProgress', 0);
            
            // Load user profile
            loadUserProfile();
            
            // Update progress bars
            updateAllProgress();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Make functions globally available
        window.testMicrophone = testMicrophone;
        window.showProfileSetup = showProfileSetup;
        window.showLetters = showLetters;
        window.showReading = showReading;
        window.showGames = showGames;
        window.showEvaluation = showEvaluation;
        window.showHome = showHome;
        window.learnLetter = learnLetter;
        window.practiceReading = practiceReading;
        window.playGame = playGame;
        window.startEvaluation = startEvaluation;
        window.showDetailedResults = showDetailedResults;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975a266591318930',t:'MTc1NjI4MjgzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
