<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
        
        body {
            font-family: 'Amiri', serif;
            background: linear-gradient(135deg, #0f766e 0%, #065f46 50%, #1e40af 100%);
            background-size: 400% 400%;
            background-attachment: fixed;
            animation: islamicGradient 15s ease infinite;
            position: relative;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.08) 0%, transparent 40%),
                radial-gradient(circle at 40% 60%, rgba(255,255,255,0.05) 0%, transparent 30%),
                url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.06'%3E%3Cpath d='M40 40m-15 0a15 15 0 1 1 30 0a15 15 0 1 1 -30 0'/%3E%3Cpath d='M40 25v30M25 40h30'/%3E%3Cpath d='M29.29 29.29l21.42 21.42M50.71 29.29l-21.42 21.42'/%3E%3Cpolygon points='40,20 45,30 55,30 47,38 50,48 40,42 30,48 33,38 25,30 35,30'/%3E%3C/g%3E%3C/svg%3E");
            background-size: 80px 80px, 120px 120px, 60px 60px, 80px 80px;
            animation: islamicPattern 25s linear infinite;
            z-index: -1;
            pointer-events: none;
        }
        
        @keyframes islamicGradient {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes islamicPattern {
            0% { 
                background-position: 0px 0px, 0px 0px, 0px 0px, 0px 0px;
                transform: rotate(0deg);
            }
            25% { 
                background-position: 40px 40px, -60px 60px, 30px -30px, 40px 40px;
                transform: rotate(0.5deg);
            }
            50% { 
                background-position: 80px 0px, -120px 0px, 60px 0px, 80px 0px;
                transform: rotate(0deg);
            }
            75% { 
                background-position: 40px -40px, -60px -60px, 30px 30px, 40px -40px;
                transform: rotate(-0.5deg);
            }
            100% { 
                background-position: 0px 0px, 0px 0px, 0px 0px, 0px 0px;
                transform: rotate(0deg);
            }
        }
        
        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.5em;
        }
        
        .islamic-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0 11.046 8.954 20 20 20s20-8.954 20-20-8.954-20-20-20-20 8.954-20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .conversation-animation {
            animation: conversation 3s infinite;
        }
        
        @keyframes conversation {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.05); }
        }
        
        .bounce {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .star {
            color: #ffd700;
            animation: twinkle 1.5s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .game-card {
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .writing-canvas {
            border: 3px dashed #4f46e5;
            background: white;
            cursor: crosshair;
        }
        
        .correct-answer {
            background: #10b981 !important;
            color: white;
            animation: correctPulse 0.5s ease;
        }
        
        .wrong-answer {
            background: #ef4444 !important;
            color: white;
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-emerald-800 to-teal-700 shadow-2xl p-4 islamic-pattern">
        <div class="container mx-auto">
            <!-- Top Row: Title and Settings -->
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-white to-gray-100 rounded-full flex items-center justify-center shadow-lg border-2 border-white border-opacity-50">
                        <img src="https://cdn-icons-png.flaticon.com/128/12277/12277320.png" alt="Logo" class="w-8 h-8" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="text-2xl text-emerald-600 hidden">
                            <i class="fas fa-mosque"></i>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white arabic-text">ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h1>
                        <p class="text-sm text-emerald-100">Kelas 1 MI</p>
                    </div>
                </div>
                <button onclick="showProfileModal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-3 rounded-full transition-colors">
                    <i class="fas fa-cog text-lg"></i>
                </button>
            </div>
            
            <!-- Bottom Row: Points and Stars -->
            <div class="flex items-center justify-end">
                <!-- Points and Stars -->
                <div class="flex items-center space-x-2">
                    <div class="bg-yellow-400 px-3 py-2 rounded-full shadow-lg">
                        <span class="text-yellow-900 font-bold text-sm">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="totalPoints">0</span></span>
                    </div>
                    <div id="stars" class="flex space-x-1"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Student Profile Section -->
    <div class="container mx-auto px-4 py-2">
        <div id="studentProfile" class="flex items-center justify-center bg-white bg-opacity-20 backdrop-blur-sm px-4 py-3 rounded-2xl shadow-lg border border-white border-opacity-30 max-w-sm mx-auto">
            <div id="studentPhoto" class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-lg font-bold mr-3">
                ğŸ‘¤
            </div>
            <div class="text-center">
                <div class="text-white font-bold text-lg" id="studentName">Siswa</div>
                <div class="text-emerald-100 text-sm">Ø·Ø§Ù„Ø¨ Ù…Ø¬ØªÙ‡Ø¯</div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto p-4">
        <!-- Main Menu -->
        <div id="mainMenu" class="text-center">
            <h2 class="text-3xl font-bold text-white mb-8 arabic-text bounce">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</h2>
            <div class="grid grid-cols-1 gap-6 max-w-md mx-auto">
                <!-- Ø§Ù„ØªØ¹Ø§Ø±Ù Menu -->
                <div class="bg-gradient-to-br from-white to-emerald-50 rounded-2xl p-6 shadow-2xl game-card cursor-pointer border-3 border-emerald-200" onclick="showTopicMenu('introduction')">
                    <div class="text-5xl mb-4 text-emerald-600">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-emerald-800 mb-3 arabic-text">Ø§Ù„ØªØ¹Ø§Ø±Ù</h3>
                    <p class="text-lg text-gray-700 mb-2 font-semibold">Perkenalan</p>
                    <div class="text-sm text-gray-600">ØªØ¹Ù„Ù… ÙƒÙŠÙ ØªØ¹Ø±Ù Ø¨Ù†ÙØ³Ùƒ</div>
                </div>
                
                <!-- Ø£Ø³Ø±ØªÙŠ Menu -->
                <div class="bg-gradient-to-br from-white to-blue-50 rounded-2xl p-6 shadow-2xl game-card cursor-pointer border-3 border-blue-200" onclick="showTopicMenu('family')">
                    <div class="text-5xl mb-4 text-blue-600">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-blue-800 mb-3 arabic-text">Ø£Ø³Ø±ØªÙŠ</h3>
                    <p class="text-lg text-gray-700 mb-2 font-semibold">Keluargaku</p>
                    <div class="text-sm text-gray-600">ØªØ¹Ù„Ù… Ø¹Ù† Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø±Ø©</div>
                </div>
            </div>
        </div>

        <!-- Topic Menu -->
        <div id="topicMenu" class="hidden">
            <div class="flex items-center mb-6">
                <button onclick="showMainMenu()" class="bg-white text-emerald-800 px-4 py-2 rounded-full shadow-lg hover:bg-gray-100 transition-colors text-sm font-semibold">
                    <i class="fas fa-arrow-left mr-1"></i> Kembali
                </button>
                <h2 id="topicTitle" class="text-2xl font-bold text-white mx-auto arabic-text"></h2>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <!-- Listening Skill -->
                <div class="bg-gradient-to-br from-white to-blue-50 rounded-xl p-4 shadow-xl game-card cursor-pointer border-2 border-blue-200" onclick="showSkill('listening')">
                    <div class="text-3xl mb-2 text-blue-600">
                        <i class="fas fa-ear-listen"></i>
                    </div>
                    <h3 class="text-lg font-bold text-blue-800 mb-1 arabic-text">Ø§Ø³ØªÙ…Ø§Ø¹</h3>
                    <p class="text-gray-700 text-sm font-semibold">Menyimak</p>
                </div>
                
                <!-- Speaking Skill -->
                <div class="bg-gradient-to-br from-white to-green-50 rounded-xl p-4 shadow-xl game-card cursor-pointer border-2 border-green-200" onclick="showSkill('speaking')">
                    <div class="text-3xl mb-2 text-green-600">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3 class="text-lg font-bold text-green-800 mb-1 arabic-text">ØªØ­Ø¯Ø«</h3>
                    <p class="text-gray-700 text-sm font-semibold">Berbicara</p>
                </div>
                
                <!-- Reading Skill -->
                <div class="bg-gradient-to-br from-white to-orange-50 rounded-xl p-4 shadow-xl game-card cursor-pointer border-2 border-orange-200" onclick="showSkill('reading')">
                    <div class="text-3xl mb-2 text-orange-600">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="text-lg font-bold text-orange-800 mb-1 arabic-text">Ù‚Ø±Ø§Ø¡Ø©</h3>
                    <p class="text-gray-700 text-sm font-semibold">Membaca</p>
                </div>
                
                <!-- Writing Skill -->
                <div class="bg-gradient-to-br from-white to-purple-50 rounded-xl p-4 shadow-xl game-card cursor-pointer border-2 border-purple-200" onclick="showSkill('writing')">
                    <div class="text-3xl mb-2 text-purple-600">
                        <i class="fas fa-pen-fancy"></i>
                    </div>
                    <h3 class="text-lg font-bold text-purple-800 mb-1 arabic-text">ÙƒØªØ§Ø¨Ø©</h3>
                    <p class="text-gray-700 text-sm font-semibold">Menulis</p>
                </div>
            </div>
            
            <!-- Games Section -->
            <div class="mt-6">
                <h3 class="text-xl font-bold text-white mb-4 text-center arabic-text">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h3>
                <div id="gamesContainer" class="grid grid-cols-1 gap-4"></div>
            </div>
        </div>

        <!-- Skill Content -->
        <div id="skillContent" class="hidden">
            <div class="flex items-center mb-4">
                <button onclick="showTopicMenu(currentTopic)" class="bg-white text-emerald-800 px-4 py-2 rounded-full shadow-lg hover:bg-gray-100 transition-colors text-sm font-semibold">
                    <i class="fas fa-arrow-left mr-1"></i> Kembali
                </button>
                <h2 id="skillTitle" class="text-xl font-bold text-white mx-auto arabic-text"></h2>
            </div>
            
            <div id="skillActivity" class="bg-white rounded-xl p-4 shadow-2xl"></div>
        </div>

        <!-- Game Content -->
        <div id="gameContent" class="hidden">
            <div class="flex items-center mb-4">
                <button onclick="showTopicMenu(currentTopic)" class="bg-white text-emerald-800 px-4 py-2 rounded-full shadow-lg hover:bg-gray-100 transition-colors text-sm font-semibold">
                    <i class="fas fa-arrow-left mr-1"></i> Kembali
                </button>
                <h2 id="gameTitle" class="text-xl font-bold text-white mx-auto arabic-text"></h2>
            </div>
            
            <div id="gameActivity" class="bg-white rounded-xl p-4 shadow-2xl"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-emerald-900 to-teal-800 text-white py-6 mt-12 islamic-pattern">
        <div class="container mx-auto text-center">
            <div class="flex items-center justify-center mb-3">
                <div class="w-8 h-8 bg-gradient-to-br from-white to-gray-100 rounded-full flex items-center justify-center shadow-lg border border-white border-opacity-50 mr-3">
                    <img src="https://cdn-icons-png.flaticon.com/128/12277/12277320.png" alt="Logo" class="w-5 h-5" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="text-sm text-emerald-600 hidden">
                        <i class="fas fa-mosque"></i>
                    </div>
                </div>
                <h3 class="text-lg font-bold arabic-text">ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h3>
            </div>
            <div class="text-emerald-100 text-sm mb-2">
                Aplikasi Pembelajaran Bahasa Arab untuk Kelas 1 MI
            </div>
            <div class="text-emerald-200 text-xs">
                Â© 2024 ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© | All Rights Reserved
            </div>
            <div class="text-emerald-300 text-xs mt-1">
                Made with â¤ï¸ by Emes Creative
            </div>
        </div>
    </footer>

    <!-- Profile Modal -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-white to-blue-50 rounded-2xl p-6 text-center w-full max-w-sm border-3 border-blue-200 shadow-2xl">
            <div class="text-4xl mb-4 text-blue-600">
                <i class="fas fa-user-circle"></i>
            </div>
            <h3 class="text-2xl font-bold text-blue-700 mb-4">Profil Siswa</h3>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Nama Siswa:</label>
                <input type="text" id="studentNameInput" class="w-full px-3 py-2 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:outline-none text-base text-center" placeholder="Masukkan nama...">
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Jenis Kelamin:</label>
                <div class="flex justify-center space-x-4 mb-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="gender" value="male" id="genderMale" class="mr-2" onchange="selectGender('male')">
                        <div class="flex items-center bg-blue-100 px-4 py-2 rounded-full border-2 border-blue-300 hover:bg-blue-200 transition-colors">
                            <span class="text-2xl mr-2">ğŸ‘¦</span>
                            <span class="text-blue-700 font-semibold">Laki-laki</span>
                        </div>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="gender" value="female" id="genderFemale" class="mr-2" onchange="selectGender('female')">
                        <div class="flex items-center bg-pink-100 px-4 py-2 rounded-full border-2 border-pink-300 hover:bg-pink-200 transition-colors">
                            <span class="text-2xl mr-2">ğŸ‘§</span>
                            <span class="text-pink-700 font-semibold">Perempuan</span>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Foto Profil:</label>
                
                <!-- Photo Upload Area -->
                <div class="text-center">
                    <div id="photoPreview" class="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-xl font-bold mb-3 overflow-hidden border-3 border-blue-200">
                        ğŸ‘¤
                    </div>
                    <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                    <button onclick="document.getElementById('photoInput').click()" class="bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition-colors text-sm">
                        <i class="fas fa-camera mr-2"></i> Upload Foto
                    </button>
                    <p class="text-xs text-gray-500 mt-2">Opsional - bisa dikosongkan</p>
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="closeProfileModal()" class="bg-gray-500 text-white px-4 py-2 rounded-full hover:bg-gray-600 transition-colors text-sm">
                    <i class="fas fa-times mr-1"></i> Batal
                </button>
                <button onclick="saveProfile()" class="bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition-colors text-sm">
                    <i class="fas fa-save mr-1"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-white to-emerald-50 rounded-2xl p-6 text-center w-full max-w-sm border-3 border-emerald-200 shadow-2xl">
            <div class="text-5xl mb-4 text-emerald-600">
                <i class="fas fa-star"></i>
            </div>
            <h3 class="text-2xl font-bold text-emerald-700 mb-4 arabic-text">Ø£Ø­Ø³Ù†Øª!</h3>
            <p id="successMessage" class="text-gray-700 mb-6 text-base">Jawaban benar! Kamu mendapat 10 poin!</p>
            <button onclick="closeSuccessModal()" class="bg-emerald-500 text-white px-6 py-3 rounded-full hover:bg-emerald-600 transition-colors text-base font-semibold">
                <i class="fas fa-arrow-right mr-2"></i> Lanjutkan
            </button>
        </div>
    </div>

    <script>
        let currentTopic = '';
        let currentSkill = '';
        let totalPoints = 0;
        let stars = 0;
        let studentName = 'Siswa';
        let studentGender = 'male'; // 'male' or 'female'
        let studentAvatar = 'ğŸ‘¤';
        let studentPhoto = null;

        // Vocabulary data
        const vocabulary = {
            introduction: {
                arabic: ['Ø§Ø³Ù…ÙŠ', 'Ø¹Ù…Ø±ÙŠ', 'Ø£Ù†Ø§ Ù…Ù†', 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…', 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…', 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±'],
                indonesian: ['Namaku', 'Umurku', 'Saya dari', 'Assalamu\'alaikum', 'Wa\'alaikumussalam', 'Selamat pagi', 'Selamat sore'],
                phonetic: ['ismi', 'umri', 'ana min', 'assalamu alaikum', 'wa alaikumussalam', 'sabah al-khair', 'masa al-khair']
            },
            family: {
                arabic: ['Ø£Ø¨ÙŠ', 'Ø£Ù…ÙŠ', 'Ø£Ø®ÙŠ', 'Ø£Ø®ØªÙŠ', 'Ø¬Ø¯ÙŠ', 'Ø¬Ø¯ØªÙŠ', 'Ø¹Ù…ÙŠ', 'Ø¹Ù…ØªÙŠ'],
                indonesian: ['Ayahku', 'Ibuku', 'Saudaraku (lk)', 'Saudaraku (pr)', 'Kakekku', 'Nenekku', 'Pamanku', 'Bibiku'],
                phonetic: ['abi', 'ummi', 'akhi', 'ukhti', 'jaddi', 'jaddati', 'ammi', 'ammati']
            }
        };

        // Text-to-Speech function (Demo - in real implementation, use Arabic TTS API)
        function speakArabic(text) {
            // Simulate TTS with Web Speech API (limited Arabic support)
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // Personalized feedback with student name and gender
        function speakPersonalizedFeedback(isCorrect, points = 10) {
            let feedbackText = '';
            
            if (isCorrect) {
                const praises = studentGender === 'male' ? [
                    `Ø£Ø­Ø³Ù†Øª ÙŠØ§ ${studentName}!`,
                    `Ù…Ù…ØªØ§Ø² ÙŠØ§ ${studentName}!`,
                    `Ø¹Ø¸ÙŠÙ… ÙŠØ§ ${studentName}!`
                ] : [
                    `Ø£Ø­Ø³Ù†Øª ÙŠØ§ ${studentName}!`,
                    `Ù…Ù…ØªØ§Ø²Ø© ÙŠØ§ ${studentName}!`,
                    `Ø¹Ø¸ÙŠÙ…Ø© ÙŠØ§ ${studentName}!`
                ];
                feedbackText = praises[Math.floor(Math.random() * praises.length)];
            } else {
                const encouragements = studentGender === 'male' ? [
                    `Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙŠØ§ ${studentName}`,
                    `Ù„Ø§ Ø¨Ø£Ø³ ÙŠØ§ ${studentName}ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`,
                    `ØªØ³ØªØ·ÙŠØ¹ Ø£Ù† ØªÙØ¹Ù„ Ø°Ù„Ùƒ ÙŠØ§ ${studentName}`
                ] : [
                    `Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙŠØ§ ${studentName}`,
                    `Ù„Ø§ Ø¨Ø£Ø³ ÙŠØ§ ${studentName}ØŒ Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`,
                    `ØªØ³ØªØ·ÙŠØ¹ÙŠÙ† Ø£Ù† ØªÙØ¹Ù„ÙŠ Ø°Ù„Ùƒ ÙŠØ§ ${studentName}`
                ];
                feedbackText = encouragements[Math.floor(Math.random() * encouragements.length)];
            }
            
            // Speak the feedback
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(feedbackText);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.8;
                utterance.pitch = 1.2; // Slightly higher pitch for encouragement
                speechSynthesis.speak(utterance);
            }
            
            return feedbackText;
        }

        // Speech Recognition function (Demo)
        function startSpeechRecognition(expectedText, callback) {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'ar-SA';
                recognition.onresult = function(event) {
                    const spokenText = event.results[0][0].transcript;
                    const isCorrect = spokenText.includes(expectedText) || expectedText.includes(spokenText);
                    callback(isCorrect, spokenText);
                };
                recognition.start();
            } else {
                callback(true, expectedText); // Simulate success for demo
            }
        }

        function showMainMenu() {
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('topicMenu').classList.add('hidden');
            document.getElementById('skillContent').classList.add('hidden');
            document.getElementById('gameContent').classList.add('hidden');
        }

        function showTopicMenu(topic) {
            currentTopic = topic;
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('topicMenu').classList.remove('hidden');
            document.getElementById('skillContent').classList.add('hidden');
            document.getElementById('gameContent').classList.add('hidden');
            
            const titles = {
                introduction: 'Ø§Ù„ØªØ¹Ø§Ø±Ù - Perkenalan',
                family: 'Ø£Ø³Ø±ØªÙŠ - Keluargaku'
            };
            
            document.getElementById('topicTitle').textContent = titles[topic];
            loadGames(topic);
        }

        function showSkill(skill) {
            currentSkill = skill;
            document.getElementById('topicMenu').classList.add('hidden');
            document.getElementById('skillContent').classList.remove('hidden');
            
            const skillTitles = {
                listening: 'Ø§Ø³ØªÙ…Ø§Ø¹ - Menyimak',
                speaking: 'ØªØ­Ø¯Ø« - Mengucapkan',
                reading: 'Ù‚Ø±Ø§Ø¡Ø© - Membaca',
                writing: 'ÙƒØªØ§Ø¨Ø© - Menulis'
            };
            
            document.getElementById('skillTitle').textContent = skillTitles[skill];
            loadSkillActivity(currentTopic, skill);
        }

        function loadSkillActivity(topic, skill) {
            const container = document.getElementById('skillActivity');
            const vocab = vocabulary[topic];
            
            switch(skill) {
                case 'listening':
                    container.innerHTML = `
                        <h3 class="text-3xl font-bold mb-8 text-center arabic-text">Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø©</h3>
                        <div class="text-center mb-8">
                            <div id="listeningText" class="text-6xl arabic-text mb-6 p-8 bg-blue-50 rounded-2xl border-4 border-blue-200 text-blue-800"></div>
                            <button onclick="playRandomWord()" class="bg-blue-500 text-white px-10 py-5 rounded-full text-xl hover:bg-blue-600 transition-colors shadow-lg">
                                <i class="fas fa-volume-up mr-3"></i> Ø§Ø³ØªÙ…Ø¹
                            </button>
                        </div>
                        <div class="text-center">
                            <button onclick="nextListeningWord()" class="bg-emerald-500 text-white px-8 py-4 rounded-full text-lg hover:bg-emerald-600 transition-colors">
                                <i class="fas fa-arrow-right mr-2"></i> Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                            </button>
                        </div>
                        <div id="listeningResult" class="mt-6 text-center"></div>
                    `;
                    loadListeningWord();
                    break;
                    
                case 'speaking':
                    container.innerHTML = `
                        <h3 class="text-3xl font-bold mb-8 text-center arabic-text">Ù…Ø­Ø§Ø¯Ø«Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</h3>
                        <p class="text-lg text-center text-gray-600 mb-8">Sistem akan berbicara, lalu kamu menjawab dengan suara!</p>
                        
                        <!-- Interactive Conversation Display -->
                        <div class="bg-gradient-to-br from-blue-50 to-green-50 p-8 rounded-3xl border-3 border-blue-200 mb-8 shadow-xl">
                            <!-- System Speaker -->
                            <div class="flex items-center justify-center mb-8">
                                <div class="text-center">
                                    <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-3xl mb-3 shadow-lg" id="systemAvatar">
                                        ğŸ¤–
                                    </div>
                                    <p class="text-sm text-gray-600 font-semibold">Sistem</p>
                                </div>
                                
                                <div class="mx-8 text-4xl text-purple-600 pulse">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                                
                                <div class="text-center">
                                    <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white text-3xl mb-3 shadow-lg" id="studentAvatarSpeaking">
                                        ${studentAvatar}
                                    </div>
                                    <p class="text-sm text-gray-600 font-semibold">${studentName}</p>
                                </div>
                            </div>
                            
                            <!-- Visual Question Display -->
                            <div class="text-center mb-6" id="visualQuestionArea" style="display: none;">
                                <div class="bg-gradient-to-br from-yellow-100 to-orange-100 p-6 rounded-3xl border-3 border-yellow-300 shadow-lg">
                                    <div class="text-6xl mb-4 animate-bounce" id="questionEmoji">ğŸ‘¨â€ğŸ’¼</div>
                                    <div class="text-3xl arabic-text text-orange-800 mb-2" id="questionArabicLabel">Ø£Ø¨</div>
                                    <div class="text-lg text-orange-600 font-semibold" id="questionIndonesianLabel">Ayah</div>
                                    <div class="text-sm text-orange-500 mt-2">ğŸ‘† Yang ditanyakan sistem</div>
                                </div>
                            </div>
                            
                            <!-- Conversation Bubbles -->
                            <div class="space-y-4 mb-6">
                                <!-- System Message -->
                                <div class="flex items-start">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm mr-3">
                                        ğŸ¤–
                                    </div>
                                    <div class="bg-blue-100 p-4 rounded-2xl rounded-tl-none border-2 border-blue-300 max-w-md">
                                        <div class="text-2xl arabic-text text-blue-800 mb-2" id="systemMessage">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…</div>
                                        <div class="text-sm text-gray-600" id="systemTranslation">Assalamu'alaikum</div>
                                    </div>
                                </div>
                                
                                <!-- Student Response Area -->
                                <div class="flex items-start justify-end" id="studentResponseArea" style="display: none;">
                                    <div class="bg-green-100 p-4 rounded-2xl rounded-tr-none border-2 border-green-300 max-w-md mr-3">
                                        <div class="text-2xl arabic-text text-green-800 mb-2" id="studentResponse">ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…</div>
                                        <div class="text-sm text-gray-600" id="studentResponseTranslation">Wa'alaikumussalam</div>
                                    </div>
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm">
                                        ${studentAvatar}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Audio Controls -->
                            <div class="text-center">
                                <button onclick="playSystemMessage()" class="bg-blue-500 text-white px-6 py-3 rounded-full text-lg hover:bg-blue-600 transition-colors shadow-lg mr-4" id="playButton">
                                    <i class="fas fa-volume-up mr-2"></i> Dengar Sistem
                                </button>
                                <button onclick="startRecording()" class="bg-green-500 text-white px-6 py-3 rounded-full text-lg hover:bg-green-600 transition-colors shadow-lg" id="recordButton">
                                    <i class="fas fa-microphone mr-2"></i> Rekam Jawaban
                                </button>
                            </div>
                        </div>
                        
                        <!-- Recording Status -->
                        <div id="recordingStatus" class="text-center mb-6 hidden">
                            <div class="bg-red-100 p-4 rounded-xl border-2 border-red-300 inline-block">
                                <div class="flex items-center justify-center">
                                    <div class="w-4 h-4 bg-red-500 rounded-full animate-pulse mr-3"></div>
                                    <span class="text-red-700 font-semibold">ğŸ¤ Sedang Merekam... Ucapkan jawabanmu!</span>
                                </div>
                                <div class="mt-2">
                                    <button onclick="stopRecording()" class="bg-red-500 text-white px-4 py-2 rounded-full hover:bg-red-600 transition-colors text-sm">
                                        <i class="fas fa-stop mr-1"></i> Berhenti
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Result Display -->
                        <div id="speakingResult" class="text-center mb-6"></div>
                        
                        <!-- Progress and Controls -->
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-2 border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <div class="text-lg font-semibold text-gray-700">
                                    Percakapan: <span id="conversationProgress">1</span>/5
                                </div>
                                <div class="text-lg font-semibold text-green-600">
                                    <i class="fas fa-star mr-1"></i> Skor: <span id="speakingScore">0</span>
                                </div>
                            </div>
                            
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-4">
                                <div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500" id="progressBar" style="width: 20%"></div>
                            </div>
                            
                            <div class="flex justify-center space-x-4">
                                <button onclick="skipConversation()" class="bg-yellow-500 text-white px-6 py-2 rounded-full hover:bg-yellow-600 transition-colors">
                                    <i class="fas fa-forward mr-2"></i> Lewati
                                </button>
                                <button onclick="nextSpeakingConversation()" class="bg-purple-500 text-white px-6 py-2 rounded-full hover:bg-purple-600 transition-colors" id="nextButton" style="display: none;">
                                    <i class="fas fa-arrow-right mr-2"></i> Lanjut
                                </button>
                                <button onclick="resetSpeakingActivity()" class="bg-gray-500 text-white px-6 py-2 rounded-full hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-redo mr-2"></i> Ulang
                                </button>
                            </div>
                        </div>
                    `;
                    initInteractiveSpeaking();
                    break;
                    
                case 'reading':
                    container.innerHTML = `
                        <h3 class="text-3xl font-bold mb-8 text-center arabic-text">Ø§Ù‚Ø±Ø£ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h3>
                        <div id="readingWords" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    `;
                    loadReadingWords();
                    break;
                    
                case 'writing':
                    container.innerHTML = `
                        <h3 class="text-3xl font-bold mb-8 text-center arabic-text">Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©</h3>
                        <div class="text-center">
                            <div id="writingPrompt" class="text-3xl mb-6 p-6 bg-purple-50 rounded-2xl border-4 border-purple-200"></div>
                            <canvas id="writingCanvas" class="writing-canvas mx-auto mb-6" width="500" height="250"></canvas>
                            <div class="space-x-4">
                                <button onclick="clearCanvas()" class="bg-red-500 text-white px-8 py-4 rounded-full hover:bg-red-600 transition-colors text-lg shadow-lg">
                                    <i class="fas fa-eraser mr-2"></i> Hapus
                                </button>
                                <button onclick="checkWriting()" class="bg-blue-500 text-white px-8 py-4 rounded-full hover:bg-blue-600 transition-colors text-lg shadow-lg">
                                    <i class="fas fa-check mr-2"></i> Periksa
                                </button>
                            </div>
                        </div>
                    `;
                    setupWritingCanvas();
                    break;
            }
        }

        function loadGames(topic) {
            const container = document.getElementById('gamesContainer');
            const games = {
                introduction: [
                    { id: 'memoryGame', title: 'Ø°Ø§ÙƒØ±Ø©', desc: 'Game Memori Teks & Arti', icon: 'fas fa-brain', color: 'from-emerald-400 to-teal-500' },
                    { id: 'matchingGame', title: 'Ù…Ø·Ø§Ø¨Ù‚Ø©', desc: 'Matching Teks & Arti', icon: 'fas fa-link', color: 'from-blue-400 to-indigo-500' },
                    { id: 'voiceGuessGame', title: 'ØªØ®Ù…ÙŠÙ† Ø§Ù„ØµÙˆØª', desc: 'Tebak Jawaban Percakapan', icon: 'fas fa-volume-up', color: 'from-purple-400 to-pink-500' }
                ],
                family: [
                    { id: 'memoryGame', title: 'Ø°Ø§ÙƒØ±Ø©', desc: 'Game Memori Teks & Arti', icon: 'fas fa-brain', color: 'from-orange-400 to-red-500' },
                    { id: 'matchingGame', title: 'Ù…Ø·Ø§Ø¨Ù‚Ø©', desc: 'Matching Teks & Arti', icon: 'fas fa-link', color: 'from-green-400 to-emerald-500' },
                    { id: 'voiceGuessGame', title: 'ØªØ®Ù…ÙŠÙ† Ø§Ù„ØµÙˆØª', desc: 'Tebak Jawaban Percakapan', icon: 'fas fa-volume-up', color: 'from-yellow-400 to-orange-500' }
                ]
            };
            
            container.innerHTML = games[topic].map(game => `
                <div class="bg-gradient-to-br ${game.color} rounded-2xl p-8 shadow-xl game-card cursor-pointer text-white border-2 border-white border-opacity-30" onclick="showGame('${game.id}')">
                    <div class="text-5xl mb-4">
                        <i class="${game.icon}"></i>
                    </div>
                    <h4 class="text-2xl font-bold mb-3 arabic-text">${game.title}</h4>
                    <p class="text-lg opacity-90">${game.desc}</p>
                </div>
            `).join('');
        }

        function showGame(gameId) {
            document.getElementById('topicMenu').classList.add('hidden');
            document.getElementById('gameContent').classList.remove('hidden');
            loadGame(gameId);
        }

        function loadGame(gameId) {
            const container = document.getElementById('gameActivity');
            const gameTitle = document.getElementById('gameTitle');
            
            switch(gameId) {
                case 'memoryGame':
                    gameTitle.textContent = 'Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© - Game Memori';
                    container.innerHTML = `
                        <div class="text-center">
                            <h3 class="text-3xl mb-8 arabic-text">Ø§Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©</h3>
                            <p class="text-lg mb-6 text-gray-600">Temukan pasangan teks Arab dan artinya!</p>
                            <div class="mb-6">
                                <span class="bg-blue-100 px-4 py-2 rounded-full text-blue-800 font-semibold">
                                    Skor: <span id="memoryScore">0</span>
                                </span>
                                <span class="bg-green-100 px-4 py-2 rounded-full text-green-800 font-semibold ml-4">
                                    Pasangan: <span id="memoryPairs">0</span>/4
                                </span>
                            </div>
                            <div id="memoryGrid" class="grid grid-cols-4 gap-4 max-w-2xl mx-auto"></div>
                            <button onclick="resetMemoryGame()" class="mt-6 bg-purple-500 text-white px-8 py-3 rounded-full hover:bg-purple-600 transition-colors">
                                <i class="fas fa-redo mr-2"></i> Main Lagi
                            </button>
                        </div>
                    `;
                    initMemoryGame();
                    break;
                    
                case 'matchingGame':
                    gameTitle.textContent = 'Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© - Matching Game';
                    container.innerHTML = `
                        <div class="text-center">
                            <h3 class="text-3xl mb-4 arabic-text">Ø§Ø±Ø¨Ø· Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ù…Ø¹Ù†Ø§Ù‡Ø§</h3>
                            <p class="text-lg mb-6 text-gray-600">ğŸ¯ Klik kata Arab, lalu klik artinya untuk mencocokkan!</p>
                            
                            <!-- Game Stats -->
                            <div class="mb-6 flex justify-center space-x-4">
                                <span class="bg-blue-100 px-4 py-2 rounded-full text-blue-800 font-semibold">
                                    <i class="fas fa-bullseye mr-1"></i> Benar: <span id="matchingScore">0</span>/4
                                </span>
                                <span class="bg-yellow-100 px-4 py-2 rounded-full text-yellow-800 font-semibold">
                                    <i class="fas fa-clock mr-1"></i> Waktu: <span id="matchingTimer">60</span>s
                                </span>
                                <span class="bg-purple-100 px-4 py-2 rounded-full text-purple-800 font-semibold">
                                    <i class="fas fa-star mr-1"></i> Bonus: <span id="matchingBonus">0</span>
                                </span>
                            </div>
                            
                            <!-- Instructions -->
                            <div class="bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-xl mb-6 border-2 border-blue-200">
                                <div class="flex items-center justify-center space-x-4 text-lg">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 bg-blue-500 rounded mr-2"></div>
                                        <span class="text-blue-700">1. Klik kata Arab</span>
                                    </div>
                                    <div class="text-2xl">â¡ï¸</div>
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 bg-green-500 rounded mr-2"></div>
                                        <span class="text-green-700">2. Klik artinya</span>
                                    </div>
                                    <div class="text-2xl">âœ¨</div>
                                    <span class="text-purple-700 font-bold">Cocok!</span>
                                </div>
                            </div>
                            
                            <!-- Game Board -->
                            <div class="grid grid-cols-2 gap-8 max-w-4xl mx-auto">
                                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl border-3 border-blue-300 shadow-lg">
                                    <h4 class="text-2xl font-bold mb-4 text-blue-800 flex items-center justify-center">
                                        <i class="fas fa-language mr-2"></i> ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ©
                                    </h4>
                                    <div id="arabicWords" class="space-y-3"></div>
                                </div>
                                <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl border-3 border-green-300 shadow-lg">
                                    <h4 class="text-2xl font-bold mb-4 text-green-800 flex items-center justify-center">
                                        <i class="fas fa-flag mr-2"></i> Arti Indonesia
                                    </h4>
                                    <div id="indonesianWords" class="space-y-3"></div>
                                </div>
                            </div>
                            
                            <!-- Game Controls -->
                            <div class="mt-8 space-x-4">
                                <button onclick="resetMatchingGame()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-full hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-redo mr-2"></i> Main Lagi
                                </button>
                                <button onclick="showMatchingHint()" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-8 py-3 rounded-full hover:from-yellow-600 hover:to-orange-600 transition-all transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-lightbulb mr-2"></i> Bantuan
                                </button>
                            </div>
                            
                            <div id="matchingResult" class="mt-6"></div>
                        </div>
                    `;
                    initMatchingGame();
                    break;
                    
                case 'voiceGuessGame':
                    gameTitle.textContent = 'ØªØ®Ù…ÙŠÙ† Ø§Ù„ØµÙˆØª - Tebak Jawaban Percakapan';
                    container.innerHTML = `
                        <div class="text-center">
                            <h3 class="text-3xl mb-8 arabic-text">Ø§Ø³ØªÙ…Ø¹ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­</h3>
                            <p class="text-lg mb-6 text-gray-600">Dengarkan percakapan dan pilih jawaban yang tepat!</p>
                            
                            <!-- Conversation Display -->
                            <div class="bg-gradient-to-r from-blue-50 to-green-50 p-8 rounded-2xl mb-8 border-2 border-blue-200">
                                <!-- Visual Question Display for Family Topic -->
                                <div class="text-center mb-6" id="voiceVisualArea" style="display: none;">
                                    <div class="bg-gradient-to-br from-yellow-100 to-orange-100 p-6 rounded-3xl border-3 border-yellow-300 shadow-lg">
                                        <div class="text-6xl mb-4 animate-bounce" id="voiceQuestionEmoji">ğŸ‘¨â€ğŸ’¼</div>
                                        <div class="text-3xl arabic-text text-orange-800 mb-2" id="voiceQuestionArabicLabel">Ø£Ø¨</div>
                                        <div class="text-lg text-orange-600 font-semibold" id="voiceQuestionIndonesianLabel">Ayah</div>
                                        <div class="text-sm text-orange-500 mt-2">ğŸ‘† Yang ditanyakan</div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-center items-center space-x-8 mb-6">
                                    <div class="text-center">
                                        <div class="text-5xl mb-2 text-blue-600">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <p class="text-sm text-gray-600">Ø£Ø­Ù…Ø¯</p>
                                    </div>
                                    <div class="text-3xl text-purple-600">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-5xl mb-2 text-pink-600">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <p class="text-sm text-gray-600">ÙØ§Ø·Ù…Ø©</p>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-6 rounded-xl border-2 border-gray-200 mb-4">
                                    <div class="text-2xl arabic-text text-blue-800" id="conversationQuestion"></div>
                                </div>
                                
                                <button onclick="playConversation()" class="bg-blue-500 text-white px-8 py-4 rounded-full text-lg hover:bg-blue-600 transition-colors shadow-lg">
                                    <i class="fas fa-volume-up mr-3"></i> Dengarkan Percakapan
                                </button>
                            </div>
                            
                            <!-- Answer Options -->
                            <div class="mb-6">
                                <h4 class="text-xl font-bold mb-4 text-gray-700">Pilih jawaban yang tepat:</h4>
                                <div id="voiceAnswerOptions" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto"></div>
                            </div>
                            
                            <div id="voiceResult" class="mt-6"></div>
                            
                            <div class="mt-6 space-x-4">
                                <button onclick="nextConversation()" class="bg-green-500 text-white px-8 py-3 rounded-full hover:bg-green-600 transition-colors">
                                    <i class="fas fa-arrow-right mr-2"></i> Percakapan Berikutnya
                                </button>
                                <button onclick="resetVoiceGuessGame()" class="bg-purple-500 text-white px-8 py-3 rounded-full hover:bg-purple-600 transition-colors">
                                    <i class="fas fa-shuffle mr-2"></i> Soal Baru
                                </button>
                            </div>
                        </div>
                    `;
                    initVoiceGuessGame();
                    break;
            }
        }

        // Game functions
        let currentNameAnswer = '';
        let currentFamilyAnswer = '';
        
        // Memory Game Variables
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let memoryScore = 0;
        
        // Matching Game Variables
        let matchingPairs = {};
        let matchingScore = 0;
        
        // Voice Guess Game Variables
        let currentConversation = 0;
        let voiceConversations = [];

        function playNameAudio() {
            const names = ['Ø£Ø­Ù…Ø¯', 'ÙØ§Ø·Ù…Ø©', 'Ù…Ø­Ù…Ø¯', 'Ø¹Ø§Ø¦Ø´Ø©'];
            currentNameAnswer = names[Math.floor(Math.random() * names.length)];
            speakArabic(currentNameAnswer);
        }

        function checkNameAnswer(answer) {
            const result = document.getElementById('nameResult');
            if (answer === currentNameAnswer) {
                const feedbackText = speakPersonalizedFeedback(true, 10);
                result.innerHTML = `<div class="text-green-600 text-xl">âœ… ${feedbackText}</div>`;
                addPoints(10);
                showSuccessModal(10);
            } else {
                const feedbackText = speakPersonalizedFeedback(false);
                result.innerHTML = `<div class="text-red-600 text-xl">âŒ ${feedbackText}</div>`;
            }
        }

        function playFamilyAudio() {
            const family = ['Ø£Ø¨ÙŠ', 'Ø£Ù…ÙŠ', 'Ø£Ø®ÙŠ', 'Ø£Ø®ØªÙŠ'];
            currentFamilyAnswer = family[Math.floor(Math.random() * family.length)];
            speakArabic(currentFamilyAnswer);
        }

        function checkFamilyAnswer(answer) {
            const result = document.getElementById('familyResult');
            if (answer === currentFamilyAnswer) {
                result.innerHTML = '<div class="text-green-600 text-xl">âœ… Ù…Ù…ØªØ§Ø²! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</div>';
                addPoints(10);
                showSuccessModal();
            } else {
                result.innerHTML = '<div class="text-red-600 text-xl">âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>';
            }
        }

        // Skill activity functions
        let currentListeningWord = '';
        let currentListeningIndex = 0;

        function loadListeningWord() {
            const vocab = vocabulary[currentTopic];
            currentListeningIndex = 0;
            currentListeningWord = vocab.arabic[currentListeningIndex];
            document.getElementById('listeningText').textContent = currentListeningWord;
        }

        function playRandomWord() {
            speakArabic(currentListeningWord);
            const result = document.getElementById('listeningResult');
            result.innerHTML = '<div class="text-blue-600 text-xl"><i class="fas fa-volume-up mr-2"></i>Mendengarkan audio...</div>';
            
            setTimeout(() => {
                result.innerHTML = '';
            }, 2000);
        }

        function nextListeningWord() {
            const vocab = vocabulary[currentTopic];
            currentListeningIndex = (currentListeningIndex + 1) % vocab.arabic.length;
            currentListeningWord = vocab.arabic[currentListeningIndex];
            document.getElementById('listeningText').textContent = currentListeningWord;
            addPoints(5);
        }

        function startConversationAnimation() {
            const conversations = {
                introduction: [
                    { person1: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…', person2: 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…' },
                    { person1: 'Ø§Ø³Ù…ÙŠ Ø£Ø­Ù…Ø¯', person2: 'Ø§Ø³Ù…ÙŠ ÙØ§Ø·Ù…Ø©' },
                    { person1: 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', person2: 'ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±' }
                ],
                family: [
                    { person1: 'Ù‡Ø°Ø§ Ø£Ø¨ÙŠ', person2: 'Ù‡Ø°Ù‡ Ø£Ù…ÙŠ' },
                    { person1: 'Ø£Ø®ÙŠ Ø·Ø§Ù„Ø¨', person2: 'Ø£Ø®ØªÙŠ Ø·Ø§Ù„Ø¨Ø©' },
                    { person1: 'Ø¬Ø¯ÙŠ ÙƒØ¨ÙŠØ±', person2: 'Ø¬Ø¯ØªÙŠ ÙƒØ¨ÙŠØ±Ø©' }
                ]
            };
            
            const topicConversations = conversations[currentTopic] || conversations.introduction;
            let currentConv = 0;
            
            setInterval(() => {
                const conv = topicConversations[currentConv];
                document.getElementById('person1Text').textContent = conv.person1;
                document.getElementById('person2Text').textContent = conv.person2;
                currentConv = (currentConv + 1) % topicConversations.length;
            }, 4000);
        }

        function checkListeningAnswer(answer) {
            const result = document.getElementById('listeningResult');
            const buttons = document.querySelectorAll('#listeningOptions button');
            
            buttons.forEach(btn => {
                if (btn.textContent.trim() === answer) {
                    if (answer === currentListeningWord) {
                        btn.classList.add('correct-answer');
                        result.innerHTML = '<div class="text-green-600 text-xl">âœ… Ù…Ù…ØªØ§Ø²! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</div>';
                        addPoints(10);
                    } else {
                        btn.classList.add('wrong-answer');
                        result.innerHTML = '<div class="text-red-600 text-xl">âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>';
                    }
                }
            });
        }

        // Interactive Speaking Variables
        let currentSpeakingConversation = 0;
        let speakingScore = 0;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let speakingConversations = [];

        function initInteractiveSpeaking() {
            speakingConversations = {
                introduction: [
                    {
                        system: { arabic: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…', translation: 'Assalamu\'alaikum', phonetic: 'Assalamu alaikum' },
                        expected: { arabic: 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…', translation: 'Wa\'alaikumussalam', phonetic: 'Wa alaikumussalam' }
                    },
                    {
                        system: { arabic: 'Ù…Ø§ Ø§Ø³Ù…ÙƒØŸ', translation: 'Siapa namamu?', phonetic: 'Ma ismuka?' },
                        expected: { arabic: 'Ø§Ø³Ù…ÙŠ Ø£Ø­Ù…Ø¯', translation: 'Namaku Ahmad', phonetic: 'Ismi Ahmad' }
                    },
                    {
                        system: { arabic: 'ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ', translation: 'Apa kabarmu?', phonetic: 'Kaifa haluka?' },
                        expected: { arabic: 'Ø¨Ø®ÙŠØ± Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡', translation: 'Baik alhamdulillah', phonetic: 'Bikhair alhamdulillah' }
                    },
                    {
                        system: { arabic: 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', translation: 'Selamat pagi', phonetic: 'Sabah al-khair' },
                        expected: { arabic: 'ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±', translation: 'Selamat pagi (balasan)', phonetic: 'Sabah an-nur' }
                    },
                    {
                        system: { arabic: 'Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©', translation: 'Selamat jalan', phonetic: 'Ma\'a as-salamah' },
                        expected: { arabic: 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…', translation: 'Wa\'alaikumussalam', phonetic: 'Wa alaikumussalam' }
                    }
                ],
                family: [
                    {
                        system: { arabic: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ', translation: 'Siapa ini?', phonetic: 'Man hadha?' },
                        expected: { arabic: 'Ù‡Ø°Ø§ Ø£Ø¨ÙŠ', translation: 'Ini ayahku', phonetic: 'Hadha abi' },
                        visual: { emoji: 'ğŸ‘¨â€ğŸ’¼', arabicLabel: 'Ø£Ø¨', indonesianLabel: 'Ayah' }
                    },
                    {
                        system: { arabic: 'Ù…ÙÙ† Ù‡ÙØ°ÙÙ‡ÙØŸ', translation: 'Siapa ini?', phonetic: 'Man hadhihi?' },
                        expected: { arabic: 'Ù‡Ø°Ù‡ Ø£Ù…ÙŠ', translation: 'Ini ibuku', phonetic: 'Hadhihi ummi' },
                        visual: { emoji: 'ğŸ‘©â€ğŸ³', arabicLabel: 'Ø£Ù…', indonesianLabel: 'Ibu' }
                    },
                    {
                        system: { arabic: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ', translation: 'Siapa ini?', phonetic: 'Man hadha?' },
                        expected: { arabic: 'Ù‡Ø°Ø§ Ø£Ø®ÙŠ', translation: 'Ini saudaraku', phonetic: 'Hadha akhi' },
                        visual: { emoji: 'ğŸ‘¦', arabicLabel: 'Ø£Ø®', indonesianLabel: 'Saudara Laki-laki' }
                    },
                    {
                        system: { arabic: 'Ù…ÙÙ† Ù‡ÙØ°ÙÙ‡ÙØŸ', translation: 'Siapa ini?', phonetic: 'Man hadhihi?' },
                        expected: { arabic: 'Ù‡Ø°Ù‡ Ø£Ø®ØªÙŠ', translation: 'Ini saudariku', phonetic: 'Hadhihi ukhti' },
                        visual: { emoji: 'ğŸ‘§', arabicLabel: 'Ø£Ø®Øª', indonesianLabel: 'Saudara Perempuan' }
                    },
                    {
                        system: { arabic: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ', translation: 'Siapa ini?', phonetic: 'Man hadha?' },
                        expected: { arabic: 'Ù‡Ø°Ø§ Ø¬Ø¯ÙŠ', translation: 'Ini kakekku', phonetic: 'Hadha jaddi' },
                        visual: { emoji: 'ğŸ‘´', arabicLabel: 'Ø¬Ø¯', indonesianLabel: 'Kakek' }
                    }
                ]
            };
            
            currentSpeakingConversation = 0;
            speakingScore = 0;
            loadCurrentConversation();
            updateSpeakingProgress();
        }

        function loadCurrentConversation() {
            const conversations = speakingConversations[currentTopic];
            if (!conversations || currentSpeakingConversation >= conversations.length) {
                // Completed all conversations
                showSpeakingCompletion();
                return;
            }
            
            const conv = conversations[currentSpeakingConversation];
            
            // Update system message
            document.getElementById('systemMessage').textContent = conv.system.arabic;
            document.getElementById('systemTranslation').textContent = conv.system.translation;
            
            // Update expected response (hidden initially)
            document.getElementById('studentResponse').textContent = conv.expected.arabic;
            document.getElementById('studentResponseTranslation').textContent = conv.expected.translation;
            
            // Show visual question for family topic
            if (currentTopic === 'family' && conv.visual) {
                document.getElementById('visualQuestionArea').style.display = 'block';
                document.getElementById('questionEmoji').textContent = conv.visual.emoji;
                document.getElementById('questionArabicLabel').textContent = conv.visual.arabicLabel;
                document.getElementById('questionIndonesianLabel').textContent = conv.visual.indonesianLabel;
            } else {
                document.getElementById('visualQuestionArea').style.display = 'none';
            }
            
            // Hide student response initially
            document.getElementById('studentResponseArea').style.display = 'none';
            document.getElementById('nextButton').style.display = 'none';
            
            // Clear previous results
            document.getElementById('speakingResult').innerHTML = '';
            
            // Auto-play system message
            setTimeout(() => {
                playSystemMessage();
            }, 1000);
        }

        function playSystemMessage() {
            const conversations = speakingConversations[currentTopic];
            const conv = conversations[currentSpeakingConversation];
            
            // Visual feedback
            const systemAvatar = document.getElementById('systemAvatar');
            systemAvatar.classList.add('animate-pulse', 'ring-4', 'ring-blue-400');
            
            // Play audio
            speakArabic(conv.system.arabic);
            
            // Remove visual feedback after 3 seconds
            setTimeout(() => {
                systemAvatar.classList.remove('animate-pulse', 'ring-4', 'ring-blue-400');
            }, 3000);
        }

        async function startRecording() {
            if (isRecording) return;
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    processRecording();
                };
                
                mediaRecorder.start();
                isRecording = true;
                
                // Update UI
                document.getElementById('recordingStatus').classList.remove('hidden');
                document.getElementById('recordButton').innerHTML = '<i class="fas fa-stop mr-2"></i> Berhenti Rekam';
                document.getElementById('recordButton').classList.add('bg-red-500', 'hover:bg-red-600');
                document.getElementById('recordButton').classList.remove('bg-green-500', 'hover:bg-green-600');
                
                // Visual feedback on student avatar
                const studentAvatar = document.getElementById('studentAvatarSpeaking');
                studentAvatar.classList.add('animate-pulse', 'ring-4', 'ring-green-400');
                
            } catch (error) {
                console.error('Error accessing microphone:', error);
                // Fallback to speech recognition
                startSpeechRecognitionFallback();
            }
        }

        function stopRecording() {
            if (!isRecording) return;
            
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(track => track.stop());
            isRecording = false;
            
            // Update UI
            document.getElementById('recordingStatus').classList.add('hidden');
            document.getElementById('recordButton').innerHTML = '<i class="fas fa-microphone mr-2"></i> Rekam Jawaban';
            document.getElementById('recordButton').classList.remove('bg-red-500', 'hover:bg-red-600');
            document.getElementById('recordButton').classList.add('bg-green-500', 'hover:bg-green-600');
            
            // Remove visual feedback
            const studentAvatar = document.getElementById('studentAvatarSpeaking');
            studentAvatar.classList.remove('animate-pulse', 'ring-4', 'ring-green-400');
        }

        function processRecording() {
            // In a real implementation, this would process the audio
            // For demo purposes, we'll simulate speech recognition
            const conversations = speakingConversations[currentTopic];
            const conv = conversations[currentSpeakingConversation];
            
            // Simulate processing delay
            document.getElementById('speakingResult').innerHTML = `
                <div class="bg-blue-100 p-4 rounded-xl border-2 border-blue-300 inline-block">
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                        <span class="text-blue-700 font-semibold">Memproses rekaman...</span>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                // Simulate random success (80% chance for demo)
                const isCorrect = Math.random() > 0.2;
                showRecordingResult(isCorrect, conv);
            }, 2000);
        }

        function startSpeechRecognitionFallback() {
            const conversations = speakingConversations[currentTopic];
            const conv = conversations[currentSpeakingConversation];
            
            document.getElementById('speakingResult').innerHTML = `
                <div class="bg-blue-100 p-4 rounded-xl border-2 border-blue-300 inline-block">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-blue-500 rounded-full animate-pulse mr-3"></div>
                        <span class="text-blue-700 font-semibold">ğŸ¤ Mendengarkan... Ucapkan jawabanmu!</span>
                    </div>
                </div>
            `;
            
            // Use Web Speech API as fallback
            startSpeechRecognition(conv.expected.arabic, (isCorrect, spokenText) => {
                showRecordingResult(isCorrect, conv, spokenText);
            });
        }

        function showRecordingResult(isCorrect, conv, spokenText = '') {
            const result = document.getElementById('speakingResult');
            
            if (isCorrect) {
                const points = 25;
                const feedbackText = speakPersonalizedFeedback(true, points);
                speakingScore += points;
                addPoints(points);
                
                // Show student response bubble
                document.getElementById('studentResponseArea').style.display = 'flex';
                
                result.innerHTML = `
                    <div class="bg-gradient-to-r from-green-400 to-emerald-500 text-white p-6 rounded-2xl shadow-lg">
                        <div class="text-3xl mb-2">ğŸ‰</div>
                        <div class="text-2xl font-bold mb-2 arabic-text">${feedbackText}</div>
                        <div class="text-lg">Pengucapan sempurna! +${points} poin</div>
                        ${spokenText ? `<div class="text-sm mt-2 opacity-90">Terdeteksi: "${spokenText}"</div>` : ''}
                    </div>
                `;
                
                // Show next button
                document.getElementById('nextButton').style.display = 'inline-block';
                
                // Play the correct response
                setTimeout(() => {
                    speakArabic(conv.expected.arabic);
                }, 1000);
                
            } else {
                const feedbackText = speakPersonalizedFeedback(false);
                
                result.innerHTML = `
                    <div class="bg-gradient-to-r from-orange-400 to-red-400 text-white p-6 rounded-2xl shadow-lg">
                        <div class="text-3xl mb-2">ğŸ”„</div>
                        <div class="text-xl font-bold mb-2 arabic-text">${feedbackText}</div>
                        <div class="text-lg mb-3">Coba lagi! Jawaban yang benar:</div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-xl">
                            <div class="text-2xl arabic-text mb-1">${conv.expected.arabic}</div>
                            <div class="text-sm opacity-90">${conv.expected.translation}</div>
                        </div>
                        ${spokenText ? `<div class="text-sm mt-2 opacity-75">Terdeteksi: "${spokenText}"</div>` : ''}
                    </div>
                `;
                
                // Play the correct response
                setTimeout(() => {
                    speakArabic(conv.expected.arabic);
                }, 1500);
            }
            
            updateSpeakingProgress();
        }

        function nextSpeakingConversation() {
            currentSpeakingConversation++;
            loadCurrentConversation();
            updateSpeakingProgress();
        }

        function skipConversation() {
            // Show the correct answer and move to next
            const conversations = speakingConversations[currentTopic];
            const conv = conversations[currentSpeakingConversation];
            
            document.getElementById('studentResponseArea').style.display = 'flex';
            document.getElementById('speakingResult').innerHTML = `
                <div class="bg-yellow-100 p-4 rounded-xl border-2 border-yellow-300">
                    <div class="text-lg font-bold text-yellow-800 mb-2">â­ï¸ Dilewati</div>
                    <div class="text-yellow-700">Jawaban yang benar: <span class="arabic-text font-bold">${conv.expected.arabic}</span></div>
                    <div class="text-sm text-yellow-600">${conv.expected.translation}</div>
                </div>
            `;
            
            speakArabic(conv.expected.arabic);
            document.getElementById('nextButton').style.display = 'inline-block';
        }

        function resetSpeakingActivity() {
            currentSpeakingConversation = 0;
            speakingScore = 0;
            loadCurrentConversation();
            updateSpeakingProgress();
        }

        function updateSpeakingProgress() {
            const totalConversations = speakingConversations[currentTopic].length;
            const progress = ((currentSpeakingConversation + 1) / totalConversations) * 100;
            
            document.getElementById('conversationProgress').textContent = currentSpeakingConversation + 1;
            document.getElementById('speakingScore').textContent = speakingScore;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function showSpeakingCompletion() {
            const congratsText = studentGender === 'male' ? `Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ ${studentName}!` : `Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ ${studentName}!`;
            
            document.getElementById('speakingResult').innerHTML = `
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-8 rounded-3xl shadow-2xl text-center">
                    <div class="text-6xl mb-4">ğŸ†</div>
                    <div class="text-3xl font-bold mb-4 arabic-text">${congratsText}</div>
                    <div class="text-xl mb-4">Kamu telah menyelesaikan semua percakapan!</div>
                    <div class="text-lg mb-6">Total Skor: <span class="font-bold">${speakingScore}</span> poin</div>
                    <button onclick="resetSpeakingActivity()" class="bg-white text-purple-600 px-8 py-3 rounded-full font-bold hover:bg-gray-100 transition-colors">
                        <i class="fas fa-redo mr-2"></i> Ulangi Latihan
                    </button>
                </div>
            `;
            
            // Bonus points for completion
            addPoints(50);
            showSuccessModal(50);
        }

        function loadReadingWords() {
            const vocab = vocabulary[currentTopic];
            const container = document.getElementById('readingWords');
            
            container.innerHTML = vocab.arabic.map((word, index) => `
                <div class="bg-gray-100 p-6 rounded-xl text-center">
                    <div class="text-3xl arabic-text mb-3 cursor-pointer hover:text-blue-600 transition-colors" onclick="speakArabic('${word}')">
                        ${word} ğŸ”Š
                    </div>
                    <div class="text-gray-600 mb-2">${vocab.indonesian[index]}</div>
                    <div class="text-sm text-gray-500">[${vocab.phonetic[index]}]</div>
                </div>
            `).join('');
        }

        // Writing canvas setup
        function setupWritingCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // Set up canvas for drawing
            ctx.strokeStyle = '#4f46e5';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                 e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
            
            // Load writing prompt
            const vocab = vocabulary[currentTopic];
            const randomWord = vocab.arabic[Math.floor(Math.random() * vocab.arabic.length)];
            document.getElementById('writingPrompt').innerHTML = `Ø§ÙƒØªØ¨: <span class="arabic-text text-blue-600">${randomWord}</span>`;
            window.currentWritingWord = randomWord;
        }

        function clearCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function checkWriting() {
            // In a real implementation, this would use AI to check the writing
            // For demo, we'll just give positive feedback
            speakPersonalizedFeedback(true, 20);
            addPoints(20);
            showSuccessModal(20);
        }

        // Memory Game Functions
        function initMemoryGame() {
            const vocab = vocabulary[currentTopic];
            memoryCards = [];
            flippedCards = [];
            matchedPairs = 0;
            memoryScore = 0;
            
            // Create pairs (Arabic word + Indonesian meaning)
            for (let i = 0; i < 4; i++) {
                memoryCards.push({
                    id: i * 2,
                    text: vocab.arabic[i],
                    type: 'arabic',
                    pairId: i,
                    matched: false
                });
                memoryCards.push({
                    id: i * 2 + 1,
                    text: vocab.indonesian[i],
                    type: 'indonesian',
                    pairId: i,
                    matched: false
                });
            }
            
            // Shuffle cards
            memoryCards.sort(() => Math.random() - 0.5);
            
            renderMemoryGrid();
            updateMemoryScore();
        }
        
        function renderMemoryGrid() {
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = memoryCards.map(card => `
                <div class="memory-card bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl p-2 cursor-pointer transition-all duration-300 hover:scale-105 shadow-lg" 
                     onclick="flipCard(${card.id})" 
                     id="card-${card.id}">
                    <div class="card-front h-20 flex items-center justify-center">
                        <i class="fas fa-question text-white text-3xl"></i>
                    </div>
                    <div class="card-back h-20 flex items-center justify-center text-center hidden px-1">
                        <span class="text-white font-bold ${card.type === 'arabic' ? 'arabic-text text-sm' : 'text-xs'} leading-tight break-words">${card.text}</span>
                    </div>
                </div>
            `).join('');
        }
        
        function flipCard(cardId) {
            const card = memoryCards.find(c => c.id === cardId);
            if (card.matched || flippedCards.includes(cardId) || flippedCards.length >= 2) return;
            
            const cardElement = document.getElementById(`card-${cardId}`);
            const front = cardElement.querySelector('.card-front');
            const back = cardElement.querySelector('.card-back');
            
            front.classList.add('hidden');
            back.classList.remove('hidden');
            cardElement.classList.add('bg-gradient-to-br', 'from-blue-400', 'to-blue-600');
            cardElement.classList.remove('from-purple-400', 'to-purple-600');
            
            flippedCards.push(cardId);
            
            if (flippedCards.length === 2) {
                setTimeout(checkMemoryMatch, 1000);
            }
        }
        
        function checkMemoryMatch() {
            const [card1Id, card2Id] = flippedCards;
            const card1 = memoryCards.find(c => c.id === card1Id);
            const card2 = memoryCards.find(c => c.id === card2Id);
            
            if (card1.pairId === card2.pairId) {
                // Match found
                card1.matched = true;
                card2.matched = true;
                matchedPairs++;
                memoryScore += 20;
                
                const card1Element = document.getElementById(`card-${card1Id}`);
                const card2Element = document.getElementById(`card-${card2Id}`);
                
                card1Element.classList.add('bg-gradient-to-br', 'from-green-400', 'to-green-600');
                card1Element.classList.remove('from-blue-400', 'to-blue-600');
                card2Element.classList.add('bg-gradient-to-br', 'from-green-400', 'to-green-600');
                card2Element.classList.remove('from-blue-400', 'to-blue-600');
                
                if (matchedPairs === 4) {
                    setTimeout(() => {
                        speakPersonalizedFeedback(true, 50);
                        addPoints(50);
                        showSuccessModal(50);
                    }, 500);
                }
            } else {
                // No match
                setTimeout(() => {
                    const card1Element = document.getElementById(`card-${card1Id}`);
                    const card2Element = document.getElementById(`card-${card2Id}`);
                    
                    card1Element.querySelector('.card-front').classList.remove('hidden');
                    card1Element.querySelector('.card-back').classList.add('hidden');
                    card2Element.querySelector('.card-front').classList.remove('hidden');
                    card2Element.querySelector('.card-back').classList.add('hidden');
                    
                    card1Element.classList.add('from-purple-400', 'to-purple-600');
                    card1Element.classList.remove('from-blue-400', 'to-blue-600');
                    card2Element.classList.add('from-purple-400', 'to-purple-600');
                    card2Element.classList.remove('from-blue-400', 'to-blue-600');
                }, 500);
            }
            
            flippedCards = [];
            updateMemoryScore();
        }
        
        function updateMemoryScore() {
            document.getElementById('memoryScore').textContent = memoryScore;
            document.getElementById('memoryPairs').textContent = matchedPairs;
        }
        
        function resetMemoryGame() {
            initMemoryGame();
        }
        
        // Matching Game Functions
        let matchingTimer = 60;
        let matchingTimerInterval = null;
        let matchingBonus = 0;
        let selectedArabicWord = null;
        let selectedIndonesianWord = null;
        let matchedWords = [];
        
        function initMatchingGame() {
            const vocab = vocabulary[currentTopic];
            matchingScore = 0;
            matchingTimer = 60;
            matchingBonus = 0;
            selectedArabicWord = null;
            selectedIndonesianWord = null;
            matchedWords = [];
            
            const arabicContainer = document.getElementById('arabicWords');
            const indonesianContainer = document.getElementById('indonesianWords');
            
            // Use only 4 words for easier gameplay
            const gameWords = vocab.arabic.slice(0, 4);
            const gameIndonesian = vocab.indonesian.slice(0, 4);
            
            // Shuffle Indonesian words
            const shuffledIndonesian = [...gameIndonesian].sort(() => Math.random() - 0.5);
            
            arabicContainer.innerHTML = gameWords.map((word, index) => `
                <div class="matching-word arabic-word bg-white p-4 rounded-xl border-3 border-blue-300 cursor-pointer hover:bg-blue-100 transition-all transform hover:scale-105 arabic-text text-2xl font-bold shadow-lg" 
                     data-word="${word}" data-index="${index}" onclick="selectArabicWord(this)">
                    <div class="flex items-center justify-center">
                        <i class="fas fa-language text-blue-500 mr-2"></i>
                        ${word}
                    </div>
                </div>
            `).join('');
            
            indonesianContainer.innerHTML = shuffledIndonesian.map((word, index) => `
                <div class="matching-word indonesian-word bg-white p-4 rounded-xl border-3 border-green-300 cursor-pointer hover:bg-green-100 transition-all transform hover:scale-105 text-xl font-bold shadow-lg" 
                     data-word="${word}" data-index="${gameIndonesian.indexOf(word)}" onclick="selectIndonesianWord(this)">
                    <div class="flex items-center justify-center">
                        <i class="fas fa-flag text-green-500 mr-2"></i>
                        ${word}
                    </div>
                </div>
            `).join('');
            
            updateMatchingScore();
            startMatchingTimer();
        }
        
        function selectArabicWord(element) {
            // Remove previous selection
            document.querySelectorAll('.arabic-word').forEach(el => {
                el.classList.remove('bg-blue-300', 'border-blue-600', 'ring-4', 'ring-blue-400');
            });
            
            // Select new word
            selectedArabicWord = element;
            element.classList.add('bg-blue-300', 'border-blue-600', 'ring-4', 'ring-blue-400');
            
            // Speak the Arabic word
            speakArabic(element.dataset.word);
            
            // Check if we can make a match
            if (selectedIndonesianWord) {
                checkMatch();
            }
        }
        
        function selectIndonesianWord(element) {
            // Remove previous selection
            document.querySelectorAll('.indonesian-word').forEach(el => {
                el.classList.remove('bg-green-300', 'border-green-600', 'ring-4', 'ring-green-400');
            });
            
            // Select new word
            selectedIndonesianWord = element;
            element.classList.add('bg-green-300', 'border-green-600', 'ring-4', 'ring-green-400');
            
            // Check if we can make a match
            if (selectedArabicWord) {
                checkMatch();
            }
        }
        
        function checkMatch() {
            const arabicIndex = parseInt(selectedArabicWord.dataset.index);
            const indonesianIndex = parseInt(selectedIndonesianWord.dataset.index);
            
            if (arabicIndex === indonesianIndex) {
                // Correct match!
                const points = 25 + matchingBonus;
                speakPersonalizedFeedback(true, points);
                addPoints(points);
                matchingScore++;
                matchingBonus += 5; // Bonus increases with each correct match
                
                // Mark as matched with celebration animation
                selectedArabicWord.classList.add('bg-gradient-to-r', 'from-green-400', 'to-emerald-500', 'text-white', 'animate-pulse');
                selectedArabicWord.innerHTML = `<div class="flex items-center justify-center"><i class="fas fa-check-circle mr-2"></i>${selectedArabicWord.dataset.word}</div>`;
                selectedArabicWord.onclick = null;
                
                selectedIndonesianWord.classList.add('bg-gradient-to-r', 'from-green-400', 'to-emerald-500', 'text-white', 'animate-pulse');
                selectedIndonesianWord.innerHTML = `<div class="flex items-center justify-center"><i class="fas fa-check-circle mr-2"></i>${selectedIndonesianWord.dataset.word}</div>`;
                selectedIndonesianWord.onclick = null;
                
                // Add to matched words
                matchedWords.push(arabicIndex);
                
                // Check if game is complete
                if (matchingScore === 4) {
                    setTimeout(() => {
                        clearInterval(matchingTimerInterval);
                        const timeBonus = matchingTimer * 2;
                        addPoints(timeBonus);
                        showSuccessModal(points + timeBonus);
                        document.getElementById('matchingResult').innerHTML = `
                            <div class="bg-gradient-to-r from-green-400 to-emerald-500 text-white p-6 rounded-2xl text-center">
                                <div class="text-4xl mb-2">ğŸ‰</div>
                                <div class="text-2xl font-bold mb-2">Ù…Ø¨Ø±ÙˆÙƒ! Selamat!</div>
                                <div class="text-lg">Semua kata berhasil dicocokkan!</div>
                                <div class="text-sm mt-2">Bonus waktu: ${timeBonus} poin</div>
                            </div>
                        `;
                    }, 1000);
                }
                
            } else {
                // Wrong match
                speakPersonalizedFeedback(false);
                
                // Show wrong animation
                selectedArabicWord.classList.add('animate-bounce', 'bg-red-200', 'border-red-500');
                selectedIndonesianWord.classList.add('animate-bounce', 'bg-red-200', 'border-red-500');
                
                setTimeout(() => {
                    selectedArabicWord.classList.remove('animate-bounce', 'bg-red-200', 'border-red-500', 'bg-blue-300', 'border-blue-600', 'ring-4', 'ring-blue-400');
                    selectedIndonesianWord.classList.remove('animate-bounce', 'bg-red-200', 'border-red-500', 'bg-green-300', 'border-green-600', 'ring-4', 'ring-green-400');
                }, 1000);
            }
            
            // Reset selections
            selectedArabicWord = null;
            selectedIndonesianWord = null;
            updateMatchingScore();
        }
        
        function startMatchingTimer() {
            clearInterval(matchingTimerInterval);
            matchingTimerInterval = setInterval(() => {
                matchingTimer--;
                document.getElementById('matchingTimer').textContent = matchingTimer;
                
                if (matchingTimer <= 0) {
                    clearInterval(matchingTimerInterval);
                    document.getElementById('matchingResult').innerHTML = `
                        <div class="bg-red-100 p-4 rounded-lg text-center border-2 border-red-300">
                            <div class="text-xl font-bold text-red-800">â° Waktu Habis!</div>
                            <div class="text-sm text-red-700 mb-2">Coba lagi untuk mendapat skor lebih baik!</div>
                            <button onclick="resetMatchingGame()" class="bg-red-500 text-white px-4 py-2 rounded-full hover:bg-red-600 transition-colors text-sm">
                                Main Lagi
                            </button>
                        </div>
                    `;
                }
            }, 1000);
        }
        
        function showMatchingHint() {
            if (matchedWords.length >= 4) {
                return;
            }
            
            const vocab = vocabulary[currentTopic];
            let hintIndex = -1;
            
            // Find first unmatched word
            for (let i = 0; i < 4; i++) {
                if (!matchedWords.includes(i)) {
                    hintIndex = i;
                    break;
                }
            }
            
            if (hintIndex !== -1) {
                const arabicWord = vocab.arabic[hintIndex];
                const indonesianWord = vocab.indonesian[hintIndex];
                
                // Show hint in result area
                document.getElementById('matchingResult').innerHTML = `
                    <div class="bg-yellow-100 p-3 rounded-lg text-center border-2 border-yellow-300">
                        <div class="text-lg font-bold text-yellow-800">ğŸ’¡ Bantuan</div>
                        <div class="text-sm text-yellow-700">"${arabicWord}" artinya "${indonesianWord}"</div>
                    </div>
                `;
                
                speakArabic(arabicWord);
                
                // Reduce bonus for using hint
                matchingBonus = Math.max(0, matchingBonus - 3);
                updateMatchingScore();
            }
        }
        
        function updateMatchingScore() {
            document.getElementById('matchingScore').textContent = matchingScore;
            document.getElementById('matchingBonus').textContent = matchingBonus;
        }
        
        function resetMatchingGame() {
            clearInterval(matchingTimerInterval);
            initMatchingGame();
        }
        
        // Voice Guess Game Functions
        function initVoiceGuessGame() {
            voiceConversations = {
                introduction: [
                    {
                        question: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…',
                        correctAnswer: 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…',
                        options: ['ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…', 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±', 'Ø´ÙƒØ±Ø§ Ù„Ùƒ']
                    },
                    {
                        question: 'Ù…Ø§ Ø§Ø³Ù…ÙƒØŸ',
                        correctAnswer: 'Ø§Ø³Ù…ÙŠ Ø£Ø­Ù…Ø¯',
                        options: ['Ø§Ø³Ù…ÙŠ Ø£Ø­Ù…Ø¯', 'Ø¹Ù…Ø±ÙŠ Ø¹Ø´Ø± Ø³Ù†ÙˆØ§Øª', 'Ø£Ù†Ø§ Ù…Ù† Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§', 'Ø£Ù†Ø§ Ø·Ø§Ù„Ø¨']
                    },
                    {
                        question: 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±',
                        correctAnswer: 'ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±',
                        options: ['ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±', 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±', 'ØªØµØ¨Ø­ Ø¹Ù„Ù‰ Ø®ÙŠØ±', 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…']
                    }
                ],
                family: []
            };
            
            // Generate random family conversations
            generateRandomFamilyConversations();
            currentConversation = 0;
            loadConversation();
        }
        
        function generateRandomFamilyConversations() {
            const familyMembers = [
                {
                    arabic: 'Ø£Ø¨',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ',
                    answer: 'Ù‡Ø°Ø§ Ø£Ø¨ÙŠ',
                    emoji: 'ğŸ‘¨â€ğŸ’¼',
                    indonesian: 'Ayah'
                },
                {
                    arabic: 'Ø£Ù…',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙÙ‡ÙØŸ',
                    answer: 'Ù‡Ø°Ù‡ Ø£Ù…ÙŠ',
                    emoji: 'ğŸ‘©â€ğŸ³',
                    indonesian: 'Ibu'
                },
                {
                    arabic: 'Ø£Ø®',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ',
                    answer: 'Ù‡Ø°Ø§ Ø£Ø®ÙŠ',
                    emoji: 'ğŸ‘¦',
                    indonesian: 'Saudara Laki-laki'
                },
                {
                    arabic: 'Ø£Ø®Øª',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙÙ‡ÙØŸ',
                    answer: 'Ù‡Ø°Ù‡ Ø£Ø®ØªÙŠ',
                    emoji: 'ğŸ‘§',
                    indonesian: 'Saudara Perempuan'
                },
                {
                    arabic: 'Ø¬Ø¯',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ',
                    answer: 'Ù‡Ø°Ø§ Ø¬Ø¯ÙŠ',
                    emoji: 'ğŸ‘´',
                    indonesian: 'Kakek'
                },
                {
                    arabic: 'Ø¬Ø¯Ø©',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙÙ‡ÙØŸ',
                    answer: 'Ù‡Ø°Ù‡ Ø¬Ø¯ØªÙŠ',
                    emoji: 'ğŸ‘µ',
                    indonesian: 'Nenek'
                },
                {
                    arabic: 'Ø¹Ù…',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙØ§ØŸ',
                    answer: 'Ù‡Ø°Ø§ Ø¹Ù…ÙŠ',
                    emoji: 'ğŸ‘¨â€ğŸ¦±',
                    indonesian: 'Paman'
                },
                {
                    arabic: 'Ø¹Ù…Ø©',
                    question: 'Ù…ÙÙ† Ù‡ÙØ°ÙÙ‡ÙØŸ',
                    answer: 'Ù‡Ø°Ù‡ Ø¹Ù…ØªÙŠ',
                    emoji: 'ğŸ‘©â€ğŸ¦±',
                    indonesian: 'Bibi'
                }
            ];
            
            // Shuffle and select 5 random family members
            const shuffledMembers = [...familyMembers].sort(() => Math.random() - 0.5);
            const selectedMembers = shuffledMembers.slice(0, 5);
            
            voiceConversations.family = selectedMembers.map(member => {
                // Create wrong options by selecting other family members
                const wrongOptions = familyMembers
                    .filter(m => m.answer !== member.answer)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 3)
                    .map(m => m.answer);
                
                const allOptions = [member.answer, ...wrongOptions].sort(() => Math.random() - 0.5);
                
                return {
                    question: member.question,
                    correctAnswer: member.answer,
                    options: allOptions,
                    visual: {
                        emoji: member.emoji,
                        arabicLabel: member.arabic,
                        indonesianLabel: member.indonesian
                    }
                };
            });
        }
        
        function loadConversation() {
            const conversations = voiceConversations[currentTopic];
            if (!conversations || currentConversation >= conversations.length) {
                currentConversation = 0;
            }
            
            const conv = conversations[currentConversation];
            document.getElementById('conversationQuestion').textContent = conv.question;
            
            // Show visual question for family topic
            if (currentTopic === 'family' && conv.visual) {
                document.getElementById('voiceVisualArea').style.display = 'block';
                document.getElementById('voiceQuestionEmoji').textContent = conv.visual.emoji;
                document.getElementById('voiceQuestionArabicLabel').textContent = conv.visual.arabicLabel;
                document.getElementById('voiceQuestionIndonesianLabel').textContent = conv.visual.indonesianLabel;
            } else {
                document.getElementById('voiceVisualArea').style.display = 'none';
            }
            
            const optionsContainer = document.getElementById('voiceAnswerOptions');
            optionsContainer.innerHTML = conv.options.map(option => `
                <button onclick="checkVoiceAnswer('${option}')" 
                        class="bg-gradient-to-br from-gray-100 to-gray-200 hover:from-blue-100 hover:to-blue-200 p-4 rounded-xl text-lg arabic-text transition-colors border-2 border-gray-300 hover:border-blue-400">
                    ${option}
                </button>
            `).join('');
            
            document.getElementById('voiceResult').innerHTML = '';
        }
        
        function playConversation() {
            const conversations = voiceConversations[currentTopic];
            const conv = conversations[currentConversation];
            speakArabic(conv.question);
        }
        
        function checkVoiceAnswer(answer) {
            const conversations = voiceConversations[currentTopic];
            const conv = conversations[currentConversation];
            const result = document.getElementById('voiceResult');
            
            if (answer === conv.correctAnswer) {
                const feedbackText = speakPersonalizedFeedback(true, 20);
                result.innerHTML = `<div class="text-green-600 text-xl"><i class="fas fa-check-circle mr-2"></i>${feedbackText}</div>`;
                addPoints(20);
                speakArabic(answer);
            } else {
                const feedbackText = speakPersonalizedFeedback(false);
                result.innerHTML = `<div class="text-red-600 text-xl"><i class="fas fa-times-circle mr-2"></i>${feedbackText}<br><small>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <span class="arabic-text">${conv.correctAnswer}</span></small></div>`;
                speakArabic(conv.correctAnswer);
            }
        }
        
        function nextConversation() {
            const conversations = voiceConversations[currentTopic];
            currentConversation = (currentConversation + 1) % conversations.length;
            loadConversation();
        }
        
        function resetVoiceGuessGame() {
            if (currentTopic === 'family') {
                generateRandomFamilyConversations();
            }
            currentConversation = 0;
            loadConversation();
        }

        // Utility functions
        function addPoints(points) {
            totalPoints += points;
            document.getElementById('totalPoints').textContent = totalPoints;
            
            // Add stars based on points
            const newStars = Math.floor(totalPoints / 50);
            if (newStars > stars) {
                stars = newStars;
                updateStars();
            }
        }

        function updateStars() {
            const container = document.getElementById('stars');
            container.innerHTML = Array(Math.min(stars, 5)).fill(0).map(() => 
                '<i class="fas fa-star text-yellow-400 text-2xl star"></i>'
            ).join('');
        }

        function showSuccessModal(points = 10) {
            const feedbackText = speakPersonalizedFeedback(true, points);
            document.getElementById('successMessage').innerHTML = `
                <div class="text-2xl arabic-text text-emerald-700 mb-2">${feedbackText}</div>
                <div class="text-lg text-gray-600">Kamu mendapat ${points} poin!</div>
            `;
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successModal').classList.add('flex');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
        }

        function showNotification(message, type) {
            // Notification disabled for mobile layout
            return;
        }

        // Profile Management Functions
        function showProfileModal() {
            document.getElementById('profileModal').classList.remove('hidden');
            document.getElementById('profileModal').classList.add('flex');
            document.getElementById('studentNameInput').value = studentName;
            
            // Set current gender
            if (studentGender === 'male') {
                document.getElementById('genderMale').checked = true;
            } else {
                document.getElementById('genderFemale').checked = true;
            }
        }
        
        function selectGender(gender) {
            studentGender = gender;
            
            // Update avatar based on gender
            if (gender === 'male') {
                studentAvatar = 'ğŸ‘¦';
            } else {
                studentAvatar = 'ğŸ‘§';
            }
            
            // Update preview
            if (!studentPhoto) {
                document.getElementById('photoPreview').textContent = studentAvatar;
            }
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.add('hidden');
            document.getElementById('profileModal').classList.remove('flex');
        }

        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            
            // Update visual selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('ring-4', 'ring-blue-500');
            });
            
            event.target.classList.add('ring-4', 'ring-blue-500');
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    studentPhoto = e.target.result;
                    
                    // Update preview
                    const preview = document.getElementById('photoPreview');
                    preview.innerHTML = `<img src="${studentPhoto}" alt="Foto Siswa" class="w-full h-full object-cover rounded-full">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveProfile() {
            const nameInput = document.getElementById('studentNameInput').value.trim();
            
            if (nameInput === '') {
                alert('Nama tidak boleh kosong!');
                return;
            }
            
            if (!studentGender) {
                alert('Pilih jenis kelamin terlebih dahulu!');
                return;
            }
            
            studentName = nameInput;
            
            // Update profile display
            document.getElementById('studentName').textContent = studentName;
            
            if (studentPhoto) {
                document.getElementById('studentPhoto').innerHTML = `<img src="${studentPhoto}" alt="Foto Siswa" class="w-full h-full object-cover rounded-full">`;
                document.getElementById('studentPhoto').className = "w-12 h-12 rounded-full mr-3 overflow-hidden border-2 border-white";
            } else {
                document.getElementById('studentPhoto').textContent = studentAvatar;
                document.getElementById('studentPhoto').className = "w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-lg font-bold mr-3";
            }
            
            // Save to localStorage
            localStorage.setItem('studentName', studentName);
            localStorage.setItem('studentGender', studentGender);
            localStorage.setItem('studentAvatar', studentAvatar);
            if (studentPhoto) {
                localStorage.setItem('studentPhoto', studentPhoto);
            }
            
            closeProfileModal();
            
            // Welcome message with audio
            setTimeout(() => {
                speakPersonalizedFeedback(true, 0);
            }, 1000);
        }

        function loadProfile() {
            const savedName = localStorage.getItem('studentName');
            const savedGender = localStorage.getItem('studentGender');
            const savedAvatar = localStorage.getItem('studentAvatar');
            const savedPhoto = localStorage.getItem('studentPhoto');
            
            if (savedName) {
                studentName = savedName;
                document.getElementById('studentName').textContent = studentName;
            }
            
            if (savedGender) {
                studentGender = savedGender;
                studentAvatar = savedGender === 'male' ? 'ğŸ‘¦' : 'ğŸ‘§';
            }
            
            if (savedAvatar) {
                studentAvatar = savedAvatar;
            }
            
            if (savedPhoto) {
                studentPhoto = savedPhoto;
                document.getElementById('studentPhoto').innerHTML = `<img src="${studentPhoto}" alt="Foto Siswa" class="w-full h-full object-cover rounded-full">`;
                document.getElementById('studentPhoto').className = "w-12 h-12 rounded-full mr-3 overflow-hidden border-2 border-white";
            } else {
                document.getElementById('studentPhoto').textContent = studentAvatar;
                document.getElementById('studentPhoto').className = "w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-lg font-bold mr-3";
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStars();
            loadProfile();
            
            // Show profile modal on first visit
            if (!localStorage.getItem('studentName')) {
                setTimeout(() => {
                    showProfileModal();
                }, 1000);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9761686bf2d2a459',t:'MTc1NjM1ODkzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
